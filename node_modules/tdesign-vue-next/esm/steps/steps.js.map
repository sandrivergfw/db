{"version":3,"file":"steps.js","sources":["../../src/steps/steps.tsx"],"sourcesContent":["import { computed, defineComponent, provide, reactive, ref, toRefs, VNode, watchEffect } from 'vue';\nimport isObject from 'lodash/isObject';\nimport props from './props';\nimport stepItemProps from './step-item-props';\nimport { TdStepItemProps } from './type';\nimport StepItem from './step-item';\n\nimport { usePrefixClass } from '../hooks/useConfig';\nimport useVModel from '../hooks/useVModel';\nimport { useChildComponentSlots } from '../hooks';\n\nexport default defineComponent({\n  name: 'TSteps',\n  props: { ...props },\n  setup(props) {\n    const COMPONENT_NAME = usePrefixClass('steps');\n\n    const { current, modelValue } = toRefs(props);\n    const [innerCurrent, setInnerCurrent] = useVModel(\n      current,\n      modelValue,\n      props.defaultCurrent,\n      props.onChange,\n      'current',\n    );\n\n    provide(\n      'StepsState',\n      reactive({\n        current: innerCurrent,\n        setCurrent: setInnerCurrent,\n      }),\n    );\n\n    provide('StepsProps', props);\n\n    const indexMap = ref({});\n\n    const handleStatus = (itemProps: TdStepItemProps, index: number) => {\n      if (itemProps.status && itemProps.status !== 'default') return itemProps.status;\n      if (innerCurrent.value === 'FINISH') return 'finish';\n      // value 不存在时，使用 index 进行区分每一个步骤\n      if (itemProps.value === undefined && index < innerCurrent.value) return 'finish';\n      // value 存在，找匹配位置\n      if (itemProps.value !== undefined) {\n        const matchIndex = indexMap.value[innerCurrent.value];\n        if (matchIndex === undefined) {\n          console.warn('TDesign Steps Warn: The current `value` is not exist.');\n          return 'default';\n        }\n        if (props.sequence === 'positive' && index < matchIndex) return 'finish';\n        if (props.sequence === 'reverse' && index > matchIndex) return 'finish';\n      }\n      const key = itemProps.value === undefined ? index : itemProps.value;\n      if (key === innerCurrent.value) return 'process';\n      return 'default';\n    };\n\n    const getChildComponentByName = useChildComponentSlots();\n\n    const getOptionListBySlots = (nodes: VNode[]) => {\n      const arr: Array<TdStepItemProps> = [];\n      nodes?.forEach((node) => {\n        const option = node?.props || {};\n        const children = node?.children;\n        if (!option && !children) return;\n        if (children && isObject(children)) {\n          for (const key in children) {\n            if (key in stepItemProps && !option[key]) {\n              option[key] = children[key];\n            }\n          }\n        }\n        props.sequence === 'reverse' ? arr.unshift(option as TdStepItemProps) : arr.push(option as TdStepItemProps);\n      });\n      return arr;\n    };\n    const getOptions = () => {\n      let options: Array<TdStepItemProps>;\n      if (props.options?.length) {\n        options = props.sequence === 'reverse' ? props.options.slice().reverse() : props.options;\n      } else {\n        const nodes: VNode[] = getChildComponentByName('StepItem') as VNode[];\n        options = getOptionListBySlots(nodes);\n      }\n\n      (options || []).forEach((item, index) => {\n        if (item.value !== undefined) indexMap.value[item.value] = index;\n      });\n      return options;\n    };\n\n    const renderContent = () => {\n      const options = getOptions();\n\n      return options.map((item, index) => {\n        const stepIndex = props.sequence === 'reverse' ? options.length - index - 1 : index;\n        index = item.value !== undefined ? index : stepIndex;\n\n        return <StepItem {...item} index={stepIndex} status={handleStatus(item, index)} key={item.value || index} />;\n      });\n    };\n\n    /** class calculate */\n    const handleTheme = () => {\n      let { theme } = props;\n      const options = getOptions();\n      options.forEach((item) => {\n        if (item?.icon !== undefined) {\n          // icon > theme\n          theme = 'default';\n        }\n      });\n      return theme;\n    };\n    const baseClass = computed(() => {\n      return [\n        COMPONENT_NAME.value,\n        `${COMPONENT_NAME.value}--${props.layout}`,\n        `${COMPONENT_NAME.value}--${handleTheme()}-anchor`,\n        `${COMPONENT_NAME.value}--${props.sequence}`,\n        `${COMPONENT_NAME.value}--${props.separator}-separator`,\n      ];\n    });\n    /** class calculate END */\n\n    return () => <div class={baseClass.value}>{renderContent()}</div>;\n  },\n});\n"],"names":["defineComponent","name","props","setup","COMPONENT_NAME","usePrefixClass","toRefs","current","modelValue","useVModel","defaultCurrent","onChange","innerCurrent","setInnerCurrent","provide","reactive","setCurrent","indexMap","ref","handleStatus","itemProps","index","status","value","matchIndex","console","warn","sequence","key","getChildComponentByName","useChildComponentSlots","getOptionListBySlots","nodes","arr","forEach","node","option","children","isObject","stepItemProps","unshift","push","getOptions","options","length","slice","reverse","item","renderContent","map","stepIndex","_createVNode","StepItem","_mergeProps","handleTheme","theme","icon","baseClass","computed","layout","separator"],"mappings":"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"}