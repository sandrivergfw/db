{"version":3,"file":"useDropdownOptions.js","sources":["../../../src/dropdown/hooks/useDropdownOptions.ts"],"sourcesContent":["import { computed, ComputedRef, VNode, getCurrentInstance, Slots } from 'vue';\nimport { DropdownOption, TdDropdownProps } from '../type';\nimport { useChildComponentSlots } from '../../hooks/slot';\n\nexport const getOptionsFromChildren = (menuGroup: any): DropdownOption[] => {\n  if (!menuGroup) return [];\n\n  // 处理内部嵌套场景\n  if (menuGroup[0]?.type?.name === 'TDropdownMenu') {\n    const groupChildren = menuGroup[0]?.children?.default?.();\n    if (Array.isArray(groupChildren)) {\n      return getOptionsFromChildren(groupChildren);\n    }\n  }\n\n  // 处理v-if的场景\n  if (Array.isArray(menuGroup[0]?.children)) return getOptionsFromChildren(menuGroup[0]?.children);\n\n  if (Array.isArray(menuGroup)) {\n    return menuGroup\n      .map((item) => {\n        const groupChildren = item.children?.default?.();\n\n        // 当前节点的渲染内容\n        const contentCtx = groupChildren?.filter?.(\n          (v: VNode) => !['TDropdownMenu', 'TDropdownItem'].includes((v.type as { name: string })?.name),\n        );\n        // 嵌套菜单的节点\n        const childrenCtx = groupChildren?.filter?.(\n          (v: VNode) =>\n            typeof v.children !== 'string' &&\n            ['TDropdownMenu', 'TDropdownItem'].includes((v.type as { name: string })?.name),\n        );\n\n        return {\n          ...item.props,\n          content: contentCtx || groupChildren,\n          children: childrenCtx?.length > 0 ? getOptionsFromChildren(childrenCtx) : null,\n        };\n      })\n      .filter((v) => !!v.content);\n  }\n\n  return [];\n};\n\nexport default function useDropdownOptions(props: TdDropdownProps): ComputedRef<DropdownOption[]> {\n  const getChildComponentSlots = useChildComponentSlots();\n  const instance = getCurrentInstance();\n  const menuSlot =\n    (getChildComponentSlots('DropdownMenu')?.[0]?.children as Slots)?.default?.() || instance.slots?.dropdown?.();\n\n  const dropdownOptions = computed(() => {\n    if (props.options && props.options.length > 0) return props.options;\n\n    return getOptionsFromChildren(menuSlot);\n  });\n  return dropdownOptions;\n}\n"],"names":["getOptionsFromChildren","menuGroup","type","name","groupChildren","children","Array","isArray","map","item","contentCtx","filter","v","includes","childrenCtx","props","content","length","useDropdownOptions","getChildComponentSlots","useChildComponentSlots","instance","getCurrentInstance","menuSlot","slots","dropdown","dropdownOptions","computed","options"],"mappings":"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"}