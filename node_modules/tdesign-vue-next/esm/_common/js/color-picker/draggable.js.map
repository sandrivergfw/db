{"version":3,"file":"draggable.js","sources":["../../../../src/_common/js/color-picker/draggable.ts"],"sourcesContent":["/* eslint-disable no-use-before-define */\nexport interface Coordinate {\n  x: number;\n  y: number;\n}\n\nexport type DraggableEvent = MouseEvent;\n\ninterface DraggableCallback {\n  (coordinate: Coordinate, event?: DraggableEvent): void;\n}\n\nexport interface DraggableProps {\n  start?: DraggableCallback;\n  drag?: DraggableCallback;\n  end?: DraggableCallback;\n}\n\ninterface DraggableHandles {\n  start: (this: Draggable, event: DraggableEvent) => {};\n  drag: (this: Draggable, event: DraggableEvent) => {};\n  end: (this: Draggable, event: DraggableEvent) => {};\n}\n\n// 配置项\nconst defaultsOptions: DraggableProps = {\n  start: (coordinate: Coordinate, event: DraggableEvent) => {},\n  drag: (coordinate: Coordinate, event: DraggableEvent) => {},\n  end: (coordinate: Coordinate, event: DraggableEvent) => {},\n};\n\nexport class Draggable {\n  private dragging = false;\n\n  private $el: HTMLElement;\n\n  private props: DraggableProps;\n\n  private handles: DraggableHandles;\n\n  constructor(el: HTMLElement, options?: DraggableProps) {\n    this.$el = el;\n    this.props = { ...defaultsOptions, ...options };\n    this.handles = {\n      start: this.#dragStart.bind(this),\n      drag: this.#drag.bind(this),\n      end: this.#dragEnd.bind(this),\n    };\n    this.$el.addEventListener('mousedown', this.handles.start, false);\n  }\n\n  #dragStart(event: DraggableEvent) {\n    if (this.dragging) {\n      return;\n    }\n    // event.preventDefault();\n    window.addEventListener('mousemove', this.handles.drag, false);\n    window.addEventListener('mouseup', this.handles.end, false);\n    window.addEventListener('contextmenu', this.handles.end, false);\n    this.dragging = true;\n    this.props.start(this.#getCoordinate(event), event);\n  }\n\n  #drag(event: DraggableEvent) {\n    if (!this.dragging) {\n      return;\n    }\n    this.props.drag(this.#getCoordinate(event), event);\n  }\n\n  #dragEnd(event: DraggableEvent) {\n    setTimeout(() => {\n      this.dragging = false;\n      this.props.end(this.#getCoordinate(event), event);\n    }, 0);\n    window.removeEventListener('mousemove', this.handles.drag, false);\n    window.removeEventListener('mouseup', this.handles.end, false);\n    window.removeEventListener('contextmenu', this.handles.end, false);\n  }\n\n  #getCoordinate(event: DraggableEvent) {\n    const rect = this.$el.getBoundingClientRect();\n    const mouseEvent = event;\n    const left = mouseEvent.clientX - rect.left;\n    const top = mouseEvent.clientY - rect.top;\n    return {\n      y: Math.min(Math.max(0, top), rect.height),\n      x: Math.min(Math.max(0, left), rect.width),\n    };\n  }\n\n  destroy() {\n    this.$el.removeEventListener('mousedown', this.handles.start, false);\n    window.removeEventListener('mousemove', this.handles.drag, false);\n    window.removeEventListener('mouseup', this.handles.end, false);\n    window.removeEventListener('contextmenu', this.handles.end, false);\n  }\n}\n\nexport default Draggable;\n"],"names":["defaultsOptions","start","coordinate","event","drag","end","Draggable","el","options","$el","props","handles","bind","addEventListener","removeEventListener","window","dragging","setTimeout","rect","getBoundingClientRect","mouseEvent","left","clientX","top","clientY","y","Math","min","max","height","x","width"],"mappings":"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"}