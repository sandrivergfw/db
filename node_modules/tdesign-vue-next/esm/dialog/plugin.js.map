{"version":3,"file":"plugin.js","sources":["../../src/dialog/plugin.tsx"],"sourcesContent":["import { App, createApp, ref, Plugin, defineComponent, h, onMounted } from 'vue';\nimport DialogComponent from './dialog';\nimport { getAttach } from '../utils/dom';\nimport { DialogOptions, DialogMethod, DialogConfirmMethod, DialogAlertMethod, DialogInstance } from './type';\n\nconst createDialog: DialogMethod = (props: DialogOptions) => {\n  const options = { ...props };\n  const wrapper = document.createElement('div');\n  const visible = ref(false);\n  const { className } = options;\n  const component = defineComponent({\n    setup(props, { expose }) {\n      const dialogOptions = ref<Record<string, any>>(options);\n      onMounted(() => {\n        visible.value = true;\n        // 处理 https://github.com/Tencent/tdesign-vue-next/issues/394\n        (document.activeElement as HTMLElement).blur();\n      });\n      const update = (newOptions: DialogOptions) => {\n        dialogOptions.value = {\n          ...options,\n          ...newOptions,\n        };\n      };\n\n      expose({\n        update,\n      });\n\n      return () => {\n        const onClose =\n          options.onClose ||\n          function () {\n            visible.value = false;\n          };\n        delete options.className;\n        return h(DialogComponent, {\n          onClose,\n          visible: visible.value,\n          ...dialogOptions.value,\n        });\n      };\n    },\n  });\n  const dialog = createApp(component).mount(wrapper);\n\n  if (className) {\n    className.split(' ').forEach((name) => {\n      dialog.$el.classList.add(name.trim());\n    });\n  }\n  if (options.style) {\n    (dialog.$el as HTMLElement).style.cssText += options.style;\n  }\n\n  const container = getAttach(options.attach);\n  if (container) {\n    container.appendChild(wrapper);\n  } else {\n    console.error('attach is not exist');\n  }\n\n  const dialogNode: DialogInstance = {\n    show: () => {\n      visible.value = true;\n    },\n    hide: () => {\n      visible.value = false;\n    },\n    update: (newOptions: DialogOptions) => {\n      dialog.update(newOptions);\n    },\n    destroy: () => {\n      visible.value = false;\n      setTimeout(() => {\n        wrapper.parentNode.removeChild(wrapper);\n      }, 300);\n    },\n  };\n  return dialogNode;\n};\ninterface ExtraApi {\n  confirm: DialogConfirmMethod;\n  alert: DialogAlertMethod;\n}\n\nconst confirm: DialogConfirmMethod = (props: DialogOptions) => createDialog(props);\n\nconst alert: DialogAlertMethod = (props: Omit<DialogOptions, 'confirmBtn'>) => {\n  const options = { ...props };\n  options.cancelBtn = null;\n  return createDialog(options);\n};\n\nconst extraApi: ExtraApi = {\n  confirm,\n  alert,\n};\n\nexport type DialogPluginType = Plugin & ExtraApi & DialogAlertMethod;\n\nexport const DialogPlugin: DialogPluginType = createDialog as DialogPluginType;\n\nDialogPlugin.install = (app: App): void => {\n  app.config.globalProperties.$dialog = createDialog;\n  Object.keys(extraApi).forEach((funcName) => {\n    app.config.globalProperties.$dialog[funcName] = extraApi[funcName];\n  });\n};\n\nObject.keys(extraApi).forEach((funcName) => {\n  DialogPlugin[funcName] = extraApi[funcName];\n});\n\nexport default DialogPlugin;\n"],"names":["createDialog","props","options","wrapper","document","createElement","visible","ref","className","component","defineComponent","setup","expose","dialogOptions","onMounted","value","activeElement","blur","update","newOptions","onClose","h","DialogComponent","dialog","createApp","mount","split","forEach","name","$el","classList","add","trim","style","cssText","container","getAttach","attach","appendChild","console","error","dialogNode","show","hide","destroy","setTimeout","parentNode","removeChild","confirm","alert","cancelBtn","extraApi","DialogPlugin","install","app","config","globalProperties","$dialog","Object","keys","funcName"],"mappings":"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"}