{"version":3,"file":"submenu.js","sources":["../../src/menu/submenu.tsx"],"sourcesContent":["import {\n  defineComponent,\n  computed,\n  inject,\n  ref,\n  provide,\n  onMounted,\n  getCurrentInstance,\n  watch,\n  Slots,\n  toRefs,\n  reactive,\n  nextTick,\n} from 'vue';\nimport props from './submenu-props';\nimport { renderContent, renderTNodeJSX } from '../utils/render-tnode';\nimport { TdMenuInterface, TdSubMenuInterface, TdMenuItem } from './const';\nimport FakeArrow from '../common-components/fake-arrow';\nimport useRipple from '../hooks/useRipple';\nimport { usePrefixClass } from '../hooks/useConfig';\nimport { Popup, PopupPlacement } from '../popup';\n\nexport default defineComponent({\n  name: 'TSubmenu',\n\n  props,\n  setup(props, ctx) {\n    const classPrefix = usePrefixClass();\n    const menu = inject<TdMenuInterface>('TdMenu');\n    const { theme, activeValues, expandValues, isHead, open } = menu;\n    const submenu = inject<TdSubMenuInterface>('TdSubmenu', {});\n    const { setSubPopup, closeParentPopup } = submenu;\n    const mode = computed(() => ctx.attrs.expandType || menu.mode.value);\n\n    const menuItems = ref([]); // 因composition-api的缺陷，不用reactive， 详见：https://github.com/vuejs/composition-api/issues/637\n    const isActive = computed(() => activeValues.value.indexOf(props.value) > -1);\n    const popupVisible = ref(false);\n    const isCursorInPopup = ref(false);\n    const rippleColor = computed(() => (theme.value === 'light' ? '#E7E7E7' : '#383838'));\n    const isOpen = computed(() => {\n      if (mode.value === 'popup') {\n        return popupVisible.value;\n      }\n      return expandValues ? expandValues.value?.includes(props.value) : false;\n    });\n    const isNested = ref(false); // 是否嵌套\n\n    const popupWrapperRef = ref<HTMLElement>();\n    const subPopupRef = ref<HTMLElement>();\n    const submenuRef = ref<HTMLElement>();\n    useRipple(submenuRef, rippleColor);\n\n    const classes = computed(() => [\n      `${classPrefix.value}-submenu`,\n      {\n        [`${classPrefix.value}-is-disabled`]: props.disabled,\n        [`${classPrefix.value}-is-opened`]: isOpen.value,\n      },\n    ]);\n    const popupClass = computed(() => [\n      `${classPrefix.value}-menu__popup`,\n      `${classPrefix.value}-menu__popup--${theme.value}`,\n      `${classPrefix.value}-is-${isHead ? 'horizontal' : 'vertical'}`,\n      {\n        [`${classPrefix.value}-is-opened`]: popupVisible.value,\n      },\n      'narrow-scrollbar',\n    ]);\n    const submenuClass = computed(() => [\n      `${classPrefix.value}-menu__item`,\n      `${classPrefix.value}-menu__item-spacer`,\n      `${classPrefix.value}-menu__item-spacer--${isHead && !isNested.value ? 'bottom' : 'right'}`,\n      {\n        [`${classPrefix.value}-is-disabled`]: props.disabled,\n        [`${classPrefix.value}-is-opened`]: isOpen.value,\n        [`${classPrefix.value}-is-active`]: isActive.value,\n      },\n    ]);\n    const subClass = computed(() => [\n      `${classPrefix.value}-menu__sub`,\n      {\n        [`${classPrefix.value}-is-opened`]: isOpen.value,\n      },\n    ]);\n    const arrowClass = computed(() => [\n      {\n        [`${classPrefix.value}-fake-arrow--active`]: isOpen.value,\n      },\n    ]);\n\n    const passSubPopupRefToParent = (val: HTMLElement) => {\n      if (typeof setSubPopup === 'function') {\n        setSubPopup(val);\n      }\n    };\n\n    // methods\n    const handleMouseEnter = () => {\n      if (props.disabled) return;\n      setTimeout(() => {\n        if (!popupVisible.value) {\n          open(props.value);\n          // popupVisible设置为TRUE之后打开popup，因此需要在nextTick中确保可以拿到ref值\n          nextTick().then(() => {\n            passSubPopupRefToParent(popupWrapperRef.value);\n          });\n        }\n        popupVisible.value = true;\n      }, 0);\n    };\n\n    const targetInPopup = (el: HTMLElement) => el?.classList.contains(`${classPrefix.value}-menu__popup`);\n    const loopInPopup = (el: HTMLElement): boolean => {\n      if (!el) return false;\n      return targetInPopup(el) || loopInPopup(el.parentElement);\n    };\n\n    const handleMouseLeave = (e: MouseEvent) => {\n      setTimeout(() => {\n        const inPopup = targetInPopup(e.relatedTarget as HTMLElement);\n\n        if (isCursorInPopup.value || inPopup) return;\n        popupVisible.value = false;\n      }, 0);\n    };\n\n    const handleMouseLeavePopup = (e: any) => {\n      const { toElement, relatedTarget } = e;\n      let target = toElement || relatedTarget;\n\n      if (target === subPopupRef.value) return;\n\n      const isSubmenu = (el: Element) => el === submenuRef.value;\n      while (target !== null && target !== document && !isSubmenu(target)) {\n        target = target.parentNode;\n      }\n\n      isCursorInPopup.value = false;\n\n      if (!isSubmenu(target)) {\n        popupVisible.value = false;\n      }\n\n      closeParentPopup?.(e);\n    };\n    const handleEnterPopup = () => {\n      isCursorInPopup.value = true;\n    };\n\n    const handleSubmenuItemClick = () => {\n      if (props.disabled) return;\n      open(props.value);\n    };\n\n    watch(popupVisible, (visible) => {\n      menu.open(props.value, visible ? 'add' : 'remove');\n    });\n\n    // provide\n    const { value } = toRefs(props);\n    provide<TdSubMenuInterface>(\n      'TdSubmenu',\n      reactive({\n        value,\n        addMenuItem: (item: TdMenuItem) => {\n          menuItems.value.push(item);\n          if (submenu) {\n            submenu.addMenuItem(item);\n          }\n        },\n        setSubPopup: (ref: HTMLElement) => {\n          subPopupRef.value = ref;\n        },\n        closeParentPopup: (e: MouseEvent) => {\n          const related = e.relatedTarget as HTMLElement;\n          if (loopInPopup(related)) return;\n          handleMouseLeavePopup(e);\n        },\n      }),\n    );\n\n    onMounted(() => {\n      menu?.vMenu?.add({ value: props.value, parent: submenu?.value, vnode: ctx.slots.default });\n      const instance = getCurrentInstance();\n      let node = instance.parent;\n\n      while (node && !/^t(head)?menu/i.test(node?.type.name)) {\n        if (/submenu/i.test(node?.type.name)) {\n          isNested.value = true;\n          break;\n        }\n        node = node?.parent;\n      }\n    });\n\n    return {\n      classPrefix,\n      menuItems,\n      mode,\n      theme,\n      isHead,\n      isNested,\n      classes,\n      subClass,\n      arrowClass,\n      popupClass,\n      submenuClass,\n      submenuRef,\n      popupWrapperRef,\n      popupVisible,\n      isCursorInPopup,\n      handleEnterPopup,\n      handleMouseEnter,\n      handleMouseLeave,\n      handleMouseLeavePopup,\n      handleSubmenuItemClick,\n    };\n  },\n  methods: {\n    renderPopup(triggerElement: Slots[]) {\n      let placement = 'right-top';\n      if (!this.isNested && this.isHead) {\n        placement = 'bottom-left';\n      }\n      const overlayInnerStyle =\n        this.isNested && this.isHead ? { marginLeft: '16px' } : { [`margin-${this.isHead ? 'top' : 'left'}`]: '20px' };\n\n      const popupWrapper = (\n        <div\n          ref=\"popupWrapperRef\"\n          class={[\n            // ...this.popupClass,\n            `${this.classPrefix}-menu__spacer`,\n            `${this.classPrefix}-menu__spacer--${!this.isNested && this.isHead ? 'top' : 'left'}`,\n          ]}\n          onMouseenter={this.handleEnterPopup}\n          onMouseleave={this.handleMouseLeavePopup}\n        >\n          <ul class={`${this.classPrefix}-menu__popup-wrapper narrow-scrollbar`}>\n            {renderContent(this, 'default', 'content')}\n          </ul>\n        </div>\n      );\n      const slots = {\n        content: () => popupWrapper,\n      };\n      const realPopup = (\n        <Popup\n          overlayInnerClassName={[...this.popupClass]}\n          visible={this.popupVisible}\n          placement={placement as PopupPlacement}\n          overlayInnerStyle={overlayInnerStyle}\n          v-slots={slots}\n        >\n          <div ref=\"submenuRef\" class={this.submenuClass}>\n            {triggerElement}\n          </div>\n        </Popup>\n      );\n\n      return realPopup;\n    },\n    renderHeadSubmenu() {\n      const icon = renderTNodeJSX(this, 'icon');\n      const normalSubmenu = [\n        <div ref=\"submenuRef\" class={this.submenuClass} onClick={this.handleSubmenuItemClick}>\n          {icon}\n          <span class={[`${this.classPrefix}-menu__content`]}>{renderTNodeJSX(this, 'title', { silent: true })}</span>\n        </div>,\n        <ul style=\"opacity: 0; width: 0; height: 0; overflow: hidden\">{renderContent(this, 'default', 'content')}</ul>,\n      ];\n\n      const needRotate = this.mode === 'popup' && this.isNested;\n\n      const triggerElement = [\n        icon,\n        <span class={[`${this.classPrefix}-menu__content`]}>{renderTNodeJSX(this, 'title', { silent: true })}</span>,\n        <FakeArrow\n          overlayClassName={this.arrowClass}\n          overlayStyle={{ transform: `rotate(${needRotate ? -90 : 0}deg)` }}\n        />,\n      ];\n\n      return this.mode === 'normal' ? normalSubmenu : this.renderPopup(triggerElement);\n    },\n    renderSubmenu() {\n      const hasContent = this.$slots.content || this.$slots.default;\n      const icon = renderTNodeJSX(this, 'icon');\n      const child = renderContent(this, 'default', 'content');\n      let { parent } = getCurrentInstance();\n      let paddingLeft = 44;\n\n      while (parent && parent.type.name !== 'TMenu') {\n        if (parent.type.name === 'TSubmenu') {\n          paddingLeft += 16;\n        }\n        parent = parent.parent;\n      }\n\n      const needRotate = this.mode === 'popup' && this.isNested;\n\n      const normalSubmenu = [\n        <div ref=\"submenuRef\" class={this.submenuClass} onClick={this.handleSubmenuItemClick}>\n          {icon}\n          <span class={[`${this.classPrefix}-menu__content`]}>{renderTNodeJSX(this, 'title', { silent: true })}</span>\n          {hasContent && (\n            <FakeArrow\n              overlayClassName={this.arrowClass}\n              overlayStyle={{ transform: `rotate(${needRotate ? -90 : 0}deg)` }}\n            />\n          )}\n        </div>,\n        <ul class={this.subClass} style={{ '--padding-left': `${paddingLeft}px` }}>\n          {child}\n        </ul>,\n      ];\n\n      const triggerElement = [\n        icon,\n        <span class={[`${this.classPrefix}-menu__content`]}>{renderTNodeJSX(this, 'title', { silent: true })}</span>,\n        <FakeArrow\n          overlayClassName={this.arrowClass}\n          overlayStyle={{ transform: `rotate(${needRotate ? -90 : 0}deg)`, 'margin-left': 'auto' }}\n        />,\n      ];\n\n      return this.mode === 'normal' ? normalSubmenu : this.renderPopup(triggerElement);\n    },\n  },\n  render() {\n    let child = null;\n    let events = {};\n\n    if (this.mode === 'popup') {\n      events = {\n        onMouseenter: this.handleMouseEnter,\n        onMouseleave: this.handleMouseLeave,\n      };\n    }\n    if (Object.keys(this.$slots).length > 0) {\n      child = this.isHead ? this.renderHeadSubmenu() : this.renderSubmenu();\n    }\n    return (\n      <li class={this.classes} {...events}>\n        {child}\n      </li>\n    );\n  },\n});\n"],"names":["defineComponent","name","props","setup","ctx","classPrefix","usePrefixClass","menu","inject","theme","activeValues","expandValues","isHead","open","submenu","setSubPopup","closeParentPopup","mode","computed","attrs","expandType","value","menuItems","ref","isActive","indexOf","popupVisible","isCursorInPopup","rippleColor","isOpen","includes","isNested","popupWrapperRef","subPopupRef","submenuRef","useRipple","classes","disabled","popupClass","submenuClass","subClass","arrowClass","passSubPopupRefToParent","val","handleMouseEnter","setTimeout","nextTick","then","targetInPopup","el","classList","contains","loopInPopup","parentElement","handleMouseLeave","e","inPopup","relatedTarget","handleMouseLeavePopup","toElement","target","isSubmenu","document","parentNode","handleEnterPopup","handleSubmenuItemClick","watch","visible","toRefs","provide","reactive","addMenuItem","item","push","related","onMounted","vMenu","add","parent","vnode","slots","instance","getCurrentInstance","node","test","type","methods","renderPopup","triggerElement","placement","overlayInnerStyle","marginLeft","popupWrapper","_createVNode","renderContent","content","realPopup","renderHeadSubmenu","icon","renderTNodeJSX","normalSubmenu","silent","needRotate","transform","renderSubmenu","hasContent","$slots","child","paddingLeft","render","events","onMouseenter","onMouseleave","Object","keys","length","_mergeProps"],"mappings":"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"}