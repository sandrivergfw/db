{"version":3,"file":"v-menu.js","sources":["../../src/menu/v-menu.ts"],"sourcesContent":["import { ref, Slot } from 'vue';\n\ntype MenuValue = string | number;\ntype MenuNode = MenuValue | VMenuData;\n\ninterface VMenuData {\n  value: MenuValue;\n  parent?: MenuNode;\n  children: VMenuData[];\n  vnode?: Slot;\n}\n\ninterface VMenuItem {\n  value?: MenuValue;\n  parent: MenuValue;\n  vnode?: Slot;\n}\n\nconst getTreePaths = (node: VMenuData, val: MenuValue, ans: MenuValue[]): MenuValue[] => {\n  if (!node) return;\n  for (let i = 0; i < node.children.length; ++i) {\n    const child = node.children[i];\n    if (child.value === val) return [...ans, node.value];\n    const target = getTreePaths(child, val, [...ans, node.value]);\n    if (target) return target;\n  }\n};\n\nconst getTreeSameParentNodes = (node: VMenuData, val: MenuValue): VMenuData[] => {\n  if (!node) return [];\n  for (let i = 0; i < node.children.length; ++i) {\n    const child = node.children[i];\n    if (child.value === val) return node.children;\n    const target = getTreeSameParentNodes(child, val);\n    if (target) return target;\n  }\n};\n\nconst DFS = (root: VMenuData, val: MenuValue): VMenuData => {\n  if (root.value === val) return root;\n  if (root.children.length > 0) {\n    for (let i = 0, len = root.children.length; i < len; i++) {\n      const res = DFS(root.children[i], val);\n      if (res) return res;\n    }\n  }\n};\n\nexport default class VMenu {\n  data: VMenuData = null;\n\n  cache: Set<VMenuData> = new Set();\n\n  isMutex = ref(false);\n\n  expandValues: Set<MenuValue> = null;\n\n  constructor(options: Record<string, any>) {\n    const root: VMenuData = {\n      value: null,\n      parent: null,\n      children: [],\n    };\n    this.data = root;\n    this.isMutex = options?.isMutex;\n    this.expandValues = new Set(options?.expandValues);\n  }\n\n  add(item: VMenuItem) {\n    const { value, parent, vnode } = item;\n    const node: VMenuData = {\n      value,\n      parent,\n      children: [],\n      vnode,\n    };\n\n    this.cache.forEach((data, v2, set) => {\n      if (item.value === data.parent) {\n        node.children.push(data);\n        set.delete(data);\n      }\n    });\n    if (item.parent == null) {\n      this.data.children.push(node);\n      node.parent = this.data;\n    } else if (this.data.children.length > 0) {\n      const pNode = DFS(this.data, parent);\n      if (pNode && !pNode.children.some((child) => child.value === node.value)) {\n        pNode.children.push(node);\n      } else {\n        this.cache.add(node);\n      }\n    } else {\n      this.cache.add(node);\n    }\n  }\n\n  select(val: MenuValue) {\n    const activeValues = getTreePaths(this.data, val, []) || [];\n\n    activeValues.push(val);\n    return activeValues.filter((val) => val != null);\n  }\n\n  expand(val: MenuValue) {\n    if (this.expandValues.has(val)) {\n      this.expandValues.delete(val);\n      return [...this.expandValues];\n    }\n\n    this.expandValues.add(val);\n\n    if (!this.isMutex.value) {\n      return [...this.expandValues];\n    }\n\n    const sameParentNodes = getTreeSameParentNodes(this.data, val) || [];\n    const sameLevelSubmenuValues = new Set(\n      sameParentNodes.filter((node) => node.children?.length > 0 && node.value !== val).map((child) => child.value),\n    );\n\n    this.expandValues.forEach((val) => {\n      const isHit = sameLevelSubmenuValues.has(val);\n      if (isHit) {\n        this.expandValues.delete(val);\n      }\n    });\n    return [...this.expandValues];\n  }\n\n  getChild(value: MenuValue) {\n    const target = DFS(this.data, value);\n\n    return target ? target.children : [];\n  }\n}\n"],"names":["getTreePaths","node","val","ans","i","children","length","child","value","target","getTreeSameParentNodes","DFS","root","len","res","VMenu","options","Set","ref","parent","data","isMutex","expandValues","item","vnode","cache","forEach","v2","set","push","pNode","some","add","activeValues","filter","has","sameParentNodes","sameLevelSubmenuValues","map","isHit"],"mappings":";;;;;;;;;;;;AAkBA,IAAMA,YAAe,GAAA,SAAfA,YAAe,CAACC,IAAiB,EAAAC,GAAA,EAAgBC,GAAkC,EAAA;EACvF,IAAI,CAACF,IAAA,EAAM,OAAA;AACX,EAAA,KAAA,IAASG,IAAI,CAAG,EAAAA,CAAA,GAAIH,KAAKI,QAAS,CAAAC,MAAA,EAAQ,EAAEF,CAAG,EAAA;AACvC,IAAA,IAAAG,KAAA,GAAQN,KAAKI,QAAS,CAAAD,CAAA,CAAA,CAAA;IAC5B,IAAIG,MAAMC,KAAU,KAAAN,GAAA,EAAK,OAAA,EAAA,CAAA,MAAA,CAAA,kBAAA,CAAWC,GAAK,CAAA,EAAA,CAAAF,IAAA,CAAKO,KAAK,CAAA,CAAA,CAAA;AAC7C,IAAA,IAAAC,MAAA,GAAST,aAAaO,KAAO,EAAAL,GAAA,EAAA,EAAA,CAAA,MAAA,CAAA,kBAAA,CAASC,GAAA,CAAA,EAAA,CAAKF,IAAK,CAAAO,KAAK,CAAC,CAAA,CAAA,CAAA;IACxD,IAAAC,MAAA,EAAe,OAAAA,MAAA,CAAA;AACrB,GAAA;AACF,CAAA,CAAA;AAEA,IAAMC,sBAAA,GAAyB,SAAzBA,sBAAA,CAA0BT,IAAA,EAAiBC,GAAgC,EAAA;AAC/E,EAAA,IAAI,CAACD,IAAA,EAAM,OAAO,EAAC,CAAA;AACnB,EAAA,KAAA,IAASG,IAAI,CAAG,EAAAA,CAAA,GAAIH,KAAKI,QAAS,CAAAC,MAAA,EAAQ,EAAEF,CAAG,EAAA;AACvC,IAAA,IAAAG,KAAA,GAAQN,KAAKI,QAAS,CAAAD,CAAA,CAAA,CAAA;IAC5B,IAAIG,MAAMC,KAAU,KAAAN,GAAA,EAAK,OAAOD,IAAK,CAAAI,QAAA,CAAA;AAC/B,IAAA,IAAAI,MAAA,GAASC,sBAAuB,CAAAH,KAAA,EAAOL,GAAG,CAAA,CAAA;IAC5C,IAAAO,MAAA,EAAe,OAAAA,MAAA,CAAA;AACrB,GAAA;AACF,CAAA,CAAA;AAEA,IAAME,GAAA,GAAM,SAANA,GAAA,CAAOC,IAAA,EAAiBV,GAA8B,EAAA;AAC1D,EAAA,IAAIU,KAAKJ,KAAU,KAAAN,GAAA,EAAY,OAAAU,IAAA,CAAA;AAC3B,EAAA,IAAAA,IAAA,CAAKP,QAAS,CAAAC,MAAA,GAAS,CAAG,EAAA;AACnB,IAAA,KAAA,IAAAF,CAAA,GAAI,GAAGS,GAAM,GAAAD,IAAA,CAAKP,SAASC,MAAQ,EAAAF,CAAA,GAAIS,KAAKT,CAAK,EAAA,EAAA;AACxD,MAAA,IAAMU,GAAM,GAAAH,GAAA,CAAIC,IAAK,CAAAP,QAAA,CAASD,IAAIF,GAAG,CAAA,CAAA;MACjC,IAAAY,GAAA,EAAY,OAAAA,GAAA,CAAA;AAClB,KAAA;AACF,GAAA;AACF,CAAA,CAAA;AAAA,IAEqBC,KAAM,gBAAA,YAAA;AASzB,EAAA,SAAA,KAAA,CAAYC,OAA8B,EAAA;AAAA,IAAA,eAAA,CAAA,IAAA,EAAA,KAAA,CAAA,CAAA;AAAA,IAAA,eAAA,CAAA,IAAA,EAAA,MAAA,EARxB,IAAA,CAAA,CAAA;IAAA,eAEM,CAAA,IAAA,EAAA,OAAA,qBAAIC,GAAI,EAAA,CAAA,CAAA;IAAA,eAEtBC,CAAAA,IAAAA,EAAAA,SAAAA,EAAAA,IAAI,KAAK,CAAA,CAAA,CAAA;AAAA,IAAA,eAAA,CAAA,IAAA,EAAA,cAAA,EAEY,IAAA,CAAA,CAAA;AAG7B,IAAA,IAAMN,IAAkB,GAAA;AACtBJ,MAAAA,KAAO,EAAA,IAAA;AACPW,MAAAA,MAAQ,EAAA,IAAA;AACRd,MAAAA,UAAU,EAAA;KACZ,CAAA;IACA,IAAA,CAAKe,IAAO,GAAAR,IAAA,CAAA;IACZ,IAAA,CAAKS,UAAUL,OAAS,aAATA,OAAS,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAATA,OAAS,CAAAK,OAAA,CAAA;AACxB,IAAA,IAAA,CAAKC,YAAe,GAAA,IAAIL,GAAI,CAAAD,OAAA,KAAA,IAAA,IAAAA,OAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAAA,OAAA,CAASM,YAAY,CAAA,CAAA;AACnD,GAAA;AAAA,EAAA,YAAA,CAAA,KAAA,EAAA,CAAA;AAAA,IAAA,GAAA,EAAA,KAAA;IAAA,KAEA,EAAA,SAAA,GAAA,CAAIC,IAAiB,EAAA;AACnB,MAAA,IAAQf,KAAA,GAAyBe,IAAA,CAAzBf,KAAA;QAAOW,MAAQ,GAAUI,IAAA,CAAlBJ,MAAQ;QAAAK,KAAA,GAAUD,IAAA,CAAVC,KAAA,CAAA;AACvB,MAAA,IAAMvB,IAAkB,GAAA;AACtBO,QAAAA,KAAA,EAAAA,KAAA;AACAW,QAAAA,MAAA,EAAAA,MAAA;AACAd,QAAAA,UAAU,EAAC;AACXmB,QAAAA,KAAA,EAAAA,KAAAA;OACF,CAAA;MAEA,IAAA,CAAKC,KAAM,CAAAC,OAAA,CAAQ,UAACN,IAAA,EAAMO,IAAIC,GAAQ,EAAA;AAChC,QAAA,IAAAL,IAAA,CAAKf,KAAU,KAAAY,IAAA,CAAKD,MAAQ,EAAA;AACzBlB,UAAAA,IAAA,CAAAI,QAAA,CAASwB,KAAKT,IAAI,CAAA,CAAA;UACvBQ,GAAA,CAAA,QAAA,EAAWR,IAAI,CAAA,CAAA;AACjB,SAAA;AACF,OAAC,CAAA,CAAA;AACG,MAAA,IAAAG,IAAA,CAAKJ,UAAU,IAAM,EAAA;QAClB,IAAA,CAAAC,IAAA,CAAKf,QAAS,CAAAwB,IAAA,CAAK5B,IAAI,CAAA,CAAA;AAC5BA,QAAAA,IAAA,CAAKkB,SAAS,IAAK,CAAAC,IAAA,CAAA;OACV,MAAA,IAAA,IAAA,CAAKA,IAAK,CAAAf,QAAA,CAASC,SAAS,CAAG,EAAA;QACxC,IAAMwB,KAAQ,GAAAnB,GAAA,CAAI,IAAK,CAAAS,IAAA,EAAMD,MAAM,CAAA,CAAA;QAC/B,IAAAW,KAAA,IAAS,CAACA,KAAA,CAAMzB,QAAS,CAAA0B,IAAA,CAAK,UAACxB,KAAA,EAAA;AAAA,UAAA,OAAUA,KAAM,CAAAC,KAAA,KAAUP,IAAK,CAAAO,KAAK,CAAA;AAAA,SAAA,CAAG,EAAA;AAClEsB,UAAAA,KAAA,CAAAzB,QAAA,CAASwB,KAAK5B,IAAI,CAAA,CAAA;AAC1B,SAAO,MAAA;AACA,UAAA,IAAA,CAAAwB,KAAA,CAAMO,IAAI/B,IAAI,CAAA,CAAA;AACrB,SAAA;AACF,OAAO,MAAA;AACA,QAAA,IAAA,CAAAwB,KAAA,CAAMO,IAAI/B,IAAI,CAAA,CAAA;AACrB,OAAA;AACF,KAAA;AAAA,GAAA,EAAA;AAAA,IAAA,GAAA,EAAA,QAAA;IAAA,KAEA,EAAA,SAAA,MAAA,CAAOC,GAAgB,EAAA;AACf,MAAA,IAAA+B,YAAA,GAAejC,aAAa,IAAK,CAAAoB,IAAA,EAAMlB,KAAK,EAAE,KAAK,EAAC,CAAA;AAE1D+B,MAAAA,YAAA,CAAaJ,KAAK3B,GAAG,CAAA,CAAA;AACrB,MAAA,OAAO+B,YAAa,CAAAC,MAAA,CAAO,UAAChC,IAAAA,EAAAA;QAAAA,OAAQA,QAAO,IAAI,CAAA;OAAA,CAAA,CAAA;AACjD,KAAA;AAAA,GAAA,EAAA;AAAA,IAAA,GAAA,EAAA,QAAA;IAAA,KAEA,EAAA,SAAA,MAAA,CAAOA,GAAgB,EAAA;AAAA,MAAA,IAAA,KAAA,GAAA,IAAA,CAAA;MACrB,IAAI,IAAK,CAAAoB,YAAA,CAAaa,GAAI,CAAAjC,GAAG,CAAG,EAAA;AACzB,QAAA,IAAA,CAAAoB,YAAA,WAAoBpB,GAAG,CAAA,CAAA;QACrB,OAAI,kBAAA,CAAA,IAAA,CAAKoB,YAAY,CAAA,CAAA;AAC9B,OAAA;AAEK,MAAA,IAAA,CAAAA,YAAA,CAAaU,IAAI9B,GAAG,CAAA,CAAA;AAErB,MAAA,IAAA,CAAC,IAAK,CAAAmB,OAAA,CAAQb,KAAO,EAAA;QAChB,OAAI,kBAAA,CAAA,IAAA,CAAKc,YAAY,CAAA,CAAA;AAC9B,OAAA;MAEA,IAAMc,kBAAkB1B,sBAAuB,CAAA,IAAA,CAAKU,IAAM,EAAAlB,GAAG,KAAK,EAAC,CAAA;MACnE,IAAMmC,yBAAyB,IAAIpB,GAAA,CACjCmB,gBAAgBF,MAAO,CAAA,UAACjC,IAAS,EAAA;AAAA,QAAA,IAAA,cAAA,CAAA;AAAA,QAAA,OAAA,CAAAA,CAAAA,cAAAA,GAAAA,IAAA,CAAKI,2DAAL,cAAeC,CAAAA,MAAS,IAAA,CAAA,IAAKL,IAAK,CAAAO,KAAA,KAAUN,GAAG,CAAA;AAAA,OAAA,CAAE,CAAAoC,GAAA,CAAI,UAAC/B,KAAA,EAAA;QAAA,OAAUA,MAAMC,KAAK,CAAA;AAAA,OAAA,CAAA,CAC9G,CAAA;AAEK,MAAA,IAAA,CAAAc,YAAA,CAAaI,OAAQ,CAAA,UAACxB,IAAQ,EAAA;AAC3B,QAAA,IAAAqC,KAAA,GAAQF,sBAAuB,CAAAF,GAAA,CAAIjC,IAAG,CAAA,CAAA;AAC5C,QAAA,IAAIqC,KAAO,EAAA;AACJ,UAAA,KAAA,CAAAjB,YAAA,WAAoBpB,IAAG,CAAA,CAAA;AAC9B,SAAA;AACF,OAAC,CAAA,CAAA;MACM,OAAI,kBAAA,CAAA,IAAA,CAAKoB,YAAY,CAAA,CAAA;AAC9B,KAAA;AAAA,GAAA,EAAA;AAAA,IAAA,GAAA,EAAA,UAAA;IAAA,KAEA,EAAA,SAAA,QAAA,CAASd,KAAkB,EAAA;MACzB,IAAMC,MAAS,GAAAE,GAAA,CAAI,IAAK,CAAAS,IAAA,EAAMZ,KAAK,CAAA,CAAA;AAE5B,MAAA,OAAAC,MAAA,GAASA,MAAO,CAAAJ,QAAA,GAAW,EAAC,CAAA;AACrC,KAAA;AAAA,GAAA,CAAA,CAAA,CAAA;AAAA,EAAA,OAAA,KAAA,CAAA;AAAA,CAAA;;;;"}