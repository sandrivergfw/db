{"version":3,"file":"useSingleValue.js","sources":["../../../src/date-picker/hooks/useSingleValue.tsx"],"sourcesContent":["import { toRefs, watchEffect, ref, computed } from 'vue';\nimport dayjs from 'dayjs';\nimport { formatDate, formatTime, isValidDate, getDefaultFormat } from '../../_common/js/date-picker/format';\nimport useVModel from '../../hooks/useVModel';\nimport { TdDatePickerProps } from '../type';\nimport { extractTimeFormat } from '../../_common/js/date-picker/utils';\n\nexport default function useSingleValue(props: TdDatePickerProps) {\n  const { value: valueFromProps, modelValue } = toRefs(props);\n  const [value, onChange] = useVModel(valueFromProps, modelValue, props.defaultValue, props.onChange);\n\n  const formatRef = computed(() =>\n    getDefaultFormat({\n      mode: props.mode,\n      format: props.format,\n      enableTimePicker: props.enableTimePicker,\n    }),\n  );\n\n  if (props.enableTimePicker) {\n    if (!extractTimeFormat(formatRef.value.format))\n      console.error(`format: ${formatRef.value.format} 不规范，包含时间选择必须要有时间格式化 HH:mm:ss`);\n  }\n\n  const time = ref(formatTime(value.value, formatRef.value.timeFormat));\n  const month = ref<number>(dayjs(value.value).month() || new Date().getMonth());\n  const year = ref<number>(dayjs(value.value).year() || new Date().getFullYear());\n  const cacheValue = ref(formatDate(value.value, { format: formatRef.value.format })); // 缓存选中值，panel 点击时更改\n\n  // 输入框响应 value 变化\n  watchEffect(() => {\n    if (!value.value) {\n      cacheValue.value = '';\n      return;\n    }\n    if (!isValidDate(value.value, formatRef.value.format)) return;\n\n    cacheValue.value = formatDate(value.value, {\n      format: formatRef.value.format,\n    });\n    time.value = formatTime(value.value, formatRef.value.timeFormat);\n  });\n\n  return {\n    year,\n    month,\n    value,\n    time,\n    cacheValue,\n    onChange,\n  };\n}\n"],"names":["useSingleValue","props","toRefs","valueFromProps","value","modelValue","useVModel","defaultValue","onChange","formatRef","computed","getDefaultFormat","mode","format","enableTimePicker","extractTimeFormat","console","error","time","ref","formatTime","timeFormat","month","dayjs","Date","getMonth","year","getFullYear","cacheValue","formatDate","watchEffect","isValidDate"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAOA,SAAwBA,eAAeC,KAA0B,EAAA;EAC/D,IAA8CC,OAAAA,GAAAA,OAAOD,KAAK,CAAA;AAA3CE,IAAAA,cAAA,WAAPC,KAAO;AAAgBC,IAAAA,UAAW,WAAXA,UAAW,CAAA;AACpC,EAAA,IAAA,UAAA,GAAoBC,SAAA,CAAUH,gBAAgBE,UAAY,EAAAJ,KAAA,CAAMM,YAAc,EAAAN,KAAA,CAAMO,QAAQ,CAAA;AAAA,IAAA,WAAA,GAAA,cAAA,CAAA,UAAA,EAAA,CAAA,CAAA;IAA3FJ,KAAO,GAAA,WAAA,CAAA,CAAA,CAAA;IAAAI,QAAQ,GAAA,WAAA,CAAA,CAAA,CAAA,CAAA;EAEtB,IAAMC,SAAY,GAAAC,QAAA,CAAS,YAAA;AAAA,IAAA,OACzBC,gBAAiB,CAAA;MACfC,MAAMX,KAAM,CAAAW,IAAA;MACZC,QAAQZ,KAAM,CAAAY,MAAA;MACdC,kBAAkBb,KAAM,CAAAa,gBAAAA;AAC1B,KAAC,CAAA,CAAA;GACH,CAAA,CAAA;EAEA,IAAIb,MAAMa,gBAAkB,EAAA;AAC1B,IAAA,IAAI,CAACC,iBAAA,CAAkBN,SAAU,CAAAL,KAAA,CAAMS,MAAM,CAAA,EAC3CG,OAAA,CAAQC,KAAM,CAAWR,UAAAA,CAAAA,MAAAA,CAAAA,SAAU,CAAAL,KAAA,CAAMS,MAAqC,EAAA,8HAAA,CAAA,CAAA,CAAA;AAClF,GAAA;AAEM,EAAA,IAAAK,IAAA,GAAOC,IAAIC,UAAW,CAAAhB,KAAA,CAAMA,OAAOK,SAAU,CAAAL,KAAA,CAAMiB,UAAU,CAAC,CAAA,CAAA;EACpE,IAAMC,KAAQ,GAAAH,GAAA,CAAYI,KAAM,CAAAnB,KAAA,CAAMA,KAAK,CAAA,CAAEkB,KAAM,EAAA,IAAK,IAAIE,IAAA,EAAO,CAAAC,QAAA,EAAU,CAAA,CAAA;EAC7E,IAAMC,IAAO,GAAAP,GAAA,CAAYI,KAAM,CAAAnB,KAAA,CAAMA,KAAK,CAAA,CAAEsB,IAAK,EAAA,IAAK,IAAIF,IAAA,EAAO,CAAAG,WAAA,EAAa,CAAA,CAAA;EACxE,IAAAC,UAAA,GAAaT,GAAI,CAAAU,UAAA,CAAWzB,KAAM,CAAAA,KAAA,EAAO;AAAES,IAAAA,MAAA,EAAQJ,SAAU,CAAAL,KAAA,CAAMS,MAAAA;AAAO,GAAC,CAAC,CAAA,CAAA;AAGlFiB,EAAAA,WAAA,CAAY,YAAM;AACZ,IAAA,IAAA,CAAC1B,MAAMA,KAAO,EAAA;MAChBwB,UAAA,CAAWxB,KAAQ,GAAA,EAAA,CAAA;AACnB,MAAA,OAAA;AACF,KAAA;AACA,IAAA,IAAI,CAAC2B,WAAY,CAAA3B,KAAA,CAAMA,KAAO,EAAAK,SAAA,CAAUL,MAAMS,MAAM,CAAA,EAAG,OAAA;IAE5Ce,UAAA,CAAAxB,KAAA,GAAQyB,UAAW,CAAAzB,KAAA,CAAMA,KAAO,EAAA;AACzCS,MAAAA,MAAA,EAAQJ,UAAUL,KAAM,CAAAS,MAAAA;AAC1B,KAAC,CAAA,CAAA;AACDK,IAAAA,IAAA,CAAKd,QAAQgB,UAAW,CAAAhB,KAAA,CAAMA,KAAO,EAAAK,SAAA,CAAUL,MAAMiB,UAAU,CAAA,CAAA;AACjE,GAAC,CAAA,CAAA;EAEM,OAAA;AACLK,IAAAA,IAAA,EAAAA,IAAA;AACAJ,IAAAA,KAAA,EAAAA,KAAA;AACAlB,IAAAA,KAAA,EAAAA,KAAA;AACAc,IAAAA,IAAA,EAAAA,IAAA;AACAU,IAAAA,UAAA,EAAAA,UAAA;AACApB,IAAAA,QAAA,EAAAA,QAAAA;GACF,CAAA;AACF;;;;"}