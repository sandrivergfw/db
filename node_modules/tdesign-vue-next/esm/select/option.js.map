{"version":3,"file":"option.js","sources":["../../src/select/option.tsx"],"sourcesContent":["import { defineComponent, ref, computed, inject, onMounted, onBeforeUnmount } from 'vue';\n\nimport props from './option-props';\nimport Checkbox from '../checkbox/index';\n\n// hooks\nimport { useFormDisabled } from '../form/hooks';\nimport useRipple from '../hooks/useRipple';\nimport { useContent } from '../hooks/tnode';\nimport { usePrefixClass, useCommonClassName } from '../hooks/useConfig';\nimport { selectInjectKey, getNewMultipleValue } from './helper';\nimport { SelectValue } from './type';\n\nexport default defineComponent({\n  name: 'TOption',\n\n  props: {\n    ...props,\n    createAble: Boolean,\n    multiple: Boolean,\n    index: Number,\n    rowIndex: Number,\n    trs: Map,\n    scrollType: String,\n    isVirtual: Boolean,\n    bufferSize: Number,\n    checkAll: Boolean,\n  },\n  emits: ['row-mounted'],\n\n  setup(props, context) {\n    const selectProvider = inject(selectInjectKey);\n    const formDisabled = useFormDisabled();\n\n    const optionNode = ref(null);\n\n    const disabled = computed(\n      () =>\n        formDisabled.value ||\n        (props.multiple &&\n          selectProvider.value.max <= (selectProvider.value.selectValue as SelectValue[]).length &&\n          selectProvider.value.max !== 0),\n    );\n\n    const renderContent = useContent();\n\n    const selectName = usePrefixClass('select');\n    const { STATUS, SIZE } = useCommonClassName();\n    const liRef = ref<HTMLElement>();\n\n    const isHover = ref(false);\n\n    const isSelected = computed(() => {\n      if (selectProvider.value.isCheckAll && !props.disabled) return true;\n      return !props.multiple\n        ? selectProvider.value.selectValue === props.value\n        : (selectProvider.value.selectValue as SelectValue[]).includes(props.value);\n    });\n\n    const isIndeterminate = computed(() => {\n      if (!props.checkAll) return false;\n      return selectProvider.value.indeterminate;\n    });\n\n    const classes = computed(() => [\n      `${selectName.value}-option`,\n      [SIZE.value[selectProvider.value.size]],\n      {\n        [STATUS.value.disabled]: disabled.value,\n        [STATUS.value.selected]: isSelected.value,\n        [`${selectName.value}-option__hover`]:\n          (isHover.value || selectProvider.value.hoverIndex === props.index) && !disabled.value && !isSelected.value,\n      },\n    ]);\n\n    const labelText = computed(() => props.label || props.value);\n\n    const handleClick = (e: MouseEvent | KeyboardEvent) => {\n      if (props.multiple || props.disabled) return;\n      e.stopPropagation();\n\n      if (props.createAble) {\n        selectProvider.value.handleCreate?.(props.value);\n        if (selectProvider.value.multiple) {\n          (selectProvider.value.selectValue as SelectValue[]).push(props.value);\n          selectProvider.value.handleValueChange(selectProvider.value.selectValue, {\n            selectedOptions: selectProvider.value.getSelectedOptions(),\n            trigger: 'check',\n            e,\n          });\n          return;\n        }\n      }\n\n      selectProvider.value.handleValueChange(props.value, {\n        selectedOptions: selectProvider.value.getSelectedOptions(props.value),\n        trigger: 'check',\n        e,\n      });\n      selectProvider.value.handlePopupVisibleChange(false, { e });\n    };\n\n    const handleCheckboxClick = (val: boolean, context: { e: MouseEvent | KeyboardEvent }) => {\n      if (props.checkAll) {\n        selectProvider.value.onCheckAllChange(val);\n        return;\n      }\n      const newValue = getNewMultipleValue(selectProvider.value.selectValue as SelectValue[], props.value);\n      selectProvider.value.handleValueChange(newValue.value, {\n        selectedOptions: selectProvider.value.getSelectedOptions(newValue.value),\n        trigger: val ? 'check' : 'uncheck',\n        e: context.e,\n      });\n      if (!selectProvider.value.reserveKeyword) {\n        selectProvider.value.handlerInputChange('');\n      }\n    };\n\n    // 处理虚拟滚动节点挂载\n    onMounted(() => {\n      const { trs, rowIndex, isVirtual } = props;\n      if (isVirtual) {\n        trs.set(rowIndex, liRef.value);\n        context.emit('row-mounted');\n      }\n    });\n\n    // 处理虚拟滚动节点移除\n    onBeforeUnmount(() => {\n      if (props.isVirtual) {\n        const { trs, rowIndex } = props;\n        trs.delete(rowIndex);\n      }\n    });\n\n    useRipple(liRef);\n\n    return () => {\n      const optionChild = renderContent('default', 'content') || labelText.value;\n\n      return (\n        <li\n          ref={liRef}\n          class={classes.value}\n          title={`${labelText.value}`}\n          onMouseenter={() => (isHover.value = true)}\n          onMouseleave={() => (isHover.value = false)}\n          onClick={handleClick}\n        >\n          {selectProvider && props.multiple ? (\n            <Checkbox\n              checked={isSelected.value}\n              disabled={disabled.value && !isSelected.value}\n              onChange={handleCheckboxClick}\n              indeterminate={isIndeterminate.value}\n            >\n              {optionChild}\n            </Checkbox>\n          ) : (\n            <span>{optionChild}</span>\n          )}\n        </li>\n      );\n    };\n  },\n});\n"],"names":["_isVNode","defineComponent","name","props","createAble","Boolean","multiple","index","Number","rowIndex","trs","Map","scrollType","String","isVirtual","bufferSize","checkAll","emits","setup","context","selectProvider","inject","selectInjectKey","formDisabled","useFormDisabled","optionNode","ref","disabled","computed","value","max","selectValue","length","renderContent","useContent","selectName","usePrefixClass","useCommonClassName","STATUS","SIZE","liRef","isHover","isSelected","isCheckAll","includes","isIndeterminate","indeterminate","classes","size","selected","hoverIndex","labelText","label","handleClick","e","stopPropagation","handleCreate","push","handleValueChange","selectedOptions","getSelectedOptions","trigger","handlePopupVisibleChange","handleCheckboxClick","val","onCheckAllChange","newValue","getNewMultipleValue","reserveKeyword","handlerInputChange","onMounted","set","emit","onBeforeUnmount","useRipple","optionChild","_createVNode"],"mappings":"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"}