{"version":3,"file":"useTreeSelect.js","sources":["../../../src/table/hooks/useTreeSelect.tsx"],"sourcesContent":["import { computed, toRefs, ref, Ref, watch } from 'vue';\nimport get from 'lodash/get';\nimport intersection from 'lodash/intersection';\nimport { TdEnhancedTableProps, TdPrimaryTableProps, TableRowData, PrimaryTableCol } from '../type';\nimport { KeysType, TableTreeDataMap, TreeDataMapType } from '../../_common/js/table/tree-store';\nimport useDefaultValue from '../../hooks/useDefaultValue';\n\nexport interface GetChildrenDataReturnValue {\n  allChildren: Array<any>;\n  allChildrenKeys: Array<string | number>;\n  leafNodeKeys: Array<string | number>;\n}\n\n// 保存子节点信息，避免重复计算\nexport const childrenMap = new Map();\n\nexport function getChildrenData(\n  treeDataMap: TreeDataMapType,\n  data: TableRowData,\n  keys: { childrenKey: string; rowKey: string },\n  r?: GetChildrenDataReturnValue,\n): GetChildrenDataReturnValue {\n  if (childrenMap.get(data)) return childrenMap.get(data);\n  const result = r || { allChildren: [], allChildrenKeys: [], leafNodeKeys: [] };\n  const children = get(data, keys.childrenKey);\n  if (!children || !children.length) return result;\n  const selectableChildren = children.filter(\n    (item: TableRowData) => !treeDataMap.get(get(item, keys.rowKey))?.disabled,\n  );\n  result.allChildren = [...new Set(result.allChildren.concat(selectableChildren))];\n  for (let i = 0, len = children.length; i < len; i++) {\n    const tItem = children[i];\n    const c = get(tItem, keys.childrenKey);\n    if (c?.length) {\n      const nextLevelData = getChildrenData(treeDataMap, tItem, keys, result);\n      result.allChildren = [...new Set(result.allChildren.concat(nextLevelData.allChildren))];\n    }\n  }\n  // 避免使用 forEach，减少上下文消耗\n  for (let i = 0, len = result.allChildren.length; i < len; i++) {\n    const item = result.allChildren[i];\n    const children = get(item, keys.childrenKey);\n    const rowValue = get(item, keys.rowKey);\n    result.allChildrenKeys.push(rowValue);\n    if (!children || !children.length) {\n      result.leafNodeKeys.push(rowValue);\n    }\n  }\n  result.allChildrenKeys = [...new Set(result.allChildrenKeys)];\n  result.leafNodeKeys = [...new Set(result.leafNodeKeys)];\n  return result;\n}\n\nexport interface RemoveParams {\n  // 当前选中的数据\n  selectedRowKeys: Array<string | number>;\n  // 需要移除的数据\n  removeKeys: Array<string | number>;\n}\n\nexport interface RemainData {\n  data: Array<any>;\n  keys: Array<string | number>;\n}\n\nexport function removeChildrenKeys(p: RemoveParams, r?: RemainData): RemainData {\n  const { selectedRowKeys, removeKeys } = p;\n  const result = r || { data: [], keys: [] };\n  for (let i = 0, len = selectedRowKeys.length; i < len; i++) {\n    const key = selectedRowKeys[i];\n    if (!removeKeys.includes(key)) {\n      result.keys.push(key);\n    }\n  }\n  return result;\n}\n\nexport interface GetKeyDataParams {\n  treeDataMap: TreeDataMapType;\n  data: Array<any>;\n  column: PrimaryTableCol;\n  keys: KeysType;\n}\n\nexport interface GetRowDataParams {\n  treeDataMap: TreeDataMapType;\n  selectedRowKeys: Array<string | number>;\n}\n\nexport function getRowDataByKeys(p: GetRowDataParams) {\n  const { treeDataMap, selectedRowKeys } = p;\n  const result = [];\n  for (let i = 0, len = selectedRowKeys.length; i < len; i++) {\n    const key = selectedRowKeys[i];\n    result.push(treeDataMap.get(key));\n  }\n  return result;\n}\n\ntype SelectChangeParams = Parameters<TdPrimaryTableProps['onSelectChange']>;\n\nexport default function useTreeSelect(props: TdEnhancedTableProps, treeDataMap: Ref<TableTreeDataMap>) {\n  const { selectedRowKeys, tree, data, indeterminateSelectedRowKeys } = toRefs(props);\n  // 半选状态的节点：子节点选中至少一个，且没有全部选中\n  const tIndeterminateSelectedRowKeys = ref<(string | number)[]>([]);\n\n  const [tSelectedRowKeys, setTSelectedRowKeys] = useDefaultValue(\n    selectedRowKeys,\n    props.defaultSelectedRowKeys || [],\n    props.onSelectChange,\n    'selectedRowKeys',\n  );\n  const rowDataKeys = computed(() => ({\n    rowKey: props.rowKey || 'id',\n    childrenKey: props.tree?.childrenKey || 'children',\n  }));\n\n  watch([tree, treeDataMap, data, tSelectedRowKeys], ([tree, treeDataMap]) => {\n    if (!tree || !treeDataMap.size || tree.checkStrictly) return;\n    updateIndeterminateState();\n  });\n\n  function updateIndeterminateState() {\n    if (!tree.value || tree.value.checkStrictly) return;\n    if (!tSelectedRowKeys.value.length) {\n      tIndeterminateSelectedRowKeys.value = [];\n      return;\n    }\n    const keys: Array<string | number> = [];\n    const parentMap: { [key: string | number]: any[] } = {};\n    for (let i = 0, len = tSelectedRowKeys.value.length; i < len; i++) {\n      const rowValue = tSelectedRowKeys.value[i];\n      const state = treeDataMap.value.get(rowValue);\n      const children = get(state.row, rowDataKeys.value.childrenKey);\n      // 根据选中的叶子结点计算父节点半选状态\n      if (!children || !children.length) {\n        let parentTmp = state.parent;\n        while (parentTmp) {\n          if (!parentMap[parentTmp.id]) {\n            parentMap[parentTmp.id] = [];\n          }\n          parentMap[parentTmp.id].push(state.row);\n          const checkedLength = parentMap[parentTmp.id].length;\n          const { allChildrenKeys } = getChildrenData(treeDataMap.value, parentTmp.row, rowDataKeys.value);\n          const parentTmpIndex = keys.indexOf(parentTmp.id);\n          const selectedIndex = tSelectedRowKeys.value.indexOf(parentTmp.id);\n          if (checkedLength > 0 && checkedLength < allChildrenKeys.length && selectedIndex === -1) {\n            parentTmpIndex === -1 && keys.push(parentTmp.id);\n          } else {\n            parentTmpIndex !== -1 && keys.splice(parentTmpIndex, 1);\n          }\n          parentTmp = parentTmp.parent;\n        }\n      }\n    }\n    tIndeterminateSelectedRowKeys.value = keys;\n  }\n\n  function updateParentCheckedState(\n    selectedKeys: (string | number)[],\n    currentRowKey: string | number,\n    type: 'check' | 'uncheck',\n  ) {\n    if (!tree.value || tree.value.checkStrictly) return;\n    const keys = [...selectedKeys];\n    const state = treeDataMap.value.get(currentRowKey);\n    let parentTmp = state.parent;\n    while (parentTmp) {\n      const { leafNodeKeys } = getChildrenData(treeDataMap.value, parentTmp.row, rowDataKeys.value);\n      const checkedChildrenKeys = intersection(leafNodeKeys, selectedKeys);\n      const selectedIndex = keys.indexOf(parentTmp.id);\n      if (type === 'uncheck') {\n        selectedIndex !== -1 && keys.splice(selectedIndex, 1);\n      } else if (checkedChildrenKeys.length === leafNodeKeys.length) {\n        selectedIndex === -1 && keys.push(parentTmp.id);\n      }\n      parentTmp = parentTmp.parent;\n    }\n    return keys;\n  }\n\n  function onInnerSelectChange(rowKeys: SelectChangeParams[0], extraData: SelectChangeParams[1]) {\n    if (!tree.value || tree.value.checkStrictly) {\n      setTSelectedRowKeys(rowKeys, extraData);\n      return;\n    }\n    if (extraData.currentRowKey === 'CHECK_ALL_BOX') {\n      handleSelectAll(extraData);\n    } else {\n      handleSelect(rowKeys, extraData);\n    }\n  }\n\n  function handleSelectAll(extraData: SelectChangeParams[1]) {\n    const newRowKeys: Array<string | number> = [];\n    const newRowData: TableRowData[] = [];\n    if (extraData.type === 'check') {\n      const arr = [...treeDataMap.value.values()];\n      for (let i = 0, len = arr.length; i < len; i++) {\n        const item = arr[i];\n        if (!item.disabled) {\n          newRowData.push(item.row);\n          newRowKeys.push(get(item.row, rowDataKeys.value.rowKey));\n        }\n      }\n    }\n    const newExtraData = {\n      ...extraData,\n      selectedRowData: newRowData || [],\n    };\n    setTSelectedRowKeys(newRowKeys, newExtraData);\n  }\n\n  function handleSelect(rowKeys: SelectChangeParams[0], extraData: SelectChangeParams[1]) {\n    let newRowKeys = [...rowKeys];\n    if (props.tree?.checkStrictly === false) {\n      if (extraData?.type === 'check') {\n        const result = getChildrenData(treeDataMap.value, extraData.currentRowData, rowDataKeys.value);\n        const { allChildrenKeys } = result;\n        childrenMap.set(extraData.currentRowData, result);\n        newRowKeys = [...new Set(newRowKeys.concat(allChildrenKeys))];\n      } else if (extraData?.type === 'uncheck') {\n        const children = getChildrenData(treeDataMap.value, extraData.currentRowData, rowDataKeys.value);\n        const result = removeChildrenKeys({\n          selectedRowKeys: rowKeys,\n          removeKeys: children.allChildrenKeys,\n        });\n        newRowKeys = result.keys;\n      }\n    }\n    newRowKeys = updateParentCheckedState(newRowKeys, extraData.currentRowKey, extraData.type);\n    const newRowData = getRowDataByKeys({ treeDataMap: treeDataMap.value, selectedRowKeys: newRowKeys });\n    const newExtraData = {\n      ...extraData,\n      selectedRowData: newRowData,\n    };\n    setTSelectedRowKeys(newRowKeys, newExtraData);\n  }\n\n  return {\n    // 如果存在受控属性 indeterminateSelectedRowKeys 则优先使用；否则使用内部状态：tIndeterminateSelectedRowKeys\n    tIndeterminateSelectedRowKeys: indeterminateSelectedRowKeys.value\n      ? indeterminateSelectedRowKeys\n      : tIndeterminateSelectedRowKeys,\n    onInnerSelectChange,\n  };\n}\n"],"names":["childrenMap","Map","getChildrenData","treeDataMap","data","keys","r","get","result","allChildren","allChildrenKeys","leafNodeKeys","children","childrenKey","length","selectableChildren","filter","item","rowKey","disabled","Set","concat","i","len","tItem","c","nextLevelData","rowValue","push","removeChildrenKeys","p","selectedRowKeys","removeKeys","key","includes","getRowDataByKeys","useTreeSelect","props","toRefs","tree","indeterminateSelectedRowKeys","tIndeterminateSelectedRowKeys","ref","useDefaultValue","defaultSelectedRowKeys","onSelectChange","tSelectedRowKeys","setTSelectedRowKeys","rowDataKeys","computed","watch","size","checkStrictly","updateIndeterminateState","value","parentMap","state","row","parentTmp","parent","id","checkedLength","parentTmpIndex","indexOf","selectedIndex","splice","updateParentCheckedState","selectedKeys","currentRowKey","type","checkedChildrenKeys","intersection","onInnerSelectChange","rowKeys","extraData","handleSelectAll","handleSelect","newRowKeys","newRowData","arr","values","newExtraData","selectedRowData","currentRowData","set"],"mappings":";;;;;;;;;;;;;;;;;IAcaA,WAAA,sBAAkBC,GAAI,GAAA;AAE5B,SAASC,eACd,CAAAC,WAAA,EACAC,IACA,EAAAC,IAAA,EACAC,CAC4B,EAAA;AACxB,EAAA,IAAAN,WAAA,CAAYO,IAAIH,IAAI,CAAA,EAAU,OAAAJ,WAAA,CAAYO,IAAIH,IAAI,CAAA,CAAA;EAChD,IAAAI,MAAA,GAASF,CAAK,IAAA;AAAEG,IAAAA,WAAa,EAAA,EAAI;AAAAC,IAAAA,eAAA,EAAiB,EAAC;AAAGC,IAAAA,YAAc,EAAA,EAAA;GAAG,CAAA;EAC7E,IAAMC,QAAW,GAAAL,GAAA,CAAIH,IAAM,EAAAC,IAAA,CAAKQ,WAAW,CAAA,CAAA;EACvC,IAAA,CAACD,QAAY,IAAA,CAACA,QAAS,CAAAE,MAAA,EAAe,OAAAN,MAAA,CAAA;AAC1C,EAAA,IAAMO,qBAAqBH,QAAS,CAAAI,MAAA,CAClC,UAACC,IAAuB,EAAA;AAAA,IAAA,IAAA,gBAAA,CAAA;AAAA,IAAA,OAAA,sBAACd,WAAY,CAAAI,GAAA,CAAIA,IAAIU,IAAM,EAAAZ,IAAA,CAAKa,MAAM,CAAC,CAAG,MAAA,IAAA,IAAA,gBAAA,KAAA,KAAA,CAAA,IAAzC,iBAAyCC,QAAA,CAAA,CAAA;GACpE,CAAA,CAAA;AACOX,EAAAA,MAAA,CAAAC,WAAA,GAAkB,kBAAA,CAAA,IAAIW,GAAA,CAAIZ,OAAOC,WAAY,CAAAY,MAAA,CAAON,kBAAkB,CAAC,CAAC,CAAA,CAAA;AAC/E,EAAA,KAAA,IAASO,IAAI,CAAG,EAAAC,GAAA,GAAMX,SAASE,MAAQ,EAAAQ,CAAA,GAAIC,KAAKD,CAAK,EAAA,EAAA;AACnD,IAAA,IAAME,QAAQZ,QAAS,CAAAU,CAAA,CAAA,CAAA;IACvB,IAAMG,CAAI,GAAAlB,GAAA,CAAIiB,KAAO,EAAAnB,IAAA,CAAKQ,WAAW,CAAA,CAAA;AACrC,IAAA,IAAIY,MAAAA,IAAAA,IAAAA,gBAAAA,EAAGX,MAAQ,EAAA;MACb,IAAMY,aAAgB,GAAAxB,eAAA,CAAgBC,WAAa,EAAAqB,KAAA,EAAOnB,MAAMG,MAAM,CAAA,CAAA;AAC/DA,MAAAA,MAAA,CAAAC,WAAA,GAAA,kBAAA,CAAkB,IAAIW,GAAA,CAAIZ,MAAO,CAAAC,WAAA,CAAYY,MAAO,CAAAK,aAAA,CAAcjB,WAAW,CAAC,CAAC,CAAA,CAAA;AACxF,KAAA;AACF,GAAA;AAES,EAAA,KAAA,IAAAa,EAAA,GAAI,GAAGC,IAAM,GAAAf,MAAA,CAAOC,YAAYK,MAAQ,EAAAQ,EAAA,GAAIC,MAAKD,EAAK,EAAA,EAAA;AACvD,IAAA,IAAAL,IAAA,GAAOT,OAAOC,WAAY,CAAAa,EAAA,CAAA,CAAA;IAChC,IAAMV,SAAW,GAAAL,GAAA,CAAIU,IAAM,EAAAZ,IAAA,CAAKQ,WAAW,CAAA,CAAA;IAC3C,IAAMc,QAAW,GAAApB,GAAA,CAAIU,IAAM,EAAAZ,IAAA,CAAKa,MAAM,CAAA,CAAA;AAC/BV,IAAAA,MAAA,CAAAE,eAAA,CAAgBkB,KAAKD,QAAQ,CAAA,CAAA;AACpC,IAAA,IAAI,CAACf,SAAAA,IAAY,CAACA,SAAAA,CAASE,MAAQ,EAAA;AAC1BN,MAAAA,MAAA,CAAAG,YAAA,CAAaiB,KAAKD,QAAQ,CAAA,CAAA;AACnC,KAAA;AACF,GAAA;EACAnB,MAAA,CAAOE,qCAAsB,IAAIU,GAAI,CAAAZ,MAAA,CAAOE,eAAe,CAAC,CAAA,CAAA;EAC5DF,MAAA,CAAOG,kCAAmB,IAAIS,GAAI,CAAAZ,MAAA,CAAOG,YAAY,CAAC,CAAA,CAAA;AAC/C,EAAA,OAAAH,MAAA,CAAA;AACT,CAAA;AAcgB,SAAAqB,kBAAA,CAAmBC,GAAiBxB,CAA4B,EAAA;AACxE,EAAA,IAAEyB,eAAiB,GAAeD,CAAA,CAAhCC,eAAiB;IAAAC,UAAA,GAAeF,CAAA,CAAfE,UAAA,CAAA;EACnB,IAAAxB,MAAA,GAASF,KAAK;AAAEF,IAAAA,IAAA,EAAM,EAAI;AAAAC,IAAAA,IAAA,EAAM,EAAA;GAAG,CAAA;AACzC,EAAA,KAAA,IAASiB,IAAI,CAAG,EAAAC,GAAA,GAAMQ,gBAAgBjB,MAAQ,EAAAQ,CAAA,GAAIC,KAAKD,CAAK,EAAA,EAAA;AAC1D,IAAA,IAAMW,MAAMF,eAAgB,CAAAT,CAAA,CAAA,CAAA;AAC5B,IAAA,IAAI,CAACU,UAAA,CAAWE,QAAS,CAAAD,GAAG,CAAG,EAAA;AACtBzB,MAAAA,MAAA,CAAAH,IAAA,CAAKuB,KAAKK,GAAG,CAAA,CAAA;AACtB,KAAA;AACF,GAAA;AACO,EAAA,OAAAzB,MAAA,CAAA;AACT,CAAA;AAcO,SAAS2B,iBAAiBL,CAAqB,EAAA;AAC9C,EAAA,IAAE3B,WAAa,GAAoB2B,CAAA,CAAjC3B,WAAa;IAAA4B,eAAA,GAAoBD,CAAA,CAApBC,eAAA,CAAA;EACrB,IAAMvB,SAAS,EAAC,CAAA;AAChB,EAAA,KAAA,IAASc,IAAI,CAAG,EAAAC,GAAA,GAAMQ,gBAAgBjB,MAAQ,EAAAQ,CAAA,GAAIC,KAAKD,CAAK,EAAA,EAAA;AAC1D,IAAA,IAAMW,MAAMF,eAAgB,CAAAT,CAAA,CAAA,CAAA;IAC5Bd,MAAA,CAAOoB,IAAK,CAAAzB,WAAA,CAAYI,GAAI,CAAA0B,GAAG,CAAC,CAAA,CAAA;AAClC,GAAA;AACO,EAAA,OAAAzB,MAAA,CAAA;AACT,CAAA;AAIwB,SAAA4B,aAAA,CAAcC,OAA6BlC,WAAoC,EAAA;EACrG,IAAsEmC,OAAAA,GAAAA,OAAOD,KAAK,CAAA;AAA1EN,IAAAA,eAAiB,WAAjBA,eAAiB;AAAAQ,IAAAA,IAAA,WAAAA,IAAA;AAAMnC,IAAAA,eAAAA;AAAMoC,IAAAA,4BAA6B,WAA7BA,4BAA6B,CAAA;AAE5D,EAAA,IAAAC,6BAAA,GAAgCC,GAAyB,CAAA,EAAE,CAAA,CAAA;AAE3D,EAAA,IAAA,gBAAA,GAA0CC,eAAA,CAC9CZ,eAAA,EACAM,KAAA,CAAMO,0BAA0B,EAAC,EACjCP,KAAM,CAAAQ,cAAA,EACN,iBAAA,CACF;AAAA,IAAA,iBAAA,GAAA,cAAA,CAAA,gBAAA,EAAA,CAAA,CAAA;IALOC,gBAAkB,GAAA,iBAAA,CAAA,CAAA,CAAA;IAAAC,mBAAmB,GAAA,iBAAA,CAAA,CAAA,CAAA,CAAA;EAMtC,IAAAC,WAAA,GAAcC,SAAS,YAAA;AAAA,IAAA,IAAA,WAAA,CAAA;IAAA,OAAO;AAClC/B,MAAAA,MAAA,EAAQmB,MAAMnB,MAAU,IAAA,IAAA;MACxBL,WAAA,EAAa,gBAAAwB,KAAM,CAAAE,IAAA,MAAN,IAAA,IAAA,WAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,WAAA,CAAY1B,WAAe,KAAA,UAAA;KACxC,CAAA;AAAA,GAAA,CAAA,CAAA;EAEIqC,KAAA,CAAA,CAACX,IAAM,EAAApC,WAAA,EAAaC,IAAM,EAAA0C,gBAAgB,GAAG,UAAyB,IAAA,EAAA;AAAA,IAAA,IAAA,KAAA,GAAA,cAAA,CAAA,IAAA,EAAA,CAAA,CAAA;MAAvBP,KAAMpC,GAAAA,KAAAA,CAAAA,CAAAA,CAAAA;MAAAA,YAAW,GAAA,KAAA,CAAA,CAAA,CAAA,CAAA;IACpE,IAAI,CAACoC,KAAAA,IAAQ,CAACpC,YAAAA,CAAYgD,QAAQZ,KAAK,CAAAa,aAAA,EAAe,OAAA;AAC7BC,IAAAA,wBAAA,EAAA,CAAA;AAC3B,GAAC,CAAA,CAAA;AAED,EAAA,SAASA,wBAA2B,GAAA;IAClC,IAAI,CAACd,IAAA,CAAKe,KAAS,IAAAf,IAAA,CAAKe,KAAM,CAAAF,aAAA,EAAe,OAAA;AACzC,IAAA,IAAA,CAACN,gBAAiB,CAAAQ,KAAA,CAAMxC,MAAQ,EAAA;MAClC2B,6BAAA,CAA8Ba,QAAQ,EAAC,CAAA;AACvC,MAAA,OAAA;AACF,KAAA;IACA,IAAMjD,OAA+B,EAAC,CAAA;IACtC,IAAMkD,YAA+C,EAAC,CAAA;AAC7C,IAAA,KAAA,IAAAjC,CAAA,GAAI,GAAGC,GAAM,GAAAuB,gBAAA,CAAiBQ,MAAMxC,MAAQ,EAAAQ,CAAA,GAAIC,KAAKD,CAAK,EAAA,EAAA;AAC3D,MAAA,IAAAK,QAAA,GAAWmB,iBAAiBQ,KAAM,CAAAhC,CAAA,CAAA,CAAA;MACxC,IAAMkC,KAAQ,GAAArD,WAAA,CAAYmD,KAAM,CAAA/C,GAAA,CAAIoB,QAAQ,CAAA,CAAA;AAC5C,MAAA,IAAMf,WAAWL,GAAI,CAAAiD,KAAA,CAAMC,GAAK,EAAAT,WAAA,CAAYM,MAAMzC,WAAW,CAAA,CAAA;AAE7D,MAAA,IAAI,CAACD,QAAA,IAAY,CAACA,QAAA,CAASE,MAAQ,EAAA;AACjC,QAAA,IAAI4C,YAAYF,KAAM,CAAAG,MAAA,CAAA;AACtB,QAAA,OAAOD,SAAW,EAAA;AACZ,UAAA,IAAA,CAACH,SAAU,CAAAG,SAAA,CAAUE,EAAK,CAAA,EAAA;AAClBL,YAAAA,SAAA,CAAAG,SAAA,CAAUE,MAAM,EAAC,CAAA;AAC7B,WAAA;UACAL,SAAA,CAAUG,SAAU,CAAAE,EAAA,CAAA,CAAIhC,IAAK,CAAA4B,KAAA,CAAMC,GAAG,CAAA,CAAA;UAChC,IAAAI,aAAA,GAAgBN,SAAU,CAAAG,SAAA,CAAUE,EAAI,CAAA,CAAA9C,MAAA,CAAA;AACxC,UAAA,IAAA,gBAAA,GAAsBZ,eAAA,CAAgBC,YAAYmD,KAAO,EAAAI,SAAA,CAAUD,GAAK,EAAAT,WAAA,CAAYM,KAAK,CAAA;AAAvF5C,YAAAA,mCAAAA;UACR,IAAMoD,cAAiB,GAAAzD,IAAA,CAAK0D,OAAQ,CAAAL,SAAA,CAAUE,EAAE,CAAA,CAAA;UAChD,IAAMI,aAAgB,GAAAlB,gBAAA,CAAiBQ,KAAM,CAAAS,OAAA,CAAQL,UAAUE,EAAE,CAAA,CAAA;AACjE,UAAA,IAAIC,gBAAgB,CAAK,IAAAA,aAAA,GAAgBnD,eAAgB,CAAAI,MAAA,IAAUkD,kBAAkB,CAAI,CAAA,EAAA;YACvFF,cAAA,KAAmB,CAAM,CAAA,IAAAzD,IAAA,CAAKuB,IAAK,CAAA8B,SAAA,CAAUE,EAAE,CAAA,CAAA;AACjD,WAAO,MAAA;YACLE,cAAA,KAAmB,CAAM,CAAA,IAAAzD,IAAA,CAAK4D,MAAO,CAAAH,cAAA,EAAgB,CAAC,CAAA,CAAA;AACxD,WAAA;UACAJ,SAAA,GAAYA,SAAU,CAAAC,MAAA,CAAA;AACxB,SAAA;AACF,OAAA;AACF,KAAA;IACAlB,6BAAA,CAA8Ba,KAAQ,GAAAjD,IAAA,CAAA;AACxC,GAAA;AAES,EAAA,SAAA6D,wBAAA,CACPC,YACA,EAAAC,aAAA,EACAC,IACA,EAAA;IACA,IAAI,CAAC9B,IAAA,CAAKe,KAAS,IAAAf,IAAA,CAAKe,KAAM,CAAAF,aAAA,EAAe,OAAA;IACvC,IAAA/C,IAAA,GAAW8D,kBAAAA,CAAAA,YAAY,CAAA,CAAA;IAC7B,IAAMX,KAAQ,GAAArD,WAAA,CAAYmD,KAAM,CAAA/C,GAAA,CAAI6D,aAAa,CAAA,CAAA;AACjD,IAAA,IAAIV,YAAYF,KAAM,CAAAG,MAAA,CAAA;AACtB,IAAA,OAAOD,SAAW,EAAA;AACV,MAAA,IAAA,iBAAA,GAAmBxD,eAAA,CAAgBC,YAAYmD,KAAO,EAAAI,SAAA,CAAUD,GAAK,EAAAT,WAAA,CAAYM,KAAK,CAAA;AAApF3C,QAAAA,iCAAAA;AACF,MAAA,IAAA2D,mBAAA,GAAsBC,YAAa,CAAA5D,YAAA,EAAcwD,YAAY,CAAA,CAAA;MACnE,IAAMH,aAAgB,GAAA3D,IAAA,CAAK0D,OAAQ,CAAAL,SAAA,CAAUE,EAAE,CAAA,CAAA;MAC/C,IAAIS,SAAS,SAAW,EAAA;QACtBL,aAAA,KAAkB,CAAM,CAAA,IAAA3D,IAAA,CAAK4D,MAAO,CAAAD,aAAA,EAAe,CAAC,CAAA,CAAA;OAC3C,MAAA,IAAAM,mBAAA,CAAoBxD,MAAW,KAAAH,YAAA,CAAaG,MAAQ,EAAA;QAC7DkD,aAAA,KAAkB,CAAM,CAAA,IAAA3D,IAAA,CAAKuB,IAAK,CAAA8B,SAAA,CAAUE,EAAE,CAAA,CAAA;AAChD,OAAA;MACAF,SAAA,GAAYA,SAAU,CAAAC,MAAA,CAAA;AACxB,KAAA;AACO,IAAA,OAAAtD,IAAA,CAAA;AACT,GAAA;AAES,EAAA,SAAAmE,mBAAA,CAAoBC,SAAgCC,SAAkC,EAAA;IAC7F,IAAI,CAACnC,IAAA,CAAKe,KAAS,IAAAf,IAAA,CAAKe,MAAMF,aAAe,EAAA;AAC3CL,MAAAA,mBAAA,CAAoB0B,SAASC,SAAS,CAAA,CAAA;AACtC,MAAA,OAAA;AACF,KAAA;AACI,IAAA,IAAAA,SAAA,CAAUN,kBAAkB,eAAiB,EAAA;MAC/CO,eAAA,CAAgBD,SAAS,CAAA,CAAA;AAC3B,KAAO,MAAA;AACLE,MAAAA,YAAA,CAAaH,SAASC,SAAS,CAAA,CAAA;AACjC,KAAA;AACF,GAAA;EAEA,SAASC,gBAAgBD,SAAkC,EAAA;IACzD,IAAMG,aAAqC,EAAC,CAAA;IAC5C,IAAMC,aAA6B,EAAC,CAAA;AAChC,IAAA,IAAAJ,SAAA,CAAUL,SAAS,OAAS,EAAA;MAC9B,IAAMU,yBAAU5E,WAAY,CAAAmD,KAAA,CAAM0B,QAAQ,CAAA,CAAA;AAC1C,MAAA,KAAA,IAAS1D,IAAI,CAAG,EAAAC,GAAA,GAAMwD,IAAIjE,MAAQ,EAAAQ,CAAA,GAAIC,KAAKD,CAAK,EAAA,EAAA;AAC9C,QAAA,IAAML,OAAO8D,GAAI,CAAAzD,CAAA,CAAA,CAAA;AACb,QAAA,IAAA,CAACL,KAAKE,QAAU,EAAA;AACP2D,UAAAA,UAAA,CAAAlD,IAAA,CAAKX,KAAKwC,GAAG,CAAA,CAAA;AACxBoB,UAAAA,UAAA,CAAWjD,KAAKrB,GAAI,CAAAU,IAAA,CAAKwC,KAAKT,WAAY,CAAAM,KAAA,CAAMpC,MAAM,CAAC,CAAA,CAAA;AACzD,SAAA;AACF,OAAA;AACF,KAAA;IACA,IAAM+D,YAAe,mCAChBP,SAAA,CAAA,EAAA,EAAA,EAAA;MACHQ,eAAA,EAAiBJ,cAAc,EAAA;KACjC,CAAA,CAAA;AACA/B,IAAAA,mBAAA,CAAoB8B,YAAYI,YAAY,CAAA,CAAA;AAC9C,GAAA;AAES,EAAA,SAAAL,YAAA,CAAaH,SAAgCC,SAAkC,EAAA;AAAA,IAAA,IAAA,YAAA,CAAA;IAClF,IAAAG,UAAA,GAAiBJ,kBAAAA,CAAAA,OAAO,CAAA,CAAA;IACxB,IAAA,CAAA,CAAA,YAAA,GAAApC,KAAA,CAAME,IAAM,iDAAZ,YAAYa,CAAAA,aAAA,MAAkB,KAAO,EAAA;MACnC,IAAA,CAAAsB,SAAA,KAAA,IAAA,IAAAA,SAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAAA,SAAA,CAAWL,UAAS,OAAS,EAAA;AAC/B,QAAA,IAAM7D,SAASN,eAAgB,CAAAC,WAAA,CAAYmD,OAAOoB,SAAU,CAAAS,cAAA,EAAgBnC,YAAYM,KAAK,CAAA,CAAA;AACvF,QAAA,IAAE5C,kBAAoBF,MAAA,CAApBE;QACIV,WAAA,CAAAoF,GAAA,CAAIV,SAAU,CAAAS,cAAA,EAAgB3E,MAAM,CAAA,CAAA;QACnCqE,UAAA,GAAA,kBAAA,CAAI,IAAIzD,GAAA,CAAIyD,WAAWxD,MAAO,CAAAX,eAAe,CAAC,CAAC,CAAA,CAAA;AAC9D,OAAA,MAAA,IAAW,CAAAgE,SAAW,KAAXA,IAAAA,IAAAA,SAAW,KAAXA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,SAAW,CAAAL,IAAA,MAAS,SAAW,EAAA;AACxC,QAAA,IAAMzD,WAAWV,eAAgB,CAAAC,WAAA,CAAYmD,OAAOoB,SAAU,CAAAS,cAAA,EAAgBnC,YAAYM,KAAK,CAAA,CAAA;QAC/F,IAAM9C,UAASqB,kBAAmB,CAAA;AAChCE,UAAAA,eAAiB,EAAA0C,OAAA;UACjBzC,YAAYpB,QAAS,CAAAF,eAAAA;AACvB,SAAC,CAAA,CAAA;QACDmE,UAAA,GAAarE,OAAO,CAAAH,IAAA,CAAA;AACtB,OAAA;AACF,KAAA;AACAwE,IAAAA,UAAA,GAAaX,wBAAyB,CAAAW,UAAA,EAAYH,SAAU,CAAAN,aAAA,EAAeM,UAAUL,IAAI,CAAA,CAAA;IACnF,IAAAS,UAAA,GAAa3C,iBAAiB;MAAEhC,WAAA,EAAaA,YAAYmD,KAAO;AAAAvB,MAAAA,eAAA,EAAiB8C,UAAAA;AAAW,KAAC,CAAA,CAAA;IACnG,IAAMI,YAAe,mCAChBP,SAAA,CAAA,EAAA,EAAA,EAAA;AACHQ,MAAAA,eAAiB,EAAAJ,UAAAA;KACnB,CAAA,CAAA;AACA/B,IAAAA,mBAAA,CAAoB8B,YAAYI,YAAY,CAAA,CAAA;AAC9C,GAAA;EAEO,OAAA;AAELxC,IAAAA,6BAAA,EAA+BD,4BAA6B,CAAAc,KAAA,GACxDd,4BACA,GAAAC,6BAAA;AACJ+B,IAAAA,mBAAA,EAAAA,mBAAAA;GACF,CAAA;AACF;;;;"}