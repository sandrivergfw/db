{"version":3,"file":"image.js","sources":["../../src/image/image.tsx"],"sourcesContent":["import { defineComponent, ref, onMounted, computed, onUnmounted } from 'vue';\nimport omit from 'lodash/omit';\nimport observe from '../_common/js/utils/observe';\nimport { useConfig } from '../config-provider/useConfig';\nimport { useTNodeDefault } from '../hooks/tnode';\nimport { TdImageProps } from './type';\nimport props from './props';\n\nexport default defineComponent({\n  name: 'TImage',\n  props,\n  setup(props: TdImageProps) {\n    const imageRef = ref<HTMLElement>(null);\n    let io: IntersectionObserver = null;\n\n    onMounted(() => {\n      if (!props.lazy || !imageRef.value) return;\n\n      const ioObserver = observe(imageRef.value, null, handleLoadImage, 0);\n      io = ioObserver;\n    });\n\n    onUnmounted(() => {\n      imageRef.value && io && io.unobserve(imageRef.value);\n    });\n\n    const { classPrefix } = useConfig();\n\n    const shouldLoad = ref(!props.lazy);\n    const handleLoadImage = () => {\n      shouldLoad.value = true;\n    };\n\n    const isLoaded = ref(false);\n    const handleLoad = () => {\n      isLoaded.value = true;\n      props.onLoad?.();\n    };\n\n    const hasError = ref(false);\n    const handleError = () => {\n      hasError.value = true;\n      props.onError?.();\n    };\n\n    const hasMouseEvent = computed(() => {\n      return props.overlayTrigger === 'hover';\n    });\n\n    const shouldShowOverlay = ref(!hasMouseEvent.value);\n    const handleToggleOverlay = () => {\n      if (hasMouseEvent.value) {\n        shouldShowOverlay.value = !shouldShowOverlay.value;\n      }\n    };\n\n    const renderPlaceholder = () => {\n      if (!props.placeholder) {\n        return null;\n      }\n      return <div class={`${classPrefix.value}-image__placeholder`}>{props.placeholder}</div>;\n    };\n    const renderGalleryShadow = () => {\n      if (!props.gallery) return null;\n      return <div class={`${classPrefix.value}-image__gallery-shadow`} />;\n    };\n    const renderOverlay = () => {\n      if (!props.overlayContent) return null;\n      return (\n        <div\n          class={[\n            `${classPrefix.value}-image__overlay-content`,\n            !shouldShowOverlay.value && `${classPrefix.value}-image__overlay-content--hidden`,\n          ]}\n        >\n          {props.overlayContent}\n        </div>\n      );\n    };\n\n    const renderTNodDefault = useTNodeDefault();\n\n    return () => (\n      <div\n        ref={imageRef}\n        class={[\n          `${classPrefix.value}-image__wrapper`,\n          `${classPrefix.value}-image__wrapper--shape-${props.shape}`,\n          props.gallery && `${classPrefix.value}-image__wrapper--gallery`,\n          hasMouseEvent.value && `${classPrefix.value}-image__wrapper--need-hover`,\n        ]}\n        onMouseenter={handleToggleOverlay}\n        onMouseleave={handleToggleOverlay}\n        {...omit(props, [\n          'src',\n          'alt',\n          'fit',\n          'position',\n          'shape',\n          'placeholder',\n          'loading',\n          'error',\n          'overlayTrigger',\n          'overlayContent',\n          'lazy',\n          'gallery',\n          'onLoad',\n          'onError',\n        ])}\n      >\n        {renderPlaceholder()}\n        {renderGalleryShadow()}\n\n        {(hasError.value || !shouldLoad.value) && <div class={`${classPrefix.value}-image`} />}\n        {!(hasError.value || !shouldLoad.value) && (\n          <img\n            src={props.src}\n            onError={handleError}\n            onLoad={handleLoad}\n            class={[\n              `${classPrefix.value}-image`,\n              `${classPrefix.value}-image--fit-${props.fit}`,\n              `${classPrefix.value}-image--position-${props.position}`,\n            ]}\n            alt={props.alt}\n          />\n        )}\n        {!(hasError.value || !shouldLoad.value) && !isLoaded.value && (\n          <div class={`${classPrefix.value}-image__loading`}>\n            {props.loading || (\n              <div direction=\"vertical\" size={8} align=\"center\">\n                图片加载中\n              </div>\n            )}\n          </div>\n        )}\n\n        {hasError.value && (\n          <div class={`${classPrefix.value}-image__error`}>\n            {renderTNodDefault(\n              'error',\n              <div direction=\"vertical\" size={8} align=\"center\">\n                图片无法显示\n              </div>,\n            )}\n          </div>\n        )}\n\n        {renderOverlay()}\n      </div>\n    );\n  },\n});\n"],"names":["defineComponent","name","props","setup","imageRef","ref","io","onMounted","lazy","value","ioObserver","observe","handleLoadImage","onUnmounted","unobserve","useConfig","classPrefix","shouldLoad","isLoaded","handleLoad","onLoad","hasError","handleError","onError","hasMouseEvent","computed","overlayTrigger","shouldShowOverlay","handleToggleOverlay","renderPlaceholder","placeholder","_createVNode","renderGalleryShadow","gallery","renderOverlay","overlayContent","renderTNodDefault","useTNodeDefault","_mergeProps","shape","omit","src","fit","position","alt","loading"],"mappings":"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"}