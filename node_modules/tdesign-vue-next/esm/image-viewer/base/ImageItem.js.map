{"version":3,"file":"ImageItem.js","sources":["../../../src/image-viewer/base/ImageItem.tsx"],"sourcesContent":["import { computed, defineComponent, ref, watch } from 'vue';\nimport { ImageErrorIcon } from 'tdesign-icons-vue-next';\nimport { usePrefixClass } from '../../hooks/useConfig';\nimport { useDrag } from '../hooks';\n\nexport default defineComponent({\n  name: 'TImageItem',\n  props: {\n    rotate: Number,\n    scale: Number,\n    mirror: Number,\n    src: String,\n    placementSrc: String,\n  },\n  setup(props) {\n    const classPrefix = usePrefixClass();\n    const error = ref(false);\n    const loaded = ref(false);\n    const { transform, mouseDownHandler } = useDrag({ translateX: 0, translateY: 0 });\n\n    const imgStyle = computed(() => ({\n      transform: `rotate(${props.rotate}deg) scale(${props.scale})`,\n      display: !props.placementSrc || loaded.value ? 'block' : 'none',\n    }));\n    const placementImgStyle = computed(() => ({\n      transform: `rotate(${props.rotate}deg) scale(${props.scale})`,\n      display: !loaded.value ? 'block' : 'none',\n    }));\n    const boxStyle = computed(() => {\n      const { translateX, translateY } = transform.value;\n      return {\n        transform: `translate(${translateX}px, ${translateY}px) scale(${props.mirror}, 1)`,\n      };\n    });\n\n    const resetStatus = () => {\n      error.value = false;\n      loaded.value = false;\n    };\n\n    watch(\n      () => props.src,\n      () => {\n        resetStatus();\n      },\n    );\n\n    return () => (\n      <div class={`${classPrefix.value}-image-viewer__modal-pic`}>\n        <div class={`${classPrefix.value}-image-viewer__modal-box`} style={boxStyle.value}>\n          {error.value && (\n            <div class={`${classPrefix.value}-image-viewer__img-error`}>\n              {/* 脱离文档流 */}\n              <div class={`${classPrefix.value}-image-viewer__img-error-content`}>\n                <ImageErrorIcon size=\"4em\" />\n                <div class={`${classPrefix.value}-image-viewer__img-error-text`}>图片加载失败，可尝试重新加载</div>\n              </div>\n            </div>\n          )}\n\n          {!error.value && !!props.placementSrc && (\n            <img\n              class={`${classPrefix.value}-image-viewer__modal-image`}\n              onMousedown={(event: MouseEvent) => {\n                event.stopPropagation();\n                mouseDownHandler(event);\n              }}\n              src={props.placementSrc}\n              style={placementImgStyle.value}\n              alt=\"image\"\n              draggable=\"false\"\n            />\n          )}\n\n          {!error.value && (\n            <img\n              class={`${classPrefix.value}-image-viewer__modal-image`}\n              onMousedown={(event: MouseEvent) => {\n                event.stopPropagation();\n                mouseDownHandler(event);\n              }}\n              src={props.src}\n              onLoad={() => (loaded.value = true)}\n              onError={() => (error.value = true)}\n              style={imgStyle.value}\n              alt=\"image\"\n              draggable=\"false\"\n            />\n          )}\n        </div>\n      </div>\n    );\n  },\n});\n"],"names":["defineComponent","name","props","rotate","Number","scale","mirror","src","String","placementSrc","setup","classPrefix","usePrefixClass","error","ref","loaded","useDrag","translateX","translateY","transform","mouseDownHandler","imgStyle","computed","display","value","placementImgStyle","boxStyle","resetStatus","watch","_createVNode","event","stopPropagation"],"mappings":"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"}