{"version":3,"file":"messageList.js","sources":["../../src/message/messageList.tsx"],"sourcesContent":["import { computed, defineComponent, ref } from 'vue';\nimport { PLACEMENT_OFFSET } from './const';\nimport TMessage from './message';\nimport { MessageOptions } from './type';\nimport { usePrefixClass } from '../hooks/useConfig';\n\nexport const DEFAULT_Z_INDEX = 6000;\n\nconst getUniqueId = (() => {\n  let id = 0;\n  return () => {\n    id += 1;\n    return id;\n  };\n})();\n\nexport const MessageList = defineComponent({\n  name: 'TMessageList',\n  props: {\n    zIndex: {\n      type: Number,\n      default: 0,\n    },\n    placement: {\n      type: String,\n      default: '',\n    },\n  },\n  setup(props, { expose }) {\n    const COMPONENT_NAME = usePrefixClass('message__list');\n    const list = ref([]);\n    const messageList = ref([]);\n\n    const styles = computed(() => ({\n      ...PLACEMENT_OFFSET[props.placement],\n      zIndex: props.zIndex !== DEFAULT_Z_INDEX ? props.zIndex : DEFAULT_Z_INDEX,\n    }));\n\n    const add = (msg: MessageOptions): number => {\n      const mg = { ...msg, key: getUniqueId() };\n      list.value.push(mg);\n      return list.value.length - 1;\n    };\n\n    const remove = (index: number) => {\n      list.value.splice(index, 1);\n    };\n\n    const removeAll = () => {\n      list.value = [];\n    };\n\n    const getOffset = (val: string | number) => {\n      if (!val) return;\n      return isNaN(Number(val)) ? val : `${val}px`;\n    };\n\n    const msgStyles = (item: { offset: Array<string | number> }) => {\n      return (\n        item.offset && {\n          position: 'relative',\n          left: getOffset(item.offset[0]),\n          top: getOffset(item.offset[1]),\n        }\n      );\n    };\n\n    const getProps = (index: number, item: MessageOptions) => {\n      return {\n        ...item,\n        onCloseBtnClick: (e: any) => {\n          if (item.onCloseBtnClick) {\n            item.onCloseBtnClick(e);\n          }\n          return remove(index);\n        },\n        onDurationEnd: () => {\n          if (item.onDurationEnd) {\n            item.onDurationEnd();\n          }\n          return remove(index);\n        },\n      };\n    };\n\n    const addChild = (el: Element) => {\n      if (el) {\n        messageList.value.push(el);\n      }\n    };\n\n    expose({ add, removeAll, list, messageList });\n\n    return () => {\n      if (!list.value.length) return;\n\n      return (\n        <div class={COMPONENT_NAME.value} style={styles.value}>\n          {list.value.map((item, index) => (\n            <TMessage key={item.key} style={msgStyles(item)} ref={addChild} {...getProps(index, item)} />\n          ))}\n        </div>\n      );\n    };\n  },\n});\n\nexport default MessageList;\n"],"names":["DEFAULT_Z_INDEX","getUniqueId","id","MessageList","defineComponent","name","props","zIndex","type","Number","placement","String","setup","expose","COMPONENT_NAME","usePrefixClass","list","ref","messageList","styles","computed","PLACEMENT_OFFSET","add","msg","mg","key","value","push","length","remove","index","splice","removeAll","getOffset","val","isNaN","msgStyles","item","offset","position","left","top","getProps","onCloseBtnClick","e","onDurationEnd","addChild","el","_createVNode","map","TMessage","_mergeProps"],"mappings":"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"}