{"version":3,"file":"calcTextareaHeight.js","sources":["../../src/textarea/calcTextareaHeight.ts"],"sourcesContent":["/**\n * Thanks to https://github.com/ElemeFE/element/blob/dev/packages/input/src/calcTextareaHeight.js\n */\ntype RowsType = number | null;\n\ntype ResultType = {\n  height?: string;\n  minHeight?: string;\n};\n\nlet hiddenTextarea: HTMLTextAreaElement;\n\nconst HIDDEN_TEXTAREA_STYLE = `\n  min-height:0 !important;\n  max-height:none !important;\n  height:0 !important;\n  visibility:hidden !important;\n  overflow:hidden !important;\n  position:absolute !important;\n  z-index:-1000 !important;\n  top:0 !important;\n  right:0 !important\n`;\n\nconst SIZING_PROPS = [\n  'letter-spacing',\n  'line-height',\n  'padding-top',\n  'padding-bottom',\n  'font-family',\n  'font-weight',\n  'font-size',\n  'font-variant',\n  'text-rendering',\n  'text-transform',\n  'width',\n  'text-indent',\n  'padding-left',\n  'padding-right',\n  'border-width',\n  'box-sizing',\n];\n\nfunction calculateNodeStyling(targetElement: HTMLTextAreaElement) {\n  const style = window.getComputedStyle(targetElement);\n\n  const boxSizing =\n    style.getPropertyValue('box-sizing') ||\n    style.getPropertyValue('-moz-box-sizing') ||\n    style.getPropertyValue('-webkit-box-sizing');\n\n  const paddingSize =\n    parseFloat(style.getPropertyValue('padding-bottom')) + parseFloat(style.getPropertyValue('padding-top'));\n\n  const borderSize =\n    parseFloat(style.getPropertyValue('border-bottom-width')) + parseFloat(style.getPropertyValue('border-top-width'));\n\n  const sizingStyle = SIZING_PROPS.map((name) => `${name}:${style.getPropertyValue(name)}`).join(';');\n\n  return {\n    sizingStyle,\n    paddingSize,\n    borderSize,\n    boxSizing,\n  };\n}\n\nexport default function calcTextareaHeight(\n  targetElement: HTMLTextAreaElement,\n  minRows: RowsType = 1,\n  maxRows: RowsType = null,\n) {\n  if (!hiddenTextarea) {\n    hiddenTextarea = document.createElement('textarea');\n    document.body.appendChild(hiddenTextarea);\n  }\n\n  const { paddingSize, borderSize, boxSizing, sizingStyle } = calculateNodeStyling(targetElement);\n\n  hiddenTextarea.setAttribute('style', `${sizingStyle};${HIDDEN_TEXTAREA_STYLE}`);\n  hiddenTextarea.value = targetElement.value || targetElement.placeholder || '';\n\n  let height = hiddenTextarea.scrollHeight;\n  const result: ResultType = {};\n\n  if (boxSizing === 'border-box') {\n    height += borderSize;\n  } else if (boxSizing === 'content-box') {\n    height -= paddingSize;\n  }\n\n  hiddenTextarea.value = '';\n  const singleRowHeight = hiddenTextarea.scrollHeight - paddingSize;\n\n  if (minRows !== null) {\n    let minHeight = singleRowHeight * minRows;\n    if (boxSizing === 'border-box') {\n      minHeight = minHeight + paddingSize + borderSize;\n    }\n    height = Math.max(minHeight, height);\n    result.minHeight = `${minHeight}px`;\n  }\n  if (maxRows !== null) {\n    let maxHeight = singleRowHeight * maxRows;\n    if (boxSizing === 'border-box') {\n      maxHeight = maxHeight + paddingSize + borderSize;\n    }\n    height = Math.min(maxHeight, height);\n  }\n  result.height = `${height}px`;\n  hiddenTextarea.parentNode && hiddenTextarea.parentNode.removeChild(hiddenTextarea);\n  hiddenTextarea = null;\n  return result;\n}\n"],"names":["hiddenTextarea","HIDDEN_TEXTAREA_STYLE","SIZING_PROPS","calculateNodeStyling","targetElement","style","window","getComputedStyle","boxSizing","getPropertyValue","paddingSize","parseFloat","borderSize","sizingStyle","map","name","join","calcTextareaHeight","minRows","maxRows","document","createElement","body","appendChild","setAttribute","value","placeholder","height","scrollHeight","result","singleRowHeight","minHeight","Math","max","maxHeight","min","parentNode","removeChild"],"mappings":"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"}