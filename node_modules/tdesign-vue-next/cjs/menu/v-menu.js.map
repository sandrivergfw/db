{"version":3,"file":"v-menu.js","sources":["../../src/menu/v-menu.ts"],"sourcesContent":["import { ref, Slot } from 'vue';\n\ntype MenuValue = string | number;\ntype MenuNode = MenuValue | VMenuData;\n\ninterface VMenuData {\n  value: MenuValue;\n  parent?: MenuNode;\n  children: VMenuData[];\n  vnode?: Slot;\n}\n\ninterface VMenuItem {\n  value?: MenuValue;\n  parent: MenuValue;\n  vnode?: Slot;\n}\n\nconst getTreePaths = (node: VMenuData, val: MenuValue, ans: MenuValue[]): MenuValue[] => {\n  if (!node) return;\n  for (let i = 0; i < node.children.length; ++i) {\n    const child = node.children[i];\n    if (child.value === val) return [...ans, node.value];\n    const target = getTreePaths(child, val, [...ans, node.value]);\n    if (target) return target;\n  }\n};\n\nconst getTreeSameParentNodes = (node: VMenuData, val: MenuValue): VMenuData[] => {\n  if (!node) return [];\n  for (let i = 0; i < node.children.length; ++i) {\n    const child = node.children[i];\n    if (child.value === val) return node.children;\n    const target = getTreeSameParentNodes(child, val);\n    if (target) return target;\n  }\n};\n\nconst DFS = (root: VMenuData, val: MenuValue): VMenuData => {\n  if (root.value === val) return root;\n  if (root.children.length > 0) {\n    for (let i = 0, len = root.children.length; i < len; i++) {\n      const res = DFS(root.children[i], val);\n      if (res) return res;\n    }\n  }\n};\n\nexport default class VMenu {\n  data: VMenuData = null;\n\n  cache: Set<VMenuData> = new Set();\n\n  isMutex = ref(false);\n\n  expandValues: Set<MenuValue> = null;\n\n  constructor(options: Record<string, any>) {\n    const root: VMenuData = {\n      value: null,\n      parent: null,\n      children: [],\n    };\n    this.data = root;\n    this.isMutex = options?.isMutex;\n    this.expandValues = new Set(options?.expandValues);\n  }\n\n  add(item: VMenuItem) {\n    const { value, parent, vnode } = item;\n    const node: VMenuData = {\n      value,\n      parent,\n      children: [],\n      vnode,\n    };\n\n    this.cache.forEach((data, v2, set) => {\n      if (item.value === data.parent) {\n        node.children.push(data);\n        set.delete(data);\n      }\n    });\n    if (item.parent == null) {\n      this.data.children.push(node);\n      node.parent = this.data;\n    } else if (this.data.children.length > 0) {\n      const pNode = DFS(this.data, parent);\n      if (pNode && !pNode.children.some((child) => child.value === node.value)) {\n        pNode.children.push(node);\n      } else {\n        this.cache.add(node);\n      }\n    } else {\n      this.cache.add(node);\n    }\n  }\n\n  select(val: MenuValue) {\n    const activeValues = getTreePaths(this.data, val, []) || [];\n\n    activeValues.push(val);\n    return activeValues.filter((val) => val != null);\n  }\n\n  expand(val: MenuValue) {\n    if (this.expandValues.has(val)) {\n      this.expandValues.delete(val);\n      return [...this.expandValues];\n    }\n\n    this.expandValues.add(val);\n\n    if (!this.isMutex.value) {\n      return [...this.expandValues];\n    }\n\n    const sameParentNodes = getTreeSameParentNodes(this.data, val) || [];\n    const sameLevelSubmenuValues = new Set(\n      sameParentNodes.filter((node) => node.children?.length > 0 && node.value !== val).map((child) => child.value),\n    );\n\n    this.expandValues.forEach((val) => {\n      const isHit = sameLevelSubmenuValues.has(val);\n      if (isHit) {\n        this.expandValues.delete(val);\n      }\n    });\n    return [...this.expandValues];\n  }\n\n  getChild(value: MenuValue) {\n    const target = DFS(this.data, value);\n\n    return target ? target.children : [];\n  }\n}\n"],"names":["getTreePaths","node","val","ans","i","children","length","child","value","_toConsumableArray","target","getTreeSameParentNodes","DFS","root","len","res","VMenu","options","_classCallCheck","_defineProperty","Set","ref","parent","data","isMutex","expandValues","_createClass","item","vnode","cache","forEach","v2","set","push","pNode","some","add","activeValues","filter","has","sameParentNodes","sameLevelSubmenuValues","map","isHit"],"mappings":"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"}