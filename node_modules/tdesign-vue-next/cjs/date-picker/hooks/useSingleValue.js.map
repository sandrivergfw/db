{"version":3,"file":"useSingleValue.js","sources":["../../../src/date-picker/hooks/useSingleValue.tsx"],"sourcesContent":["import { toRefs, watchEffect, ref, computed } from 'vue';\nimport dayjs from 'dayjs';\nimport { formatDate, formatTime, isValidDate, getDefaultFormat } from '../../_common/js/date-picker/format';\nimport useVModel from '../../hooks/useVModel';\nimport { TdDatePickerProps } from '../type';\nimport { extractTimeFormat } from '../../_common/js/date-picker/utils';\n\nexport default function useSingleValue(props: TdDatePickerProps) {\n  const { value: valueFromProps, modelValue } = toRefs(props);\n  const [value, onChange] = useVModel(valueFromProps, modelValue, props.defaultValue, props.onChange);\n\n  const formatRef = computed(() =>\n    getDefaultFormat({\n      mode: props.mode,\n      format: props.format,\n      enableTimePicker: props.enableTimePicker,\n    }),\n  );\n\n  if (props.enableTimePicker) {\n    if (!extractTimeFormat(formatRef.value.format))\n      console.error(`format: ${formatRef.value.format} 不规范，包含时间选择必须要有时间格式化 HH:mm:ss`);\n  }\n\n  const time = ref(formatTime(value.value, formatRef.value.timeFormat));\n  const month = ref<number>(dayjs(value.value).month() || new Date().getMonth());\n  const year = ref<number>(dayjs(value.value).year() || new Date().getFullYear());\n  const cacheValue = ref(formatDate(value.value, { format: formatRef.value.format })); // 缓存选中值，panel 点击时更改\n\n  // 输入框响应 value 变化\n  watchEffect(() => {\n    if (!value.value) {\n      cacheValue.value = '';\n      return;\n    }\n    if (!isValidDate(value.value, formatRef.value.format)) return;\n\n    cacheValue.value = formatDate(value.value, {\n      format: formatRef.value.format,\n    });\n    time.value = formatTime(value.value, formatRef.value.timeFormat);\n  });\n\n  return {\n    year,\n    month,\n    value,\n    time,\n    cacheValue,\n    onChange,\n  };\n}\n"],"names":["useSingleValue","props","toRefs","valueFromProps","value","modelValue","useVModel","defaultValue","onChange","_slicedToArray","formatRef","computed","getDefaultFormat","mode","format","enableTimePicker","extractTimeFormat","console","error","time","ref","formatTime","timeFormat","month","dayjs","Date","getMonth","year","getFullYear","cacheValue","formatDate","watchEffect","isValidDate"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAOA,SAAwBA,eAAeC,KAA0B,EAAA;EAC/D,IAA8CC,OAAAA,GAAAA,WAAOD,KAAK,CAAA;AAA3CE,IAAAA,cAAA,WAAPC,KAAO;AAAgBC,IAAAA,UAAW,WAAXA,UAAW,CAAA;AACpC,EAAA,IAAA,UAAA,GAAoBC,0BAAA,CAAUH,gBAAgBE,UAAY,EAAAJ,KAAA,CAAMM,YAAc,EAAAN,KAAA,CAAMO,QAAQ,CAAA;AAAA,IAAA,WAAA,GAAAC,kCAAA,CAAA,UAAA,EAAA,CAAA,CAAA;IAA3FL,KAAO,GAAA,WAAA,CAAA,CAAA,CAAA;IAAAI,QAAQ,GAAA,WAAA,CAAA,CAAA,CAAA,CAAA;EAEtB,IAAME,SAAY,GAAAC,YAAA,CAAS,YAAA;AAAA,IAAA,OACzBC,6CAAiB,CAAA;MACfC,MAAMZ,KAAM,CAAAY,IAAA;MACZC,QAAQb,KAAM,CAAAa,MAAA;MACdC,kBAAkBd,KAAM,CAAAc,gBAAAA;AAC1B,KAAC,CAAA,CAAA;GACH,CAAA,CAAA;EAEA,IAAId,MAAMc,gBAAkB,EAAA;AAC1B,IAAA,IAAI,CAACC,6CAAA,CAAkBN,SAAU,CAAAN,KAAA,CAAMU,MAAM,CAAA,EAC3CG,OAAA,CAAQC,KAAM,CAAWR,UAAAA,CAAAA,MAAAA,CAAAA,SAAU,CAAAN,KAAA,CAAMU,MAAqC,EAAA,8HAAA,CAAA,CAAA,CAAA;AAClF,GAAA;AAEM,EAAA,IAAAK,IAAA,GAAOC,QAAIC,uCAAW,CAAAjB,KAAA,CAAMA,OAAOM,SAAU,CAAAN,KAAA,CAAMkB,UAAU,CAAC,CAAA,CAAA;EACpE,IAAMC,KAAQ,GAAAH,OAAA,CAAYI,yBAAM,CAAApB,KAAA,CAAMA,KAAK,CAAA,CAAEmB,KAAM,EAAA,IAAK,IAAIE,IAAA,EAAO,CAAAC,QAAA,EAAU,CAAA,CAAA;EAC7E,IAAMC,IAAO,GAAAP,OAAA,CAAYI,yBAAM,CAAApB,KAAA,CAAMA,KAAK,CAAA,CAAEuB,IAAK,EAAA,IAAK,IAAIF,IAAA,EAAO,CAAAG,WAAA,EAAa,CAAA,CAAA;EACxE,IAAAC,UAAA,GAAaT,OAAI,CAAAU,uCAAA,CAAW1B,KAAM,CAAAA,KAAA,EAAO;AAAEU,IAAAA,MAAA,EAAQJ,SAAU,CAAAN,KAAA,CAAMU,MAAAA;AAAO,GAAC,CAAC,CAAA,CAAA;AAGlFiB,EAAAA,eAAA,CAAY,YAAM;AACZ,IAAA,IAAA,CAAC3B,MAAMA,KAAO,EAAA;MAChByB,UAAA,CAAWzB,KAAQ,GAAA,EAAA,CAAA;AACnB,MAAA,OAAA;AACF,KAAA;AACA,IAAA,IAAI,CAAC4B,wCAAY,CAAA5B,KAAA,CAAMA,KAAO,EAAAM,SAAA,CAAUN,MAAMU,MAAM,CAAA,EAAG,OAAA;IAE5Ce,UAAA,CAAAzB,KAAA,GAAQ0B,uCAAW,CAAA1B,KAAA,CAAMA,KAAO,EAAA;AACzCU,MAAAA,MAAA,EAAQJ,UAAUN,KAAM,CAAAU,MAAAA;AAC1B,KAAC,CAAA,CAAA;AACDK,IAAAA,IAAA,CAAKf,QAAQiB,uCAAW,CAAAjB,KAAA,CAAMA,KAAO,EAAAM,SAAA,CAAUN,MAAMkB,UAAU,CAAA,CAAA;AACjE,GAAC,CAAA,CAAA;EAEM,OAAA;AACLK,IAAAA,IAAA,EAAAA,IAAA;AACAJ,IAAAA,KAAA,EAAAA,KAAA;AACAnB,IAAAA,KAAA,EAAAA,KAAA;AACAe,IAAAA,IAAA,EAAAA,IAAA;AACAU,IAAAA,UAAA,EAAAA,UAAA;AACArB,IAAAA,QAAA,EAAAA,QAAAA;GACF,CAAA;AACF;;;;"}