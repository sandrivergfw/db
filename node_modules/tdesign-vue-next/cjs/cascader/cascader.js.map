{"version":3,"file":"cascader.js","sources":["../../src/cascader/cascader.tsx"],"sourcesContent":["import { defineComponent, computed } from 'vue';\nimport omit from 'lodash/omit';\nimport Panel from './components/Panel';\nimport SelectInput from '../select-input';\nimport FakeArrow from '../common-components/fake-arrow';\nimport props from './props';\n\nimport { useCascaderContext } from './hooks';\nimport { CascaderValue, TdSelectInputProps, TdCascaderProps } from './interface';\nimport { useConfig, usePrefixClass, useCommonClassName } from '../hooks/useConfig';\n\nimport { closeIconClickEffect, handleRemoveTagEffect } from './core/effect';\nimport { getPanels, getSingleContent, getMultipleContent } from './core/helper';\nimport { getFakeArrowIconClass } from './core/className';\nimport { useFormDisabled } from '../form/hooks';\n\nexport default defineComponent({\n  name: 'TCascader',\n\n  props: { ...props },\n\n  setup(props, { slots }) {\n    const disabled = useFormDisabled();\n    const COMPONENT_NAME = usePrefixClass('cascader');\n    const classPrefix = usePrefixClass();\n    const { STATUS } = useCommonClassName();\n    const overlayClassName = usePrefixClass('cascader__popup');\n    const { globalConfig } = useConfig('cascader');\n\n    // 拿到全局状态的上下文\n    const { cascaderContext, isFilterable } = useCascaderContext(props);\n\n    const displayValue = computed(() =>\n      props.multiple ? getMultipleContent(cascaderContext.value) : getSingleContent(cascaderContext.value),\n    );\n\n    const panels = computed(() => getPanels(cascaderContext.value.treeNodes));\n\n    const inputPlaceholder = computed(\n      () =>\n        (cascaderContext.value.visible && !props.multiple && getSingleContent(cascaderContext.value)) ||\n        (props.placeholder ?? globalConfig.value.placeholder),\n    );\n\n    const renderSuffixIcon = () => {\n      const { visible, disabled } = cascaderContext.value;\n      return (\n        <FakeArrow\n          overlayClassName={getFakeArrowIconClass(classPrefix.value, STATUS.value, cascaderContext.value)}\n          isActive={visible}\n          disabled={disabled}\n        />\n      );\n    };\n\n    return () => {\n      const { setVisible, visible, inputVal, setInputVal } = cascaderContext.value;\n\n      return (\n        <SelectInput\n          class={COMPONENT_NAME.value}\n          value={displayValue.value}\n          inputValue={visible ? inputVal : ''}\n          popupVisible={visible}\n          keys={props.keys}\n          allowInput={isFilterable.value}\n          min-collapsed-num={props.minCollapsedNum}\n          collapsed-items={props.collapsedItems}\n          readonly={props.readonly}\n          disabled={props.disabled}\n          clearable={props.clearable}\n          placeholder={inputPlaceholder.value}\n          multiple={props.multiple}\n          loading={props.loading}\n          status={props.status}\n          tips={props.tips}\n          suffixIcon={() => renderSuffixIcon()}\n          popupProps={{\n            ...(props.popupProps as TdCascaderProps['popupProps']),\n            overlayInnerStyle: panels.value.length && !props.loading ? { width: 'auto' } : '',\n            overlayClassName: [\n              overlayClassName.value,\n              (props.popupProps as TdCascaderProps['popupProps'])?.overlayClassName,\n            ],\n          }}\n          inputProps={{ size: props.size, ...(props.inputProps as TdCascaderProps['inputProps']) }}\n          tagInputProps={{\n            size: props.size,\n            ...(props.tagInputProps as TdCascaderProps['tagInputProps']),\n          }}\n          tagProps={{ ...(props.tagProps as TdCascaderProps['tagProps']) }}\n          onInputChange={(value, ctx) => {\n            if (!isFilterable.value) return;\n            setInputVal(`${value}`);\n            (props?.selectInputProps as TdSelectInputProps)?.onInputChange?.(value, ctx);\n          }}\n          onTagChange={(val: CascaderValue, ctx) => {\n            // 按 enter 键不处理\n            if (ctx.trigger === 'enter') return;\n            handleRemoveTagEffect(cascaderContext.value, ctx.index, props.onRemove);\n            (props?.selectInputProps as TdSelectInputProps)?.onTagChange?.(val, ctx);\n          }}\n          onPopupVisibleChange={(val: boolean, context) => {\n            if (disabled.value) return;\n            setVisible(val, context);\n            (props?.selectInputProps as TdSelectInputProps)?.onPopupVisibleChange?.(val, context);\n          }}\n          onBlur={(val, context) => {\n            props.onBlur?.({\n              value: cascaderContext.value.value,\n              e: context.e,\n            });\n            (props?.selectInputProps as TdSelectInputProps)?.onBlur?.(val, context);\n          }}\n          onFocus={(val, context) => {\n            props.onFocus?.({\n              value: cascaderContext.value.value,\n              e: context.e,\n            });\n            (props?.selectInputProps as TdSelectInputProps)?.onFocus?.(val, context);\n          }}\n          onClear={(context: { e: MouseEvent }) => {\n            closeIconClickEffect(cascaderContext.value);\n            (props?.selectInputProps as TdSelectInputProps)?.onClear?.(context);\n          }}\n          v-slots={{\n            panel: () => (\n              <Panel\n                empty={props.empty}\n                visible={visible}\n                trigger={props.trigger}\n                loading={props.loading}\n                loadingText={props.loadingText}\n                cascaderContext={cascaderContext.value}\n                v-slots={{ empty: slots.empty, loadingText: slots.loadingText }}\n              />\n            ),\n            collapsedItems: slots.collapsedItems,\n          }}\n          {...omit(props.selectInputProps as TdSelectInputProps, [\n            'onTagChange',\n            'onInputChange',\n            'onPopupVisibleChange',\n            'onBlur',\n            'onFocus',\n            'onClear',\n          ])}\n        />\n      );\n    };\n  },\n});\n"],"names":["defineComponent","name","props","setup","slots","disabled","useFormDisabled","COMPONENT_NAME","usePrefixClass","classPrefix","useCommonClassName","STATUS","overlayClassName","useConfig","globalConfig","useCascaderContext","cascaderContext","isFilterable","displayValue","computed","multiple","getMultipleContent","value","getSingleContent","panels","getPanels","treeNodes","inputPlaceholder","visible","placeholder","renderSuffixIcon","_createVNode","FakeArrow","getFakeArrowIconClass","setVisible","inputVal","setInputVal","SelectInput","_mergeProps","keys","minCollapsedNum","collapsedItems","readonly","clearable","loading","status","tips","popupProps","overlayInnerStyle","length","width","size","inputProps","tagInputProps","tagProps","ctx","selectInputProps","onInputChange","val","trigger","handleRemoveTagEffect","index","onRemove","onTagChange","context","onPopupVisibleChange","onBlur","e","onFocus","closeIconClickEffect","onClear","omit","panel","Panel","empty","loadingText"],"mappings":"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"}