{"version":3,"file":"usePanelVirtualScroll.js","sources":["../../../src/select/hooks/usePanelVirtualScroll.ts"],"sourcesContent":["import { Ref, computed, onMounted, onBeforeUnmount, toRefs } from 'vue';\nimport useVirtualScroll from '../../hooks/useVirtualScroll';\nimport { TdSelectProps } from '../type';\nimport { Styles } from '../../common';\n\nexport const usePanelVirtualScroll = (props: {\n  scroll: TdSelectProps['scroll'];\n  popupContentRef: Ref<HTMLElement>;\n  options: Ref<TdSelectProps['options']>;\n}) => {\n  const isVirtual = computed(\n    () => props.scroll?.type === 'virtual' && props.options.value?.length > (props.scroll?.threshold || 100),\n  );\n\n  const {\n    trs = null,\n    visibleData = null,\n    handleScroll: handleVirtualScroll = null,\n    scrollHeight = null,\n    translateY = null,\n    handleRowMounted = null,\n  } = props.scroll?.type === 'virtual'\n    ? useVirtualScroll({\n        container: props.popupContentRef,\n        data: props.options,\n        fixedHeight: props.scroll?.isFixedRowHeight || false,\n        lineHeight: props.scroll?.rowHeight || 28, // 默认每行高度28\n        bufferSize: props.scroll?.bufferSize || 20,\n        threshold: props.scroll?.threshold || 100,\n      })\n    : {};\n  let lastScrollY = -1;\n\n  const onInnerVirtualScroll = (e: WheelEvent) => {\n    if (!isVirtual.value) {\n      return;\n    }\n    const target = e.target as HTMLElement;\n    const top = target.scrollTop;\n    // 排除横向滚动出发的纵向虚拟滚动计算\n    if (Math.abs(lastScrollY - top) > 5) {\n      handleVirtualScroll();\n      lastScrollY = top;\n    } else {\n      lastScrollY = -1;\n    }\n  };\n\n  // 监听popup滚动 处理虚拟滚动时的virtualData变化\n  onMounted(() => {\n    if (isVirtual.value) {\n      props.popupContentRef.value?.addEventListener('scroll', onInnerVirtualScroll);\n    }\n  });\n\n  // 卸载时取消监听\n  onBeforeUnmount(() => {\n    if (isVirtual.value) {\n      props.popupContentRef.value?.removeEventListener('scroll', onInnerVirtualScroll);\n    }\n  });\n\n  const cursorStyle = computed(\n    () =>\n      ({\n        position: 'absolute',\n        width: '1px',\n        height: '1px',\n        transition: 'transform 0.2s',\n        transform: `translate(0, ${scrollHeight.value}px)`,\n        '-ms-transform': `translate(0, ${scrollHeight.value}px)`,\n        '-moz-transform': `translate(0, ${scrollHeight.value}px)`,\n        '-webkit-transform': `translate(0, ${scrollHeight.value}px)`,\n      } as Styles),\n  );\n\n  const panelStyle = computed(\n    () =>\n      ({\n        transform: `translate(0, ${translateY.value}px)`,\n        '-ms-transform': `translate(0, ${translateY.value}px)`,\n        '-moz-transform': `translate(0, ${translateY.value}px)`,\n        '-webkit-transform': `translate(0, ${translateY.value}px)`,\n      } as Styles),\n  );\n\n  return {\n    trs,\n    scrollHeight,\n    translateY,\n    visibleData,\n    handleRowMounted,\n    isVirtual,\n    cursorStyle,\n    panelStyle,\n  };\n};\n"],"names":["usePanelVirtualScroll","props","isVirtual","computed","scroll","type","options","value","length","threshold","useVirtualScroll","container","popupContentRef","data","fixedHeight","isFixedRowHeight","lineHeight","rowHeight","bufferSize","trs","visibleData","handleScroll","handleVirtualScroll","scrollHeight","translateY","handleRowMounted","lastScrollY","onInnerVirtualScroll","e","target","top","scrollTop","Math","abs","onMounted","addEventListener","onBeforeUnmount","removeEventListener","cursorStyle","position","width","height","transition","transform","panelStyle"],"mappings":"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"}