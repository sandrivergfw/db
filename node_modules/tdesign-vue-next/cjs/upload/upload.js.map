{"version":3,"file":"upload.js","sources":["../../src/upload/upload.tsx"],"sourcesContent":["import { computed, defineComponent } from 'vue';\nimport { UploadIcon } from 'tdesign-icons-vue-next';\nimport props from './props';\nimport NormalFile from './themes/normal-file';\nimport DraggerFile from './themes/dragger-file';\nimport ImageCard from './themes/image-card';\nimport MultipleFlowList from './themes/multiple-flow-list';\nimport useUpload from './hooks/useUpload';\nimport Button from '../button';\nimport { CommonDisplayFileProps, UploadProps } from './interface';\nimport { UploadDragEvents } from './hooks/useDrag';\nimport CustomFile from './themes/custom-file';\nimport { useContent } from '../hooks/tnode';\n\nexport default defineComponent({\n  name: 'TUpload',\n\n  props,\n\n  setup(props: UploadProps, { slots, expose }) {\n    const renderContent = useContent();\n    const {\n      locale,\n      classPrefix,\n      triggerUploadText,\n      toUploadFiles,\n      displayFiles,\n      uploadValue,\n      sizeOverLimitMessage,\n      uploading,\n      tipsClasses,\n      errorClasses,\n      inputRef,\n      disabled,\n      onInnerRemove,\n      uploadFiles,\n      onNormalFileChange,\n      onDragFileChange,\n      triggerUpload,\n      cancelUpload,\n    } = useUpload(props);\n\n    expose({\n      upload: inputRef.value,\n      uploading,\n      triggerUpload,\n      uploadFiles,\n      cancelUpload,\n    });\n\n    const renderTrigger = () => {\n      const getDefaultTrigger = () => {\n        if (props.theme === 'file-input') {\n          return (\n            <Button disabled={disabled.value} variant=\"outline\" {...props.triggerButtonProps}>\n              {triggerUploadText.value}\n            </Button>\n          );\n        }\n        return (\n          <Button disabled={disabled.value} variant=\"outline\" icon={() => <UploadIcon />} {...props.triggerButtonProps}>\n            {triggerUploadText.value}\n          </Button>\n        );\n      };\n      return renderContent('default', 'trigger') || getDefaultTrigger();\n    };\n\n    const commonDisplayFileProps = computed<CommonDisplayFileProps>(() => ({\n      files: uploadValue.value,\n      toUploadFiles: toUploadFiles.value,\n      displayFiles: displayFiles.value,\n      theme: props.theme,\n      placeholder: props.placeholder,\n      disabled: disabled.value,\n      tips: props.tips,\n      status: props.status,\n      sizeOverLimitMessage: sizeOverLimitMessage.value,\n      uploading: uploading.value,\n      classPrefix: classPrefix.value,\n      tipsClasses,\n      errorClasses,\n      locale: locale.value,\n      autoUpload: props.autoUpload,\n      abridgeName: props.abridgeName,\n      fileListDisplay: props.fileListDisplay,\n      onRemove: onInnerRemove,\n    }));\n\n    const dragProps: UploadDragEvents = {\n      onDragFileChange,\n      onDragenter: props.onDragenter,\n      onDragleave: props.onDragleave,\n      onDrop: props.onDrop,\n    };\n\n    const getNormalFileNode = () => (\n      <NormalFile\n        {...commonDisplayFileProps.value}\n        multiple={props.multiple}\n        v-slots={{ fileListDisplay: slots.fileListDisplay }}\n      >\n        <div class={`${classPrefix.value}-upload__trigger`} onClick={triggerUpload}>\n          {renderTrigger()}\n        </div>\n      </NormalFile>\n    );\n\n    const getSingleFileDraggerUploadNode = () => (\n      <DraggerFile\n        {...commonDisplayFileProps.value}\n        dragEvents={dragProps}\n        trigger={props.trigger}\n        cancelUpload={cancelUpload}\n        triggerUpload={triggerUpload}\n        uploadFiles={uploadFiles}\n      />\n    );\n\n    const getImageCardUploadNode = () => (\n      <ImageCard\n        {...commonDisplayFileProps.value}\n        multiple={props.multiple}\n        max={props.max}\n        showUploadProgress={props.showUploadProgress}\n        triggerUpload={triggerUpload}\n        uploadFiles={uploadFiles}\n        cancelUpload={cancelUpload}\n        onPreview={props.onPreview}\n      />\n    );\n\n    const getFlowListNode = () => (\n      <MultipleFlowList\n        {...commonDisplayFileProps.value}\n        isBatchUpload={props.isBatchUpload}\n        draggable={props.draggable}\n        dragEvents={dragProps}\n        uploadFiles={uploadFiles}\n        cancelUpload={cancelUpload}\n        onPreview={props.onPreview}\n        slots={Object.keys(slots).length ? slots : undefined}\n      >\n        <div class={`${classPrefix.value}-upload__trigger`} onClick={triggerUpload}>\n          {renderTrigger()}\n        </div>\n      </MultipleFlowList>\n    );\n\n    const getCustomFile = () => (\n      <CustomFile\n        {...commonDisplayFileProps.value}\n        draggable={props.draggable}\n        dragContent={props.dragContent}\n        dragEvents={dragProps}\n        triggerUpload={triggerUpload}\n        trigger={props.trigger}\n        childrenNode={slots.default}\n        v-slots={{\n          dragContent: slots.dragContent,\n          trigger: slots.trigger,\n        }}\n      >\n        {renderTrigger()}\n      </CustomFile>\n    );\n\n    return () => (\n      <div class={`${classPrefix.value}-upload`}>\n        <input\n          ref={inputRef}\n          type=\"file\"\n          disabled={disabled.value}\n          onChange={onNormalFileChange}\n          multiple={props.multiple}\n          accept={props.accept}\n          hidden\n        />\n        {['file', 'file-input'].includes(props.theme) && !props.draggable && getNormalFileNode()}\n        {['file', 'image'].includes(props.theme) && props.draggable && getSingleFileDraggerUploadNode()}\n        {props.theme === 'image' && !props.draggable && getImageCardUploadNode()}\n        {['image-flow', 'file-flow'].includes(props.theme) && getFlowListNode()}\n        {props.theme === 'custom' && getCustomFile()}\n\n        {props.tips && (\n          <small class={[tipsClasses, { [`${classPrefix.value}-upload__tips-${props.status}`]: props.status }]}>\n            {props.tips}\n          </small>\n        )}\n      </div>\n    );\n  },\n});\n"],"names":["defineComponent","name","props","setup","slots","expose","renderContent","useContent","useUpload","locale","classPrefix","triggerUploadText","toUploadFiles","displayFiles","uploadValue","sizeOverLimitMessage","uploading","tipsClasses","errorClasses","inputRef","disabled","onInnerRemove","uploadFiles","onNormalFileChange","onDragFileChange","triggerUpload","cancelUpload","upload","value","renderTrigger","getDefaultTrigger","theme","_createVNode","Button","_mergeProps","triggerButtonProps","UploadIcon","commonDisplayFileProps","computed","files","placeholder","tips","status","autoUpload","abridgeName","fileListDisplay","onRemove","dragProps","onDragenter","onDragleave","onDrop","getNormalFileNode","multiple","getSingleFileDraggerUploadNode","trigger","getImageCardUploadNode","max","showUploadProgress","onPreview","getFlowListNode","isBatchUpload","draggable","Object","keys","length","getCustomFile","dragContent","accept","includes"],"mappings":"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"}