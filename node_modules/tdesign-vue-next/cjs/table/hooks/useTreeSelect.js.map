{"version":3,"file":"useTreeSelect.js","sources":["../../../src/table/hooks/useTreeSelect.tsx"],"sourcesContent":["import { computed, toRefs, ref, Ref, watch } from 'vue';\nimport get from 'lodash/get';\nimport intersection from 'lodash/intersection';\nimport { TdEnhancedTableProps, TdPrimaryTableProps, TableRowData, PrimaryTableCol } from '../type';\nimport { KeysType, TableTreeDataMap, TreeDataMapType } from '../../_common/js/table/tree-store';\nimport useDefaultValue from '../../hooks/useDefaultValue';\n\nexport interface GetChildrenDataReturnValue {\n  allChildren: Array<any>;\n  allChildrenKeys: Array<string | number>;\n  leafNodeKeys: Array<string | number>;\n}\n\n// 保存子节点信息，避免重复计算\nexport const childrenMap = new Map();\n\nexport function getChildrenData(\n  treeDataMap: TreeDataMapType,\n  data: TableRowData,\n  keys: { childrenKey: string; rowKey: string },\n  r?: GetChildrenDataReturnValue,\n): GetChildrenDataReturnValue {\n  if (childrenMap.get(data)) return childrenMap.get(data);\n  const result = r || { allChildren: [], allChildrenKeys: [], leafNodeKeys: [] };\n  const children = get(data, keys.childrenKey);\n  if (!children || !children.length) return result;\n  const selectableChildren = children.filter(\n    (item: TableRowData) => !treeDataMap.get(get(item, keys.rowKey))?.disabled,\n  );\n  result.allChildren = [...new Set(result.allChildren.concat(selectableChildren))];\n  for (let i = 0, len = children.length; i < len; i++) {\n    const tItem = children[i];\n    const c = get(tItem, keys.childrenKey);\n    if (c?.length) {\n      const nextLevelData = getChildrenData(treeDataMap, tItem, keys, result);\n      result.allChildren = [...new Set(result.allChildren.concat(nextLevelData.allChildren))];\n    }\n  }\n  // 避免使用 forEach，减少上下文消耗\n  for (let i = 0, len = result.allChildren.length; i < len; i++) {\n    const item = result.allChildren[i];\n    const children = get(item, keys.childrenKey);\n    const rowValue = get(item, keys.rowKey);\n    result.allChildrenKeys.push(rowValue);\n    if (!children || !children.length) {\n      result.leafNodeKeys.push(rowValue);\n    }\n  }\n  result.allChildrenKeys = [...new Set(result.allChildrenKeys)];\n  result.leafNodeKeys = [...new Set(result.leafNodeKeys)];\n  return result;\n}\n\nexport interface RemoveParams {\n  // 当前选中的数据\n  selectedRowKeys: Array<string | number>;\n  // 需要移除的数据\n  removeKeys: Array<string | number>;\n}\n\nexport interface RemainData {\n  data: Array<any>;\n  keys: Array<string | number>;\n}\n\nexport function removeChildrenKeys(p: RemoveParams, r?: RemainData): RemainData {\n  const { selectedRowKeys, removeKeys } = p;\n  const result = r || { data: [], keys: [] };\n  for (let i = 0, len = selectedRowKeys.length; i < len; i++) {\n    const key = selectedRowKeys[i];\n    if (!removeKeys.includes(key)) {\n      result.keys.push(key);\n    }\n  }\n  return result;\n}\n\nexport interface GetKeyDataParams {\n  treeDataMap: TreeDataMapType;\n  data: Array<any>;\n  column: PrimaryTableCol;\n  keys: KeysType;\n}\n\nexport interface GetRowDataParams {\n  treeDataMap: TreeDataMapType;\n  selectedRowKeys: Array<string | number>;\n}\n\nexport function getRowDataByKeys(p: GetRowDataParams) {\n  const { treeDataMap, selectedRowKeys } = p;\n  const result = [];\n  for (let i = 0, len = selectedRowKeys.length; i < len; i++) {\n    const key = selectedRowKeys[i];\n    result.push(treeDataMap.get(key));\n  }\n  return result;\n}\n\ntype SelectChangeParams = Parameters<TdPrimaryTableProps['onSelectChange']>;\n\nexport default function useTreeSelect(props: TdEnhancedTableProps, treeDataMap: Ref<TableTreeDataMap>) {\n  const { selectedRowKeys, tree, data, indeterminateSelectedRowKeys } = toRefs(props);\n  // 半选状态的节点：子节点选中至少一个，且没有全部选中\n  const tIndeterminateSelectedRowKeys = ref<(string | number)[]>([]);\n\n  const [tSelectedRowKeys, setTSelectedRowKeys] = useDefaultValue(\n    selectedRowKeys,\n    props.defaultSelectedRowKeys || [],\n    props.onSelectChange,\n    'selectedRowKeys',\n  );\n  const rowDataKeys = computed(() => ({\n    rowKey: props.rowKey || 'id',\n    childrenKey: props.tree?.childrenKey || 'children',\n  }));\n\n  watch([tree, treeDataMap, data, tSelectedRowKeys], ([tree, treeDataMap]) => {\n    if (!tree || !treeDataMap.size || tree.checkStrictly) return;\n    updateIndeterminateState();\n  });\n\n  function updateIndeterminateState() {\n    if (!tree.value || tree.value.checkStrictly) return;\n    if (!tSelectedRowKeys.value.length) {\n      tIndeterminateSelectedRowKeys.value = [];\n      return;\n    }\n    const keys: Array<string | number> = [];\n    const parentMap: { [key: string | number]: any[] } = {};\n    for (let i = 0, len = tSelectedRowKeys.value.length; i < len; i++) {\n      const rowValue = tSelectedRowKeys.value[i];\n      const state = treeDataMap.value.get(rowValue);\n      const children = get(state.row, rowDataKeys.value.childrenKey);\n      // 根据选中的叶子结点计算父节点半选状态\n      if (!children || !children.length) {\n        let parentTmp = state.parent;\n        while (parentTmp) {\n          if (!parentMap[parentTmp.id]) {\n            parentMap[parentTmp.id] = [];\n          }\n          parentMap[parentTmp.id].push(state.row);\n          const checkedLength = parentMap[parentTmp.id].length;\n          const { allChildrenKeys } = getChildrenData(treeDataMap.value, parentTmp.row, rowDataKeys.value);\n          const parentTmpIndex = keys.indexOf(parentTmp.id);\n          const selectedIndex = tSelectedRowKeys.value.indexOf(parentTmp.id);\n          if (checkedLength > 0 && checkedLength < allChildrenKeys.length && selectedIndex === -1) {\n            parentTmpIndex === -1 && keys.push(parentTmp.id);\n          } else {\n            parentTmpIndex !== -1 && keys.splice(parentTmpIndex, 1);\n          }\n          parentTmp = parentTmp.parent;\n        }\n      }\n    }\n    tIndeterminateSelectedRowKeys.value = keys;\n  }\n\n  function updateParentCheckedState(\n    selectedKeys: (string | number)[],\n    currentRowKey: string | number,\n    type: 'check' | 'uncheck',\n  ) {\n    if (!tree.value || tree.value.checkStrictly) return;\n    const keys = [...selectedKeys];\n    const state = treeDataMap.value.get(currentRowKey);\n    let parentTmp = state.parent;\n    while (parentTmp) {\n      const { leafNodeKeys } = getChildrenData(treeDataMap.value, parentTmp.row, rowDataKeys.value);\n      const checkedChildrenKeys = intersection(leafNodeKeys, selectedKeys);\n      const selectedIndex = keys.indexOf(parentTmp.id);\n      if (type === 'uncheck') {\n        selectedIndex !== -1 && keys.splice(selectedIndex, 1);\n      } else if (checkedChildrenKeys.length === leafNodeKeys.length) {\n        selectedIndex === -1 && keys.push(parentTmp.id);\n      }\n      parentTmp = parentTmp.parent;\n    }\n    return keys;\n  }\n\n  function onInnerSelectChange(rowKeys: SelectChangeParams[0], extraData: SelectChangeParams[1]) {\n    if (!tree.value || tree.value.checkStrictly) {\n      setTSelectedRowKeys(rowKeys, extraData);\n      return;\n    }\n    if (extraData.currentRowKey === 'CHECK_ALL_BOX') {\n      handleSelectAll(extraData);\n    } else {\n      handleSelect(rowKeys, extraData);\n    }\n  }\n\n  function handleSelectAll(extraData: SelectChangeParams[1]) {\n    const newRowKeys: Array<string | number> = [];\n    const newRowData: TableRowData[] = [];\n    if (extraData.type === 'check') {\n      const arr = [...treeDataMap.value.values()];\n      for (let i = 0, len = arr.length; i < len; i++) {\n        const item = arr[i];\n        if (!item.disabled) {\n          newRowData.push(item.row);\n          newRowKeys.push(get(item.row, rowDataKeys.value.rowKey));\n        }\n      }\n    }\n    const newExtraData = {\n      ...extraData,\n      selectedRowData: newRowData || [],\n    };\n    setTSelectedRowKeys(newRowKeys, newExtraData);\n  }\n\n  function handleSelect(rowKeys: SelectChangeParams[0], extraData: SelectChangeParams[1]) {\n    let newRowKeys = [...rowKeys];\n    if (props.tree?.checkStrictly === false) {\n      if (extraData?.type === 'check') {\n        const result = getChildrenData(treeDataMap.value, extraData.currentRowData, rowDataKeys.value);\n        const { allChildrenKeys } = result;\n        childrenMap.set(extraData.currentRowData, result);\n        newRowKeys = [...new Set(newRowKeys.concat(allChildrenKeys))];\n      } else if (extraData?.type === 'uncheck') {\n        const children = getChildrenData(treeDataMap.value, extraData.currentRowData, rowDataKeys.value);\n        const result = removeChildrenKeys({\n          selectedRowKeys: rowKeys,\n          removeKeys: children.allChildrenKeys,\n        });\n        newRowKeys = result.keys;\n      }\n    }\n    newRowKeys = updateParentCheckedState(newRowKeys, extraData.currentRowKey, extraData.type);\n    const newRowData = getRowDataByKeys({ treeDataMap: treeDataMap.value, selectedRowKeys: newRowKeys });\n    const newExtraData = {\n      ...extraData,\n      selectedRowData: newRowData,\n    };\n    setTSelectedRowKeys(newRowKeys, newExtraData);\n  }\n\n  return {\n    // 如果存在受控属性 indeterminateSelectedRowKeys 则优先使用；否则使用内部状态：tIndeterminateSelectedRowKeys\n    tIndeterminateSelectedRowKeys: indeterminateSelectedRowKeys.value\n      ? indeterminateSelectedRowKeys\n      : tIndeterminateSelectedRowKeys,\n    onInnerSelectChange,\n  };\n}\n"],"names":["childrenMap","Map","getChildrenData","treeDataMap","data","keys","r","get","result","allChildren","allChildrenKeys","leafNodeKeys","children","childrenKey","length","selectableChildren","filter","item","rowKey","disabled","_toConsumableArray","Set","concat","i","len","tItem","c","nextLevelData","rowValue","push","removeChildrenKeys","p","selectedRowKeys","removeKeys","key","includes","getRowDataByKeys","useTreeSelect","props","toRefs","tree","indeterminateSelectedRowKeys","tIndeterminateSelectedRowKeys","ref","useDefaultValue","defaultSelectedRowKeys","onSelectChange","_slicedToArray","tSelectedRowKeys","setTSelectedRowKeys","rowDataKeys","computed","watch","size","checkStrictly","updateIndeterminateState","value","parentMap","state","row","parentTmp","parent","id","checkedLength","parentTmpIndex","indexOf","selectedIndex","splice","updateParentCheckedState","selectedKeys","currentRowKey","type","checkedChildrenKeys","intersection","onInnerSelectChange","rowKeys","extraData","handleSelectAll","handleSelect","newRowKeys","newRowData","arr","values","newExtraData","selectedRowData","currentRowData","set"],"mappings":"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"}