{"version":3,"file":"primary-table.js","sources":["../../src/table/primary-table.tsx"],"sourcesContent":["import { computed, defineComponent, toRefs, h, ref, onMounted, SetupContext } from 'vue';\nimport get from 'lodash/get';\nimport omit from 'lodash/omit';\nimport isFunction from 'lodash/isFunction';\nimport baseTableProps from './base-table-props';\nimport primaryTableProps from './primary-table-props';\nimport BaseTable from './base-table';\nimport { useTNodeJSX } from '../hooks/tnode';\nimport useColumnController from './hooks/useColumnController';\nimport useRowExpand from './hooks/useRowExpand';\nimport useTableHeader, { renderTitle } from './hooks/useTableHeader';\nimport useRowSelect from './hooks/useRowSelect';\nimport {\n  TdPrimaryTableProps,\n  PrimaryTableCol,\n  TableRowData,\n  PrimaryTableCellParams,\n  PrimaryTableRowEditContext,\n} from './type';\nimport useSorter from './hooks/useSorter';\nimport useFilter from './hooks/useFilter';\nimport useDragSort from './hooks/useDragSort';\nimport useAsyncLoading from './hooks/useAsyncLoading';\nimport EditableCell, { EditableCellProps } from './editable-cell';\nimport { PageInfo } from '../pagination';\nimport useClassName from './hooks/useClassName';\nimport useEditableRow from './hooks/useEditableRow';\nimport useStyle from './hooks/useStyle';\n\nexport { BASE_TABLE_ALL_EVENTS } from './base-table';\n\nconst OMIT_PROPS = [\n  'hideSortTips',\n  'dragSort',\n  'defaultExpandedRowKeys',\n  'defaultSelectedRowKeys',\n  'columnController',\n  'filterRow',\n  'sortOnRowDraggable',\n  'expandOnRowClick',\n  'multipleSort',\n  'expandIcon',\n  'onChange',\n  'onAsyncLoadingClick',\n  'onColumnChange',\n  'onColumnControllerVisibleChange',\n  'onDataChange',\n  'onDisplayColumnsChange',\n  'onDragSort',\n  'onExpandChange',\n  'onFilterChange',\n  'onSelectChange',\n  'onSortChange',\n];\n\nexport default defineComponent({\n  name: 'TPrimaryTable',\n\n  props: {\n    ...baseTableProps,\n    ...primaryTableProps,\n  },\n\n  setup(props: TdPrimaryTableProps, context: SetupContext) {\n    const renderTNode = useTNodeJSX();\n    const { columns, columnController } = toRefs(props);\n    const primaryTableRef = ref(null);\n    const { classPrefix, tableDraggableClasses, tableBaseClass, tableSelectedClasses, tableSortClasses } =\n      useClassName();\n    const { sizeClassNames } = useStyle(props);\n    // 自定义列配置功能\n    const { tDisplayColumns, renderColumnController } = useColumnController(props, context);\n    // 展开/收起行功能\n    const { showExpandedRow, showExpandIconColumn, getExpandColumn, renderExpandedRow, onInnerExpandRowClick } =\n      useRowExpand(props, context);\n    // 排序功能\n    const { renderSortIcon } = useSorter(props, context);\n    // 行选中功能\n    const { formatToRowSelectColumn, selectedRowClassNames } = useRowSelect(props, tableSelectedClasses);\n    // 过滤功能\n    const {\n      hasEmptyCondition,\n      isTableOverflowHidden,\n      renderFilterIcon,\n      renderFirstFilterRow,\n      setFilterPrimaryTableRef,\n    } = useFilter(props, context);\n\n    // 拖拽排序功能\n    const { isRowHandlerDraggable, isRowDraggable, isColDraggable, setDragSortPrimaryTableRef, setDragSortColumns } =\n      useDragSort(props, context);\n\n    const { renderTitleWidthIcon } = useTableHeader(props);\n    const { renderAsyncLoading } = useAsyncLoading(props, context);\n\n    const { errorListMap, editableKeysMap, validateRowData, validateTableData, onRuleChange, clearValidateData } =\n      useEditableRow(props);\n\n    const primaryTableClasses = computed(() => {\n      return {\n        [tableDraggableClasses.colDraggable]: isColDraggable.value,\n        [tableDraggableClasses.rowHandlerDraggable]: isRowHandlerDraggable.value,\n        [tableDraggableClasses.rowDraggable]: isRowDraggable.value,\n        [tableBaseClass.overflowVisible]: isTableOverflowHidden.value === false,\n        [tableBaseClass.tableRowEdit]: props.editableRowKeys,\n      };\n    });\n\n    // 如果想给 TR 添加类名，请在这里补充，不要透传更多额外 Props 到 BaseTable\n    const tRowClassNames = computed(() => {\n      const tClassNames = [props.rowClassName, selectedRowClassNames.value];\n      return tClassNames.filter((v) => v);\n    });\n\n    // 如果想给 TR 添加属性，请在这里补充，不要透传更多额外 Props 到 BaseTable\n    const tRowAttributes = computed(() => {\n      const tAttributes = [props.rowAttributes];\n      if (isRowHandlerDraggable.value || isRowDraggable.value) {\n        tAttributes.push(({ row }) => ({ 'data-id': get(row, props.rowKey || 'id') }));\n      }\n      return tAttributes.filter((v) => v);\n    });\n\n    // 多个 Hook 共用 primaryTableRef\n    onMounted(() => {\n      setFilterPrimaryTableRef(primaryTableRef.value);\n      setDragSortPrimaryTableRef(primaryTableRef.value);\n    });\n\n    // 对外暴露的方法\n    context.expose({\n      validateRowData,\n      validateTableData,\n      clearValidateData,\n      refreshTable: () => {\n        primaryTableRef.value.refreshTable();\n      },\n    });\n\n    // 1. 影响列数量的因素有：自定义列配置、展开/收起行、多级表头；2. 影响表头内容的因素有：排序图标、筛选图标\n    const getColumns = (columns: PrimaryTableCol<TableRowData>[]) => {\n      const arr: PrimaryTableCol<TableRowData>[] = [];\n      for (let i = 0, len = columns.length; i < len; i++) {\n        let item = { ...columns[i] };\n        // 自定义列显示控制\n        const isDisplayColumn = item.children?.length || tDisplayColumns.value?.includes(item.colKey);\n        if (!isDisplayColumn && props.columnController) continue;\n        item = formatToRowSelectColumn(item);\n        const { sort } = props;\n        if (item.sorter && props.showSortColumnBgColor) {\n          const sorts = sort instanceof Array ? sort : [sort];\n          const sortedColumn = sorts.find(\n            (sort) => sort && sort.sortBy === item.colKey && sort.descending !== undefined,\n          );\n          if (sortedColumn) {\n            item.className =\n              item.className instanceof Array\n                ? item.className.concat(tableSortClasses.sortColumn)\n                : [item.className, tableSortClasses.sortColumn];\n          }\n        }\n        // 添加排序图标和过滤图标\n        if (item.sorter || item.filter) {\n          const titleContent = renderTitle(context.slots, item, i);\n          const { ellipsisTitle } = item;\n          item.title = (h, p) => {\n            const sortIcon = item.sorter ? renderSortIcon(p) : null;\n            const filterIcon = item.filter ? renderFilterIcon(p) : null;\n            // @ts-ignore 注意：此处 Vue2 和 Vue3 有所不同\n            const attach = primaryTableRef.value?.tableContentRef;\n            return renderTitleWidthIcon(\n              [titleContent, sortIcon, filterIcon],\n              p.col,\n              p.colIndex,\n              ellipsisTitle,\n              attach,\n              {\n                classPrefix,\n                ellipsisOverlayClassName: props.size !== 'medium' ? sizeClassNames[props.size] : '',\n              },\n            );\n          };\n          item.ellipsisTitle = false;\n        }\n        // 如果是单元格可编辑状态\n        if (item.edit?.component) {\n          const oldCell = item.cell;\n          item.cell = (h, p: PrimaryTableCellParams<TableRowData>) => {\n            const cellProps: EditableCellProps = {\n              ...p,\n              oldCell,\n              tableBaseClass,\n              cellEmptyContent: props.cellEmptyContent,\n              onChange: props.onRowEdit,\n              onValidate: props.onRowValidate,\n              onRuleChange,\n            };\n            if (props.editableRowKeys) {\n              const rowValue = get(p.row, props.rowKey || 'id');\n              cellProps.editable = editableKeysMap.value[rowValue] || false;\n              const key = [rowValue, p.col.colKey].join('__');\n              const errorList = errorListMap.value?.[key];\n              errorList && (cellProps.errors = errorList);\n            }\n            if (props.editableCellState) {\n              cellProps.readonly = !props.editableCellState(p);\n            }\n            return <EditableCell {...cellProps} v-slots={context.slots} />;\n          };\n        }\n        if (item.children?.length) {\n          item.children = getColumns(item.children);\n        }\n        // 多级表头和自定义列配置特殊逻辑：要么子节点不存在，要么子节点长度大于 1，方便做自定义列配置\n        if (!item.children || item.children?.length) {\n          arr.push(item);\n        }\n      }\n      return arr;\n    };\n\n    const tColumns = computed(() => {\n      const cols = getColumns(columns.value);\n      if (showExpandIconColumn.value) {\n        cols.unshift(getExpandColumn());\n      }\n      return cols;\n    });\n\n    const onInnerPageChange = (pageInfo: PageInfo, newData: Array<TableRowData>) => {\n      props.onPageChange?.(pageInfo, newData);\n      const changeParams: Parameters<TdPrimaryTableProps['onChange']> = [\n        { pagination: pageInfo },\n        { trigger: 'pagination', currentData: newData },\n      ];\n      props.onChange?.(...changeParams);\n    };\n\n    return () => {\n      const formatNode = (\n        api: string,\n        renderInnerNode: Function,\n        condition: boolean,\n        extra?: { reverse?: boolean },\n      ) => {\n        if (!condition) return props[api];\n        const innerNode = renderInnerNode(h);\n        const propsNode = renderTNode(api);\n        if (innerNode && !propsNode) return () => innerNode;\n        if (propsNode && !innerNode) return () => propsNode;\n        if (innerNode && propsNode) {\n          return () =>\n            extra?.reverse ? (\n              <div>\n                {innerNode}\n                {propsNode}\n              </div>\n            ) : (\n              <div>\n                {propsNode}\n                {innerNode}\n              </div>\n            );\n        }\n        return null;\n      };\n      const isColumnController = !!(columnController.value && Object.keys(columnController.value).length);\n      // @ts-ignore\n      const placement = isColumnController ? columnController.value.placement || 'top-right' : '';\n      const isBottomController = isColumnController && placement?.indexOf('bottom') !== -1;\n      const topContent = formatNode('topContent', renderColumnController, isColumnController && !isBottomController);\n      const bottomContent = formatNode('bottomContent', renderColumnController, isBottomController, {\n        reverse: true,\n      });\n      const firstFullRow = formatNode('firstFullRow', renderFirstFilterRow, !hasEmptyCondition.value);\n      const lastFullRow = formatNode('lastFullRow', renderAsyncLoading, !!props.asyncLoading);\n\n      const baseTableProps = {\n        ...omit(props, OMIT_PROPS),\n        rowClassName: tRowClassNames.value,\n        rowAttributes: tRowAttributes.value,\n        columns: tColumns.value,\n        topContent,\n        bottomContent,\n        firstFullRow,\n        lastFullRow,\n        onPageChange: onInnerPageChange,\n        renderExpandedRow: showExpandedRow.value ? renderExpandedRow : undefined,\n      };\n\n      if (props.expandOnRowClick) {\n        baseTableProps.onRowClick = onInnerExpandRowClick;\n      }\n\n      return (\n        // @ts-ignore\n        <BaseTable\n          ref={primaryTableRef}\n          v-slots={context.slots}\n          {...baseTableProps}\n          class={primaryTableClasses.value}\n          onLeafColumnsChange={setDragSortColumns}\n        />\n      );\n    };\n  },\n});\n"],"names":["OMIT_PROPS","defineComponent","name","props","baseTableProps","primaryTableProps","setup","context","renderTNode","useTNodeJSX","toRefs","columns","columnController","primaryTableRef","ref","useClassName","classPrefix","tableDraggableClasses","tableBaseClass","tableSelectedClasses","tableSortClasses","useStyle","sizeClassNames","useColumnController","tDisplayColumns","renderColumnController","useRowExpand","showExpandedRow","showExpandIconColumn","getExpandColumn","renderExpandedRow","onInnerExpandRowClick","useSorter","renderSortIcon","useRowSelect","formatToRowSelectColumn","selectedRowClassNames","useFilter","hasEmptyCondition","isTableOverflowHidden","renderFilterIcon","renderFirstFilterRow","setFilterPrimaryTableRef","useDragSort","isRowHandlerDraggable","isRowDraggable","isColDraggable","setDragSortPrimaryTableRef","setDragSortColumns","useTableHeader","renderTitleWidthIcon","useAsyncLoading","renderAsyncLoading","useEditableRow","errorListMap","editableKeysMap","validateRowData","validateTableData","onRuleChange","clearValidateData","primaryTableClasses","computed","_defineProperty","colDraggable","value","rowHandlerDraggable","rowDraggable","overflowVisible","tableRowEdit","editableRowKeys","tRowClassNames","tClassNames","rowClassName","filter","v","tRowAttributes","tAttributes","rowAttributes","push","row","get","rowKey","onMounted","expose","refreshTable","getColumns","arr","i","len","item","isDisplayColumn","children","length","includes","colKey","sort","sorter","showSortColumnBgColor","sorts","Array","sortedColumn","find","sortBy","descending","className","concat","sortColumn","titleContent","renderTitle","slots","ellipsisTitle","title","h","p","sortIcon","filterIcon","attach","tableContentRef","col","colIndex","ellipsisOverlayClassName","size","edit","component","oldCell","cell","cellProps","cellEmptyContent","onChange","onRowEdit","onValidate","onRowValidate","rowValue","editable","key","join","errorList","errors","editableCellState","readonly","_createVNode","EditableCell","tColumns","cols","unshift","onInnerPageChange","pageInfo","newData","onPageChange","changeParams","pagination","trigger","currentData","formatNode","api","renderInnerNode","condition","extra","innerNode","propsNode","reverse","isColumnController","Object","keys","placement","isBottomController","indexOf","topContent","bottomContent","firstFullRow","lastFullRow","asyncLoading","omit","expandOnRowClick","onRowClick","BaseTable","_mergeProps"],"mappings":"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"}