{"version":3,"file":"useSingle.js","sources":["../../src/select-input/useSingle.tsx"],"sourcesContent":["import { SetupContext, ref, computed, toRefs } from 'vue';\nimport isObject from 'lodash/isObject';\nimport pick from 'lodash/pick';\nimport { SelectInputCommonProperties } from './interface';\nimport { TdSelectInputProps } from './type';\nimport Input, { InputValue } from '../input';\nimport Loading from '../loading';\nimport { useTNodeJSX } from '../hooks/tnode';\nimport { usePrefixClass } from '../hooks/useConfig';\nimport useDefaultValue from '../hooks/useDefaultValue';\nimport { useFormDisabled } from '../form/hooks';\n\n// single 和 multiple 共有特性\nconst COMMON_PROPERTIES = [\n  'status',\n  'clearable',\n  'disabled',\n  'label',\n  'placeholder',\n  'readonly',\n  'suffix',\n  'suffixIcon',\n  'onPaste',\n  'onMouseenter',\n  'onMouseleave',\n];\n\nconst DEFAULT_KEYS = {\n  label: 'label',\n  value: 'value',\n};\n\nfunction getInputValue(value: TdSelectInputProps['value'], keys: TdSelectInputProps['keys']) {\n  const iKeys = keys || DEFAULT_KEYS;\n  return isObject(value) ? value[iKeys.label] : value;\n}\n\nexport default function useSingle(props: TdSelectInputProps, context: SetupContext) {\n  const { value, keys, inputValue: propsInputValue } = toRefs(props);\n  const classPrefix = usePrefixClass();\n  const inputRef = ref();\n  const [inputValue, setInputValue] = useDefaultValue(\n    propsInputValue,\n    props.defaultInputValue ?? '',\n    props.onInputChange,\n    'inputValue',\n  );\n  const renderTNode = useTNodeJSX();\n  const disable = useFormDisabled();\n\n  const commonInputProps = computed<SelectInputCommonProperties>(() => ({\n    ...pick(props, COMMON_PROPERTIES),\n    disabled: disable.value,\n  }));\n\n  const onInnerClear = (context: { e: MouseEvent }) => {\n    context?.e?.stopPropagation();\n    props.onClear?.(context);\n    setInputValue('', { trigger: 'clear' });\n  };\n\n  const onInnerInputChange = (value: InputValue, context: { e: InputEvent | MouseEvent }) => {\n    if (props.allowInput) {\n      setInputValue(value, { ...context, trigger: 'input' });\n    }\n  };\n\n  const renderSelectSingle = (popupVisible: boolean) => {\n    const singleValueDisplay = renderTNode('valueDisplay');\n    const displayedValue = popupVisible && props.allowInput ? inputValue.value : getInputValue(value.value, keys.value);\n    const prefixContent = [singleValueDisplay, renderTNode('label')];\n    const inputProps = {\n      ...commonInputProps.value,\n      value: singleValueDisplay ? undefined : displayedValue,\n      label: prefixContent.length ? () => prefixContent : undefined,\n      autoWidth: props.autoWidth,\n      readonly: !props.allowInput || props.readonly,\n      placeholder: singleValueDisplay ? '' : props.placeholder,\n      suffixIcon: !disable.value && props.loading ? () => <Loading loading size=\"small\" /> : props.suffixIcon,\n      showClearIconOnEmpty: Boolean(\n        props.clearable && (inputValue.value || displayedValue) && !disable.value && !props.readonly,\n      ),\n      allowTriggerBlur: props.allowInput && !props.readonly,\n      ...props.inputProps,\n    };\n\n    return (\n      <Input\n        ref=\"inputRef\"\n        style={context.attrs?.style}\n        v-slots={context.slots}\n        {...{\n          onChange: onInnerInputChange,\n          onClear: onInnerClear,\n          onBlur: (val: InputValue, context: { e: MouseEvent }) => {\n            props.onBlur?.(value.value, { ...context, inputValue: val });\n          },\n          onEnter: (val: InputValue, context: { e: KeyboardEvent }) => {\n            props.onEnter?.(value.value, { ...context, inputValue: val });\n          },\n          onFocus: (val, context) => {\n            props.onFocus?.(value.value, { ...context, inputValue: val });\n            !popupVisible && setInputValue(getInputValue(value.value, keys.value), { ...context, trigger: 'input' }); // 聚焦时拿到value\n          },\n          ...inputProps,\n        }}\n        inputClass={{\n          [`${classPrefix.value}-input--focused`]: popupVisible,\n          [`${classPrefix.value}-is-focused`]: popupVisible,\n        }}\n      />\n    );\n  };\n\n  return {\n    inputRef,\n    commonInputProps,\n    onInnerClear,\n    renderSelectSingle,\n  };\n}\n"],"names":["COMMON_PROPERTIES","DEFAULT_KEYS","label","value","getInputValue","keys","iKeys","isObject","useSingle","props","context","toRefs","propsInputValue","inputValue","classPrefix","usePrefixClass","inputRef","ref","useDefaultValue","defaultInputValue","onInputChange","_slicedToArray","setInputValue","renderTNode","useTNodeJSX","disable","useFormDisabled","commonInputProps","computed","pick","disabled","onInnerClear","e","stopPropagation","onClear","trigger","onInnerInputChange","allowInput","renderSelectSingle","popupVisible","singleValueDisplay","displayedValue","prefixContent","inputProps","length","autoWidth","readonly","placeholder","suffixIcon","loading","_createVNode","Loading","showClearIconOnEmpty","Boolean","clearable","allowTriggerBlur","Input","_mergeProps","attrs","style","onChange","onBlur","val","onEnter","onFocus","slots"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAaA,IAAMA,iBAAoB,GAAA,CACxB,QAAA,EACA,WAAA,EACA,UAAA,EACA,OAAA,EACA,aAAA,EACA,UAAA,EACA,QAAA,EACA,YAAA,EACA,SAAA,EACA,cAAA,EACA,cAAA,CACF,CAAA;AAEA,IAAMC,YAAe,GAAA;AACnBC,EAAAA,KAAO,EAAA,OAAA;AACPC,EAAAA,KAAO,EAAA,OAAA;AACT,CAAA,CAAA;AAEA,SAASC,aAAA,CAAcD,OAAoCE,IAAkC,EAAA;AAC3F,EAAA,IAAMC,QAAQD,IAAQ,IAAAJ,YAAA,CAAA;AACtB,EAAA,OAAOM,4BAAS,CAAAJ,KAAK,CAAI,GAAAA,KAAA,CAAMG,MAAMJ,KAAS,CAAA,GAAAC,KAAA,CAAA;AAChD,CAAA;AAEwB,SAAAK,SAAA,CAAUC,OAA2BC,OAAuB,EAAA;AAAA,EAAA,IAAA,qBAAA,CAAA;EAClF,IAAqDC,OAAAA,GAAAA,WAAOF,KAAK,CAAA;AAAzDN,IAAAA,KAAO,WAAPA,KAAO;AAAAE,IAAAA,IAAA,WAAAA,IAAA;AAAkBO,IAAAA,eAAgB,WAA5BC;EACrB,IAAMC,cAAcC,8BAAe,EAAA,CAAA;EACnC,IAAMC,WAAWC,OAAI,EAAA,CAAA;AACf,EAAA,IAAA,gBAAA,GAA8BC,gCAAA,CAClCN,eAAA,EAAA,CAAA,qBAAA,GACAH,MAAMU,iBAAqB,MAAA,IAAA,IAAA,qBAAA,KAAA,KAAA,CAAA,GAAA,qBAAA,GAAA,EAAA,EAC3BV,KAAM,CAAAW,aAAA,EACN,YAAA,CACF;AAAA,IAAA,iBAAA,GAAAC,kCAAA,CAAA,gBAAA,EAAA,CAAA,CAAA;IALOR,UAAY,GAAA,iBAAA,CAAA,CAAA,CAAA;IAAAS,aAAa,GAAA,iBAAA,CAAA,CAAA,CAAA,CAAA;EAMhC,IAAMC,cAAcC,uBAAY,EAAA,CAAA;EAChC,IAAMC,UAAUC,0BAAgB,EAAA,CAAA;EAE1B,IAAAC,gBAAA,GAAmBC,aAAsC,YAAA;AAAA,IAAA,OAAA,aAAA,CAAA,aAAA,CAAA,EAAA,EAC1DC,wBAAK,CAAApB,KAAA,EAAOT,iBAAiB,CAAA,CAAA,EAAA,EAAA,EAAA;MAChC8B,UAAUL,OAAQ,CAAAtB,KAAAA;AAAA,KAAA,CAAA,CAAA;AAAA,GAClB,CAAA,CAAA;AAEI,EAAA,IAAA4B,YAAA,GAAe,SAAfA,YAAA,CAAgBrB,QAA+B,EAAA;AAAA,IAAA,IAAA,WAAA,EAAA,cAAA,CAAA;IACnDA,QAAAA,KAAAA,IAAAA,IAAAA,QAAAA,KAAAA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,CAAAA,WAAAA,GAAAA,QAAAA,CAASsB,iDAATtB,WAAYuB,CAAAA,eAAgB,EAAA,CAAA;IAC5B,CAAAxB,cAAAA,GAAAA,KAAA,CAAMyB,0DAAN,oBAAAzB,KAAA,EAAgBC,QAAO,CAAA,CAAA;IACvBY,aAAA,CAAc,EAAI,EAAA;AAAEa,MAAAA,OAAS,EAAA,OAAA;AAAQ,KAAC,CAAA,CAAA;GACxC,CAAA;EAEM,IAAAC,kBAAA,GAAqB,SAArBA,kBAAA,CAAsBjC,MAAAA,EAAmBO,QAA4C,EAAA;IACzF,IAAID,MAAM4B,UAAY,EAAA;MACpBf,aAAA,CAAcnB,wCAAYO,QAAS,CAAA,EAAA,EAAA,EAAA;AAAAyB,QAAAA,OAAA,EAAS,OAAA;OAAS,CAAA,CAAA,CAAA;AACvD,KAAA;GACF,CAAA;AAEM,EAAA,IAAAG,kBAAA,GAAqB,SAArBA,kBAAA,CAAsBC,YAA0B,EAAA;AAAA,IAAA,IAAA,cAAA,EAAA,IAAA,CAAA;AAC9C,IAAA,IAAAC,kBAAA,GAAqBjB,YAAY,cAAc,CAAA,CAAA;IAC/C,IAAAkB,cAAA,GAAiBF,YAAgB,IAAA9B,KAAA,CAAM4B,UAAa,GAAAxB,UAAA,CAAWV,QAAQC,aAAc,CAAAD,KAAA,CAAMA,KAAO,EAAAE,IAAA,CAAKF,KAAK,CAAA,CAAA;IAClH,IAAMuC,aAAgB,GAAA,CAACF,kBAAoB,EAAAjB,WAAA,CAAY,OAAO,CAAC,CAAA,CAAA;AAC/D,IAAA,IAAMoB,UAAa,GAAA,aAAA,CAAA,aAAA,CAAA,EAAA,EACdhB,gBAAiB,CAAAxB,KAAA,CAAA,EAAA,EAAA,EAAA;AACpBA,MAAAA,KAAA,EAAOqC,qBAAqB,KAAY,CAAA,GAAAC,cAAA;AACxCvC,MAAAA,KAAO,EAAAwC,aAAA,CAAcE,MAAS,GAAA,YAAA;AAAA,QAAA,OAAMF,aAAgB,CAAA;AAAA,OAAA,GAAA,KAAA,CAAA;MACpDG,WAAWpC,KAAM,CAAAoC,SAAA;MACjBC,QAAU,EAAA,CAACrC,KAAM,CAAA4B,UAAA,IAAc5B,KAAM,CAAAqC,QAAA;AACrCC,MAAAA,WAAA,EAAaP,kBAAqB,GAAA,EAAA,GAAK/B,KAAM,CAAAsC,WAAA;MAC7CC,UAAY,EAAA,CAACvB,OAAQ,CAAAtB,KAAA,IAASM,KAAM,CAAAwC,OAAA,GAAU,YAAA;AAAA,QAAA,OAAAC,eAAA,CAAAC,qBAAA,EAAA;AAAA,UAAA,SAAA,EAAA,IAAA;UAAA,MAA4B,EAAA,OAAA;AAAA,SAAA,EAAA,IAAA,CAAA,CAAA;UAAa1C,KAAM,CAAAuC,UAAA;MAC7FI,oBAAsB,EAAAC,OAAA,CACpB5C,KAAA,CAAM6C,cAAczC,UAAW,CAAAV,KAAA,IAASsC,mBAAmB,CAAChB,OAAA,CAAQtB,KAAS,IAAA,CAACM,KAAM,CAAAqC,QAAA,CACtF;AACAS,MAAAA,gBAAkB,EAAA9C,KAAA,CAAM4B,UAAc,IAAA,CAAC5B,KAAM,CAAAqC,QAAAA;KAC1CrC,EAAAA,KAAM,CAAAkC,UAAA,CACX,CAAA;AAGE,IAAA,OAAAO,eAAA,CAAAM,iBAAA,EAAAC,cAAA,CAAA;AAAA,MAAA,KAAA,EACM,UACJ;AAAA,MAAA,OAAA,EAAA,CAAA,cAAA,GAAO/C,QAAQgD,KAAO,MAAA,IAAA,IAAA,cAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAf,cAAeC,CAAAA,KAAAA;AAAA,KAAA,EAAA,aAAA,CAAA;AAGpBC,MAAAA,QAAU,EAAAxB,kBAAA;AACVF,MAAAA,OAAS,EAAAH,YAAA;AACT8B,MAAAA,MAAA,EAAQ,SAAA,MAAA,CAACC,GAAA,EAAiBpD,QAA+B,EAAA;AAAA,QAAA,IAAA,aAAA,CAAA;QACjD,CAAAD,aAAAA,GAAAA,KAAA,CAAAoD,MAAA,MAAA,IAAA,IAAA,aAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,aAAA,CAAA,IAAA,CAAApD,KAAA,EAASN,MAAMA,KAAO,EAAA,aAAA,CAAA,aAAA,CAAA,EAAA,EAAKO,QAAS,CAAA,EAAA,EAAA,EAAA;AAAAG,UAAAA,UAAA,EAAYiD,GAAAA;SAAK,CAAA,CAAA,CAAA;OAC7D;AACAC,MAAAA,OAAA,EAAS,SAAA,OAAA,CAACD,GAAA,EAAiBpD,QAAkC,EAAA;AAAA,QAAA,IAAA,cAAA,CAAA;QACrD,CAAAD,cAAAA,GAAAA,KAAA,CAAAsD,OAAA,MAAA,IAAA,IAAA,cAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,cAAA,CAAA,IAAA,CAAAtD,KAAA,EAAUN,MAAMA,KAAO,EAAA,aAAA,CAAA,aAAA,CAAA,EAAA,EAAKO,QAAS,CAAA,EAAA,EAAA,EAAA;AAAAG,UAAAA,UAAA,EAAYiD,GAAAA;SAAK,CAAA,CAAA,CAAA;OAC9D;AACAE,MAAAA,OAAA,EAAS,SAAA,OAAA,CAACF,GAAA,EAAKpD,QAAY,EAAA;AAAA,QAAA,IAAA,cAAA,CAAA;QACnB,CAAAD,cAAAA,GAAAA,KAAA,CAAAuD,OAAA,MAAA,IAAA,IAAA,cAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,cAAA,CAAA,IAAA,CAAAvD,KAAA,EAAUN,MAAMA,KAAO,EAAA,aAAA,CAAA,aAAA,CAAA,EAAA,EAAKO,QAAS,CAAA,EAAA,EAAA,EAAA;AAAAG,UAAAA,UAAA,EAAYiD,GAAAA;SAAK,CAAA,CAAA,CAAA;AAC5D,QAAA,CAACvB,YAAgB,IAAAjB,aAAA,CAAclB,aAAc,CAAAD,KAAA,CAAMA,KAAO,EAAAE,IAAA,CAAKF,KAAK,CAAA,kCAAQO,QAAS,CAAA,EAAA,EAAA,EAAA;AAAAyB,UAAAA,OAAA,EAAS,OAAA;SAAS,CAAA,CAAA,CAAA;AACzG,OAAA;AAAA,KAAA,EACGQ,UAAA,CAAA,EAAA;MAAA,YAGC7B,GAAAA,IAAAA,GAAAA,EAAAA,EAAAA,mCAAAA,CAAAA,IAAAA,EAAAA,EAAAA,CAAAA,MAAAA,CAAAA,WAAA,CAAYX,KAAyB,EAAAoC,iBAAAA,CAAAA,EAAAA,YAAA,uDACrCzB,WAAA,CAAYX,KAAqB,EAAA,aAAA,CAAA,EAAAoC,YAAA,CAAA,EAAA,IAAA,CAAA;KAlB9B7B,CAAAA,EAAAA,OAAA,CAAQuD,KACb,CAAA,CAAA;GAqBV,CAAA;EAEO,OAAA;AACLjD,IAAAA,QAAA,EAAAA,QAAA;AACAW,IAAAA,gBAAA,EAAAA,gBAAA;AACAI,IAAAA,YAAA,EAAAA,YAAA;AACAO,IAAAA,kBAAA,EAAAA,kBAAAA;GACF,CAAA;AACF;;;;"}