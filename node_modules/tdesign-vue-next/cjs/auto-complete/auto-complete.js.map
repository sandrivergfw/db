{"version":3,"file":"auto-complete.js","sources":["../../src/auto-complete/auto-complete.tsx"],"sourcesContent":["import { computed, ref, defineComponent, toRefs } from 'vue';\nimport props from './props';\nimport { TdAutoCompleteProps } from './type';\nimport Input, { InputProps } from '../input';\nimport Popup, { PopupProps } from '../popup';\nimport useCommonClassName from '../hooks/useCommonClassName';\nimport AutoCompleteOptionList from './option-list';\nimport useVModel from '../hooks/useVModel';\nimport { useConfig } from '../config-provider/useConfig';\nimport { ClassName } from '../common';\nimport { useContent, useTNodeJSX } from '../hooks';\n\nexport default defineComponent({\n  name: 'TAutoComplete',\n\n  props,\n\n  setup(props: TdAutoCompleteProps, { slots }) {\n    const { value, modelValue } = toRefs(props);\n    const [tValue, setTValue] = useVModel(value, modelValue, props.defaultValue, props.onChange);\n    const renderContent = useContent();\n    const renderTNodeJSX = useTNodeJSX();\n    const { classPrefix, sizeClassNames } = useCommonClassName();\n    const { globalConfig: global } = useConfig('input');\n\n    const popupVisible = ref();\n\n    const getOverlayStyle = (trigger: HTMLElement, popupElement: HTMLElement) => {\n      const triggerWidth = trigger.getBoundingClientRect().width || trigger.offsetWidth || trigger.clientWidth;\n      const popupWidth =\n        popupElement.getBoundingClientRect().width || popupElement.offsetWidth || popupElement.clientWidth;\n      return {\n        width: triggerWidth >= popupWidth ? `${triggerWidth}px` : 'auto',\n        ...props.popupProps?.overlayInnerStyle,\n      };\n    };\n\n    const classes = computed(() => [`${classPrefix.value}-auto-complete`]);\n    const popupClasses = computed(() => {\n      let classes: ClassName = [`${classPrefix.value}-select__dropdown`];\n      if (props.popupProps?.overlayClassName) {\n        classes = classes.concat(props.popupProps.overlayClassName);\n      }\n      return classes;\n    });\n    const popupInnerClasses = computed(() => {\n      let classes: ClassName = [`${classPrefix.value}-select__dropdown-inner`];\n      if (props.popupProps?.overlayInnerClassName) {\n        classes = classes.concat(props.popupProps.overlayInnerClassName);\n      }\n      return classes;\n    });\n\n    const onInputChange = (value: string, context: { e?: InputEvent | MouseEvent }) => {\n      setTValue(value, context);\n    };\n\n    const innerInputProps = computed(() => {\n      const tProps: InputProps = {\n        value: tValue.value,\n        size: props.size,\n        ...props.inputProps,\n      };\n      return tProps;\n    });\n\n    const onInnerFocus: InputProps['onFocus'] = (value, context) => {\n      popupVisible.value = true;\n      props.onFocus?.({ ...context, value });\n    };\n\n    const onInnerSelect: TdAutoCompleteProps['onSelect'] = (value, context) => {\n      if (props.readonly || props.disabled) return;\n      popupVisible.value = false;\n      setTValue(value, context);\n      props.onSelect?.(value, context);\n    };\n\n    const onPopupVisibleChange: PopupProps['onVisibleChange'] = (visible, { trigger }) => {\n      if (trigger !== 'trigger-element-click') {\n        popupVisible.value = visible;\n      }\n    };\n\n    return () => {\n      // 触发元素\n      const triggerNode = renderContent('default', 'content') || (\n        <Input\n          placeholder={props.placeholder ?? global.value.placeholder}\n          tips={props.tips}\n          status={props.status}\n          readonly={props.readonly}\n          disabled={props.disabled}\n          onChange={onInputChange}\n          onFocus={onInnerFocus}\n          {...innerInputProps.value}\n          v-slots={slots}\n        />\n      );\n      // 联想词列表\n      const listContent = (\n        <AutoCompleteOptionList\n          value={tValue.value}\n          options={props.options}\n          size={props.size}\n          sizeClassNames={sizeClassNames}\n          onSelect={onInnerSelect}\n          popupVisible={popupVisible.value}\n          highlightKeyword={props.highlightKeyword}\n          filterable={props.filterable}\n          filter={props.filter}\n          v-slots={{ option: slots.option }}\n        />\n      );\n      const topContent = renderTNodeJSX('panelTopContent');\n      const bottomContent = renderTNodeJSX('panelBottomContent');\n      const panelContent =\n        topContent || listContent || bottomContent ? (\n          <div class={`${classPrefix.value}-autocomplete__panel`}>\n            {topContent}\n            {listContent}\n            {bottomContent}\n          </div>\n        ) : null;\n      const popupProps = {\n        ...props.popupProps,\n        overlayInnerStyle: getOverlayStyle,\n        overlayInnerClassName: popupInnerClasses.value,\n        overlayClassName: popupClasses.value,\n      };\n      return (\n        <div class={classes.value}>\n          <Popup\n            visible={popupVisible.value}\n            onVisibleChange={onPopupVisibleChange}\n            trigger=\"focus\"\n            placement=\"bottom-left\"\n            hideEmptyPopup={true}\n            content={panelContent ? () => panelContent : null}\n            {...popupProps}\n          >\n            {triggerNode}\n          </Popup>\n        </div>\n      );\n    };\n  },\n});\n"],"names":["_isVNode","defineComponent","name","props","setup","slots","toRefs","value","modelValue","useVModel","defaultValue","onChange","_slicedToArray","tValue","setTValue","renderContent","useContent","renderTNodeJSX","useTNodeJSX","useCommonClassName","classPrefix","sizeClassNames","useConfig","global","globalConfig","popupVisible","ref","getOverlayStyle","trigger","popupElement","triggerWidth","getBoundingClientRect","width","offsetWidth","clientWidth","popupWidth","popupProps","overlayInnerStyle","classes","computed","popupClasses","overlayClassName","concat","popupInnerClasses","overlayInnerClassName","onInputChange","context","innerInputProps","tProps","size","inputProps","onInnerFocus","onFocus","onInnerSelect","readonly","disabled","onSelect","onPopupVisibleChange","visible","triggerNode","placeholder","tips","status","listContent","_createVNode","AutoCompleteOptionList","options","highlightKeyword","filterable","filter","option","topContent","bottomContent","panelContent","Popup","_mergeProps"],"mappings":"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"}