{"version":3,"file":"useDraggable.js","sources":["../../../src/tree/hooks/useDraggable.ts"],"sourcesContent":["import { ref, toRefs, inject } from 'vue';\nimport throttle from 'lodash/throttle';\nimport { TreeNode } from '../../_common/js/tree/tree-node';\nimport { DropPosition } from '../interface';\nimport { dragInjectKey } from '../constants';\n\nexport default function useDraggable(props: { nodeRef: HTMLElement | undefined; node: TreeNode }) {\n  const { nodeRef, node } = toRefs(props);\n  const onDrag = inject(dragInjectKey);\n\n  const isDragOver = ref(false);\n  const isDragging = ref(false);\n  const dropPosition = ref<DropPosition>(0);\n\n  const updateDropPosition = throttle((e: DragEvent) => {\n    if (!nodeRef.value) return;\n\n    const rect = nodeRef.value.getBoundingClientRect();\n    const offsetY = window.pageYOffset + rect.top;\n    const { pageY } = e;\n    const gapHeight = rect.height / 4;\n    const diff = pageY - offsetY;\n\n    // 其实三元可行\n    if (diff < gapHeight) {\n      dropPosition.value = -1;\n    } else if (diff < rect.height - gapHeight) {\n      dropPosition.value = 0;\n    } else {\n      dropPosition.value = 1;\n    }\n  });\n\n  const setDragStatus = (status: 'dragStart' | 'dragOver' | 'dragLeave' | 'dragEnd' | 'drop', e: DragEvent) => {\n    switch (status) {\n      case 'dragStart':\n        isDragging.value = true;\n        dropPosition.value = 0;\n        onDrag.onDragStart?.({ node: node.value, e });\n        break;\n      case 'dragEnd':\n        isDragging.value = false;\n        isDragOver.value = false;\n        dropPosition.value = 0;\n        updateDropPosition.cancel();\n        onDrag.onDragEnd?.({ node: node.value, e });\n        break;\n      case 'dragOver':\n        isDragOver.value = true;\n        updateDropPosition(e);\n        onDrag.onDragOver?.({ node: node.value, e });\n        break;\n      case 'dragLeave':\n        isDragOver.value = false;\n        dropPosition.value = 0;\n        updateDropPosition.cancel();\n        onDrag.onDragLeave?.({ node: node.value, e });\n        break;\n      case 'drop':\n        onDrag.onDrop?.({ node: node.value, dropPosition: dropPosition.value, e });\n        isDragOver.value = false;\n        updateDropPosition.cancel();\n        break;\n      default:\n        break;\n    }\n  };\n\n  return {\n    isDragOver,\n    isDragging,\n    dropPosition,\n    setDragStatus,\n  };\n}\n"],"names":["useDraggable","props","toRefs","nodeRef","node","onDrag","inject","dragInjectKey","isDragOver","ref","isDragging","dropPosition","updateDropPosition","throttle","e","value","rect","getBoundingClientRect","offsetY","window","pageYOffset","top","pageY","gapHeight","height","diff","setDragStatus","status","onDragStart","cancel","onDragEnd","onDragOver","onDragLeave","onDrop"],"mappings":"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"}