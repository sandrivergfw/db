{"version":3,"file":"tooltip.js","sources":["../../src/tooltip/tooltip.tsx"],"sourcesContent":["import { computed, defineComponent, onMounted, ref, toRefs, watch, getCurrentInstance } from 'vue';\nimport isFunction from 'lodash/isFunction';\nimport props from './props';\nimport popupProps from '../popup/props';\nimport Popup, { PopupVisibleChangeContext } from '../popup';\nimport { usePrefixClass } from '../hooks/useConfig';\nimport { useTNodeJSX, useContent } from '../hooks/tnode';\nimport { useMouse } from './util';\nimport useVModel from '../hooks/useVModel';\n\nexport default defineComponent({\n  name: 'TTooltip',\n  props: {\n    ...popupProps,\n    ...props,\n  },\n  setup(props, ctx) {\n    const timer = ref(null);\n    const popupRef = ref(null);\n\n    const { visible, modelValue } = toRefs(props);\n    const [innerVisible, setInnerVisible] = useVModel(\n      visible,\n      modelValue,\n      props.defaultVisible,\n      props.onVisibleChange,\n      'visible',\n    );\n    const vm = getCurrentInstance();\n    const innerTooltipVisible = ref(props.visible || props.defaultVisible);\n    const classPrefix = usePrefixClass();\n    const renderTNodeJSX = useTNodeJSX();\n    const renderContent = useContent();\n    const { x } = useMouse();\n    const offsetX = ref(x.value);\n\n    onMounted(() => {\n      if (props.duration && innerTooltipVisible.value) {\n        timer.value = setTimeout(() => {\n          innerTooltipVisible.value = false;\n          clearTimeout(timer.value);\n          timer.value = null;\n        }, props.duration);\n      }\n    });\n\n    const onTipVisibleChange = (val: boolean, ctx?: PopupVisibleChangeContext) => {\n      // 因 props={this.getPopupProps()} 已经透传 onVisibleChange props，此处不再需要使用 emitEvent\n      if (timer.value && ctx?.trigger !== 'document') return;\n      if (val) {\n        offsetX.value = x.value;\n      }\n      setInnerVisible(val, ctx);\n    };\n\n    const tooltipOverlayClassName = computed(() => {\n      return [\n        `${classPrefix.value}-tooltip`,\n        { [`${classPrefix.value}-tooltip--${props.theme}`]: props.theme },\n        props.overlayClassName,\n      ];\n    });\n\n    const popupProps = computed(() => ({\n      ...(vm?.vnode.props || {}),\n      placement: props.placement === 'mouse' ? 'bottom-left' : props.placement,\n      showArrow: props.placement === 'mouse' ? false : props.showArrow,\n      content: () => renderTNodeJSX('content'),\n      default: () => renderContent('default', 'triggerElement'),\n      overlayClassName: tooltipOverlayClassName.value,\n      onVisibleChange: onTipVisibleChange,\n    }));\n\n    const overlayInnerStyle = computed(() => {\n      if (props.placement !== 'mouse' || offsetX.value === 0) {\n        return props.overlayInnerStyle;\n      }\n      const offsetStyle = (triggerEl: HTMLElement) => ({\n        transform: `translateX(${offsetX.value - triggerEl.getBoundingClientRect().left}px)`,\n      });\n      if (props.overlayInnerStyle) {\n        return (triggerEl: HTMLElement, popupEl: HTMLElement) => ({\n          ...offsetStyle(triggerEl),\n          ...(isFunction(props.overlayInnerStyle)\n            ? props.overlayInnerStyle(triggerEl, popupEl)\n            : props.overlayInnerStyle),\n        });\n      }\n      return offsetStyle;\n    });\n\n    watch(\n      () => innerTooltipVisible.value,\n      () => {\n        if (timer.value && !innerTooltipVisible.value) {\n          clearTimeout(timer.value);\n          timer.value = null;\n        }\n      },\n    );\n\n    const onPopupUpdate = () => {\n      popupRef.value?.updatePopper?.();\n    };\n\n    /**\n     * 透传更新popup实例方法，供外部调用\n     */\n    ctx.expose({\n      updatePopper: onPopupUpdate,\n    });\n\n    return () => (\n      <Popup\n        ref={popupRef}\n        {...popupProps.value}\n        overlayInnerStyle={overlayInnerStyle.value}\n        visible={innerVisible.value}\n      />\n    );\n  },\n});\n"],"names":["defineComponent","name","props","popupProps","setup","ctx","timer","ref","popupRef","toRefs","visible","modelValue","useVModel","defaultVisible","onVisibleChange","_slicedToArray","innerVisible","setInnerVisible","vm","getCurrentInstance","innerTooltipVisible","classPrefix","usePrefixClass","renderTNodeJSX","useTNodeJSX","renderContent","useContent","useMouse","x","offsetX","value","onMounted","duration","setTimeout","clearTimeout","onTipVisibleChange","val","trigger","tooltipOverlayClassName","computed","theme","overlayClassName","vnode","placement","showArrow","content","overlayInnerStyle","offsetStyle","triggerEl","transform","getBoundingClientRect","left","popupEl","isFunction","watch","onPopupUpdate","updatePopper","expose","_createVNode","Popup","_mergeProps"],"mappings":"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"}