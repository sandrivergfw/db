{"version":3,"file":"dropdown.js","sources":["../../src/dropdown/dropdown.tsx"],"sourcesContent":["import { defineComponent, ref, computed } from 'vue';\nimport omit from 'lodash/omit';\nimport isArray from 'lodash/isArray';\nimport Popup, { PopupVisibleChangeContext } from '../popup/index';\nimport DropdownMenu from './dropdown-menu';\nimport { DropdownOption, TdDropdownProps } from './type';\nimport props from './props';\nimport { usePrefixClass } from '../hooks/useConfig';\nimport { useTNodeJSX } from '../hooks/tnode';\nimport useDropdownOptions from './hooks/useDropdownOptions';\n\nexport default defineComponent({\n  name: 'TDropdown',\n  props,\n  setup(props: TdDropdownProps, { attrs, slots }) {\n    const renderTNodeJSX = useTNodeJSX();\n    const COMPONENT_NAME = usePrefixClass('dropdown');\n    const popupElem = ref(null);\n    const isPopupVisible = ref(false);\n\n    const manualCloseTimeout = computed(() => {\n      const delay = props.popupProps?.delay;\n      if (typeof delay === 'number') return delay + 10;\n      if (isArray(delay)) return delay[1] + 10 ?? delay[0] + 10;\n      return 160;\n    });\n\n    const handleMenuClick = (data: DropdownOption, context: { e: MouseEvent }) => {\n      if (props.hideAfterItemClick) {\n        setTimeout(() => (isPopupVisible.value = false), manualCloseTimeout.value);\n        props.popupProps?.onVisibleChange?.(false, context);\n      }\n\n      props?.onClick?.(data, context);\n    };\n\n    const handleVisibleChange = (visible: boolean, context: PopupVisibleChangeContext) => {\n      isPopupVisible.value = visible;\n\n      props.popupProps?.onVisibleChange?.(visible, context);\n    };\n\n    return () => {\n      const trigger = renderTNodeJSX('default')?.[0];\n      const options = useDropdownOptions(props);\n\n      const popupParams = {\n        ...attrs,\n        disabled: props.disabled,\n        placement: props.placement,\n        trigger: props.trigger,\n        ...omit(props.popupProps, 'onVisibleChange'),\n        overlayInnerClassName: [\n          COMPONENT_NAME.value,\n          (props.popupProps as TdDropdownProps['popupProps'])?.overlayInnerClassName,\n        ],\n      };\n\n      return (\n        <Popup\n          destroyOnClose={true}\n          ref={popupElem}\n          visible={isPopupVisible.value}\n          onVisibleChange={handleVisibleChange}\n          expandAnimation\n          {...popupParams}\n          v-slots={{\n            content: () => (\n              <DropdownMenu {...omit(props, 'onClick')} options={options.value} onClick={handleMenuClick} />\n            ),\n          }}\n        >\n          {trigger}\n        </Popup>\n      );\n    };\n  },\n});\n"],"names":["defineComponent","name","props","setup","attrs","slots","renderTNodeJSX","useTNodeJSX","COMPONENT_NAME","usePrefixClass","popupElem","ref","isPopupVisible","manualCloseTimeout","computed","delay","popupProps","isArray","handleMenuClick","data","context","hideAfterItemClick","setTimeout","value","onVisibleChange","onClick","handleVisibleChange","visible","trigger","options","useDropdownOptions","popupParams","disabled","placement","omit","overlayInnerClassName","_createVNode","_mergeProps","content","DropdownMenu"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAWA,gBAAeA,eAAgB,CAAA;AAC7BC,EAAAA,IAAM,EAAA,WAAA;AACNC,EAAAA,KAAA,EAAAA,KAAA;EACAC,KAAMD,EAAAA,SAAAA,KAAAA,CAAAA,MAAAA,EAA0C,IAAA,EAAA;IAAhBE,IAAAA,KAAA,QAAAA,KAAA,CAAA;AAAOC,WAAAA;IACrC,IAAMC,iBAAiBC,WAAY,EAAA,CAAA;AAC7B,IAAA,IAAAC,cAAA,GAAiBC,eAAe,UAAU,CAAA,CAAA;AAC1C,IAAA,IAAAC,SAAA,GAAYC,IAAI,IAAI,CAAA,CAAA;AACpB,IAAA,IAAAC,cAAA,GAAiBD,IAAI,KAAK,CAAA,CAAA;AAE1B,IAAA,IAAAE,kBAAA,GAAqBC,SAAS,YAAM;AAAA,MAAA,IAAA,kBAAA,CAAA;AAClC,MAAA,IAAAC,KAAA,GAAQb,CAAAA,kBAAAA,GAAAA,OAAMc,UAAY,MAAA,IAAA,IAAA,kBAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAlBd,mBAAkBa,KAAA,CAAA;MAChC,IAAI,OAAOA,KAAU,KAAA,QAAA,EAAU,OAAOA,KAAQ,GAAA,EAAA,CAAA;MAC9C,IAAIE,QAAQF,KAAK,CAAA,EAAG,OAAOA,MAAM,CAAK,CAAA,GAAA,EAAA,CAAA;AAC/B,MAAA,OAAA,GAAA,CAAA;AACT,KAAC,CAAA,CAAA;IAEK,IAAAG,eAAA,GAAkB,SAAlBA,eAAA,CAAmBC,IAAA,EAAsBC,OAA+B,EAAA;AAAA,MAAA,IAAA,eAAA,CAAA;MAC5E,IAAIlB,OAAMmB,kBAAoB,EAAA;AAAA,QAAA,IAAA,mBAAA,EAAA,qBAAA,CAAA;AAC5BC,QAAAA,UAAA,CAAW,YAAA;AAAA,UAAA,OAAOV,cAAA,CAAeW,KAAQ,GAAA,KAAA,CAAA;SAAQV,EAAAA,mBAAmBU,KAAK,CAAA,CAAA;QACzErB,CAAAA,mBAAAA,GAAAA,MAAM,CAAAc,UAAA,MAANd,IAAAA,IAAAA,mBAAAA,KAAAA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,CAAAA,qBAAAA,GAAAA,mBAAAA,CAAkBsB,eAAkB,MAAA,IAAA,IAAA,qBAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAApCtB,qBAAoC,CAAA,IAAA,CAAA,mBAAA,EAAA,KAAA,EAAOkB,OAAO,CAAA,CAAA;AACpD,OAAA;AAEAlB,MAAAA,MAAAA,KAAAA,IAAAA,IAAAA,MAAAA,KAAAA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,CAAAA,eAAAA,GAAAA,MAAAA,CAAOuB,OAAU,MAAjBvB,IAAAA,IAAAA,eAAAA,KAAAA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,eAAAA,CAAAA,IAAAA,CAAAA,MAAAA,EAAiBiB,IAAA,EAAMC,OAAO,CAAA,CAAA;KAChC,CAAA;IAEM,IAAAM,mBAAA,GAAsB,SAAtBA,mBAAA,CAAuBC,OAAA,EAAkBP,OAAuC,EAAA;AAAA,MAAA,IAAA,mBAAA,EAAA,qBAAA,CAAA;MACpFR,cAAA,CAAeW,KAAQ,GAAAI,OAAA,CAAA;MAEvBzB,CAAAA,mBAAAA,GAAAA,MAAM,CAAAc,UAAA,MAANd,IAAAA,IAAAA,mBAAAA,KAAAA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,CAAAA,qBAAAA,GAAAA,mBAAAA,CAAkBsB,eAAkB,MAAA,IAAA,IAAA,qBAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAApCtB,qBAAoCyB,CAAAA,IAAAA,CAAAA,mBAAAA,EAAAA,OAAA,EAASP,OAAO,CAAA,CAAA;KACtD,CAAA;AAEA,IAAA,OAAO,YAAM;AAAA,MAAA,IAAA,eAAA,EAAA,mBAAA,CAAA;MACL,IAAAQ,OAAA,sBAAUtB,cAAe,CAAA,SAAS,CAAI,MAAA,IAAA,IAAA,eAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAA5B,eAA4B,CAAA,CAAA,CAAA,CAAA;AACtC,MAAA,IAAAuB,OAAA,GAAUC,mBAAmB5B,MAAK,CAAA,CAAA;MAExC,IAAM6B,WAAc,iDACf3B,KAAA,CAAA,EAAA,EAAA,EAAA;QACH4B,UAAU9B,MAAM,CAAA8B,QAAA;QAChBC,WAAW/B,MAAM,CAAA+B,SAAA;QACjBL,SAAS1B,MAAM,CAAA0B,OAAAA;AAAA,OAAA,EACZM,IAAA,CAAKhC,MAAM,CAAAc,UAAA,EAAY,iBAAiB,CAAA,CAAA,EAAA,EAAA,EAAA;QAC3CmB,qBAAuB,EAAA,CACrB3B,cAAe,CAAAe,KAAA,EACdrB,CAAAA,mBAAAA,GAAAA,OAAMc,UAA8C,MAApDd,IAAAA,IAAAA,mBAAAA,KAAAA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,mBAAAA,CAAoDiC,qBAAA,CAAA;OAEzD,CAAA,CAAA;AAEA,MAAA,OAAAC,WAAA,CAAA,KAAA,EAAAC,UAAA,CAAA;AAAA,QAAA,gBAAA,EAEoB,IAAA;AAAA,QAAA,KAAA,EACX3B,SAAA;QAAA,SACIE,EAAAA,cAAA,CAAeW,KACxB;AAAA,QAAA,iBAAA,EAAiBG,mBACjB;AAAA,QAAA,iBAAA,EAAA,IAAA;AAAA,OAAA,EACIK;;kBAOHH;;AALCU,QAAAA,OAAS,EAAA,SAAA,OAAA,GAAA;AAAA,UAAA,OAAAF,WAAA,CAAAG,aAAA,EAAAF,UAAA,CACWH,IAAKhC,CAAAA,MAAAA,EAAO,SAAS,CAAA,EAAA;YAAA,SAAY2B,EAAAA,OAAA,CAAQN,KAAO;YAAA,SAASL,EAAAA,eAAAA;AAAiB,WAAA,CAAA,EAAA,IAAA,CAAA,CAAA;AAAA,SAAA;AAAA,OAAA,CAAA,CAAA;KAOtG,CAAA;AACF,GAAA;AACF,CAAC,CAAA;;;;"}