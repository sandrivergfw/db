{"version":3,"file":"menu.js","sources":["../../src/menu/menu.tsx"],"sourcesContent":["import { defineComponent, ref, computed, provide, watchEffect, watch, onMounted, toRefs } from 'vue';\nimport props from './props';\nimport { MenuValue } from './type';\nimport { TdMenuInterface, TdOpenType } from './const';\nimport { renderContent, renderTNodeJSX } from '../utils/render-tnode';\nimport VMenu from './v-menu';\nimport log from '../_common/js/log/log';\nimport { usePrefixClass } from '../hooks/useConfig';\nimport useVModel from '../hooks/useVModel';\nimport useDefaultValue from '../hooks/useDefaultValue';\n\nexport default defineComponent({\n  name: 'TMenu',\n  props: { ...props, onCollapsed: Function },\n  setup(props, ctx) {\n    const classPrefix = usePrefixClass();\n    watchEffect(() => {\n      if (ctx.slots.options) {\n        log.warnOnce('TMenu', '`options` slot is going to be deprecated, please use `operations` for slot instead.');\n      }\n    });\n    const mode = ref(props.expandType);\n    const theme = computed(() => props.theme);\n    const isMutex = computed(() => props.expandMutex);\n    const menuClass = computed(() => [\n      `${classPrefix.value}-default-menu`,\n      `${classPrefix.value}-menu--${props.theme}`,\n      {\n        [`${classPrefix.value}-is-collapsed`]: props.collapsed,\n      },\n    ]);\n    const innerClasses = computed(() => [\n      `${classPrefix.value}-menu`,\n      { [`${classPrefix.value}-menu--scroll`]: mode.value !== 'popup' },\n      'narrow-scrollbar',\n    ]);\n    const expandWidth = computed(() => {\n      const { width } = props;\n      const format = (val: string | number) => (typeof val === 'number' ? `${val}px` : val);\n      if (Array.isArray(width)) return width.map((item) => format(item));\n\n      return [format(width), '64px'];\n    });\n\n    const styles = computed(() => ({\n      height: '100%',\n      width: props.collapsed ? expandWidth.value[1] : expandWidth.value[0],\n    }));\n\n    const { value, modelValue, expanded } = toRefs(props);\n    const [activeValue, setActiveValue] = useVModel(value, modelValue, props.defaultValue, props.onChange);\n    const [expandValues, setExpand] = useDefaultValue(expanded, props.defaultExpanded, props.onExpand, 'expanded');\n    const activeValues = ref([]);\n\n    watchEffect(() => {\n      mode.value = props.collapsed ? 'popup' : props.expandType;\n      props.onCollapsed?.({ collapsed: props.collapsed });\n    });\n\n    const vMenu = new VMenu({ isMutex, expandValues: expandValues.value ? [...expandValues.value] : [] });\n    provide<TdMenuInterface>('TdMenu', {\n      activeValue,\n      activeValues,\n      expandValues,\n      mode,\n      theme,\n      isHead: false,\n      vMenu,\n      select: (value: MenuValue) => {\n        setActiveValue(value);\n      },\n      open: (value: MenuValue, type: TdOpenType) => {\n        if (mode.value === 'normal') {\n          setExpand(vMenu.expand(value));\n        } else if (type === 'add') {\n          if (expandValues.value.indexOf(value) === -1) {\n            // 可能初始expanded里包含了该value\n            setExpand([...expandValues.value, value]);\n          }\n        } else if (type === 'remove') {\n          const index = expandValues.value.indexOf(value);\n          const tmp = [...expandValues.value];\n          tmp.splice(index, 1);\n          setExpand(tmp);\n        }\n      },\n    });\n\n    // watch\n    watch(\n      () => props.expanded,\n      (value) => {\n        vMenu.expandValues = new Set(value);\n      },\n    );\n    const updateActiveValues = (value: MenuValue) => {\n      activeValues.value = vMenu.select(value);\n    };\n    watch(activeValue, updateActiveValues);\n\n    // timelifes\n    onMounted(() => {\n      activeValues.value = vMenu.select(activeValue.value);\n    });\n\n    return {\n      styles,\n      classPrefix,\n      menuClass,\n      innerClasses,\n      activeValue,\n      activeValues,\n      expandValues,\n    };\n  },\n  render() {\n    const operations = renderContent(this, 'operations', 'options');\n    const logo = renderTNodeJSX(this, 'logo');\n    return (\n      <div class={this.menuClass} style={this.styles}>\n        <div class={`${this.classPrefix}-default-menu__inner`}>\n          {logo && <div class={`${this.classPrefix}-menu__logo`}>{logo}</div>}\n          <ul class={this.innerClasses}>{renderContent(this, 'default', 'content')}</ul>\n          {operations && <div class={`${this.classPrefix}-menu__operations`}>{operations}</div>}\n        </div>\n      </div>\n    );\n  },\n});\n"],"names":["defineComponent","name","props","onCollapsed","Function","setup","ctx","classPrefix","usePrefixClass","watchEffect","slots","options","log","warnOnce","mode","ref","expandType","theme","computed","isMutex","expandMutex","menuClass","value","collapsed","innerClasses","expandWidth","width","format","val","Array","isArray","map","item","styles","height","toRefs","modelValue","expanded","useVModel","defaultValue","onChange","activeValue","setActiveValue","useDefaultValue","defaultExpanded","onExpand","expandValues","setExpand","activeValues","vMenu","VMenu","provide","isHead","select","open","type","expand","indexOf","index","tmp","splice","watch","Set","updateActiveValues","onMounted","render","operations","renderContent","logo","renderTNodeJSX","_createVNode"],"mappings":"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"}