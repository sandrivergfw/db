{"version":3,"file":"anchor-item.js","sources":["../../src/anchor/anchor-item.tsx"],"sourcesContent":["import { defineComponent, h, VNodeChild, onMounted, onUnmounted, inject, watch } from 'vue';\nimport { ANCHOR_SHARP_REGEXP } from './utils';\nimport props from './anchor-item-props';\nimport { usePrefixClass, useCommonClassName } from '../hooks/useConfig';\nimport { AnchorInjectionKey } from './constants';\n\nconst localProps = {\n  ...props,\n  href: {\n    type: String,\n    required: true,\n    validator(v: string): boolean {\n      return ANCHOR_SHARP_REGEXP.test(v);\n    },\n  },\n};\n\nexport default defineComponent({\n  name: 'TAnchorItem',\n  inject: {\n    tAnchor: { default: undefined },\n  },\n  props: localProps,\n  setup(props, { slots }) {\n    const anchor = inject(AnchorInjectionKey, undefined);\n    const CLASSNAME_PREFIX = usePrefixClass('anchor__item');\n    const { STATUS } = useCommonClassName();\n    const register = () => {\n      anchor.registerLink(props.href as string);\n    };\n    const unregister = () => {\n      const { href } = props;\n      if (!href) return;\n      anchor.unregisterLink(href);\n    };\n    const handleClick = (e: MouseEvent) => {\n      const { href, title } = props;\n      anchor.handleScrollTo(href);\n      anchor.handleLinkClick({ href, title: typeof title === 'string' ? title : undefined, e });\n    };\n    const renderTitle = () => {\n      const { title } = props;\n      const { title: titleSlot } = slots;\n      let titleVal: VNodeChild;\n      if (typeof title === 'string') {\n        titleVal = title;\n      } else if (typeof title === 'function') {\n        titleVal = title(h);\n      } else if (titleSlot) {\n        titleVal = titleSlot(null);\n      }\n      return titleVal;\n    };\n    watch(\n      () => props.href,\n      () => {\n        unregister();\n        register();\n      },\n      { immediate: true },\n    );\n    onMounted(() => {\n      register();\n    });\n    onUnmounted(() => {\n      register();\n    });\n    return () => {\n      const { href, target } = props;\n      const { default: children, title: titleSlot } = slots;\n      const title = renderTitle();\n      const titleAttr = typeof title === 'string' ? title : null;\n      const active = anchor.active === href;\n      const wrapperClass = {\n        [CLASSNAME_PREFIX.value]: true,\n        [STATUS.value.active]: active,\n      };\n      const titleClass = {\n        [`${CLASSNAME_PREFIX.value}-link`]: true,\n      };\n      return (\n        <div class={wrapperClass}>\n          <a href={href} title={titleAttr} class={titleClass} target={target} onClick={handleClick}>\n            {titleSlot ? titleSlot(null) : title}\n          </a>\n          {children && children(null)}\n        </div>\n      );\n    };\n  },\n});\n"],"names":["localProps","props","href","type","String","required","validator","v","ANCHOR_SHARP_REGEXP","test","defineComponent","name","inject","tAnchor","setup","slots","anchor","AnchorInjectionKey","CLASSNAME_PREFIX","usePrefixClass","useCommonClassName","STATUS","register","registerLink","unregister","unregisterLink","handleClick","e","title","handleScrollTo","handleLinkClick","renderTitle","titleSlot","titleVal","h","watch","immediate","onMounted","onUnmounted","target","children","titleAttr","active","wrapperClass","value","titleClass","_createVNode"],"mappings":"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"}