{"version":3,"file":"useRipple.js","sources":["../../src/hooks/useRipple.ts"],"sourcesContent":["import { ref, onMounted, onUnmounted, Ref } from 'vue';\nimport useKeepAnimation from './useKeepAnimation';\nimport { usePrefixClass } from './useConfig';\nimport setStyle from '../utils/set-style';\n\nconst period = 200;\nconst noneRippleBg = 'rgba(0, 0, 0, 0)';\nconst defaultRippleColor = 'rgba(0, 0, 0, 0.35)';\n\n// 设置动画颜色 get the ripple animation color\nconst getRippleColor = (el: HTMLElement, fixedRippleColor?: string) => {\n  // get fixed color from params\n  if (fixedRippleColor) {\n    return fixedRippleColor;\n  }\n  // get dynamic color from the dataset\n  if (el?.dataset?.ripple) {\n    const rippleColor = el.dataset.ripple;\n    return rippleColor;\n  }\n  // use css variable\n  const cssVariable = getComputedStyle(el).getPropertyValue('--ripple-color');\n  if (cssVariable) {\n    return cssVariable;\n  }\n  return defaultRippleColor;\n};\n\n/**\n * 斜八角动画hooks 支持三种方式使用\n * 1. fixedRippleColor 固定色值 useRipple(ref,fixedRippleColor);\n * 2. dynamicColor 动态色值 data.ripple=\"rippleColor\" useRipple(ref)\n * 3. CSS variables（recommended） 配合节点对应CSS设置 --ripple-color useRipple(ref)\n * @param ref 需要使用斜八角动画的DOM\n * @param fixedRippleColor 斜八角的动画颜色\n */\nexport default function useRipple(el: Ref<HTMLElement>, fixedRippleColor?: Ref<string>) {\n  const rippleContainer = ref(null);\n  const classPrefix = usePrefixClass();\n\n  // 全局配置ripple\n  const { keepRipple } = useKeepAnimation();\n\n  // 为节点添加斜八角动画 add ripple to the DOM and set up the animation\n  const handleAddRipple = (e: MouseEvent) => {\n    const dom = el.value;\n    const rippleColor = getRippleColor(dom, fixedRippleColor?.value);\n    if (e.button !== 0 || !el || !keepRipple) return;\n\n    if (\n      dom.classList.contains(`${classPrefix.value}-is-active`) ||\n      dom.classList.contains(`${classPrefix.value}-is-disabled`) ||\n      dom.classList.contains(`${classPrefix.value}-is-checked`) ||\n      dom.classList.contains(`${classPrefix.value}-is-loading`)\n    )\n      return;\n\n    const elStyle = getComputedStyle(dom);\n\n    const elBorder = parseInt(elStyle.borderWidth, 10);\n    const border = elBorder > 0 ? elBorder : 0;\n    const width = dom.offsetWidth;\n    const height = dom.offsetHeight;\n\n    if (rippleContainer.value.parentNode === null) {\n      setStyle(rippleContainer.value, {\n        position: 'absolute',\n        left: `${0 - border}px`,\n        top: `${0 - border}px`,\n        width: `${width}px`,\n        height: `${height}px`,\n        borderRadius: elStyle.borderRadius,\n        pointerEvents: 'none',\n        overflow: 'hidden',\n      });\n      dom.appendChild(rippleContainer.value);\n    }\n    // 新增一个ripple\n    const ripple = document.createElement('div');\n\n    setStyle(ripple, {\n      marginTop: '0',\n      marginLeft: '0',\n      right: `${width}px`,\n      width: `${width + 20}px`,\n      height: '100%',\n      transition: `transform ${period}ms cubic-bezier(.38, 0, .24, 1), background ${period * 2}ms linear`,\n      transform: 'skewX(-8deg)',\n      pointerEvents: 'none',\n      position: 'absolute',\n      zIndex: 0,\n      backgroundColor: rippleColor,\n      opacity: '0.9',\n    });\n\n    // fix zIndex：避免遮盖内部元素\n    const elMap = new WeakMap();\n    for (let n = dom.children.length, i = 0; i < n; ++i) {\n      const child = dom.children[i];\n      if ((child as HTMLElement).style.zIndex === '' && child !== rippleContainer.value) {\n        (child as HTMLElement).style.zIndex = '1';\n        elMap.set(child, true);\n      }\n    }\n\n    // fix position\n    const initPosition = dom.style.position ? dom.style.position : getComputedStyle(dom).position;\n    if (initPosition === '' || initPosition === 'static') {\n      // eslint-disable-next-line no-param-reassign\n      dom.style.position = 'relative';\n    }\n    rippleContainer.value.insertBefore(ripple, rippleContainer.value.firstChild);\n\n    setTimeout(() => {\n      ripple.style.transform = `translateX(${width}px)`;\n    }, 0);\n    // 清除动画节点 clear ripple container\n    const handleClearRipple = () => {\n      ripple.style.backgroundColor = noneRippleBg;\n\n      if (!el.value) return;\n\n      el.value.removeEventListener('pointerup', handleClearRipple, false);\n      el.value.removeEventListener('pointerleave', handleClearRipple, false);\n\n      setTimeout(() => {\n        ripple.remove();\n        if (rippleContainer.value.children.length === 0) rippleContainer.value.remove();\n      }, period * 2 + 100);\n    };\n    el.value.addEventListener('pointerup', handleClearRipple, false);\n    el.value.addEventListener('pointerleave', handleClearRipple, false);\n  };\n\n  onMounted(() => {\n    const dom = el?.value;\n    if (!dom) return;\n\n    rippleContainer.value = document.createElement('div');\n\n    dom.addEventListener('pointerdown', handleAddRipple, false);\n  });\n\n  onUnmounted(() => {\n    el?.value?.removeEventListener('pointerdown', handleAddRipple, false);\n  });\n}\n"],"names":["period","noneRippleBg","defaultRippleColor","getRippleColor","el","fixedRippleColor","dataset","ripple","rippleColor","cssVariable","getComputedStyle","getPropertyValue","useRipple","rippleContainer","ref","classPrefix","usePrefixClass","useKeepAnimation","keepRipple","handleAddRipple","e","dom","value","button","classList","contains","elStyle","elBorder","parseInt","borderWidth","border","width","offsetWidth","height","offsetHeight","parentNode","setStyle","position","left","top","borderRadius","pointerEvents","overflow","appendChild","document","createElement","marginTop","marginLeft","right","transition","transform","zIndex","backgroundColor","opacity","elMap","WeakMap","n","children","length","i","child","style","set","initPosition","insertBefore","firstChild","setTimeout","handleClearRipple","removeEventListener","remove","addEventListener","onMounted","onUnmounted"],"mappings":"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"}