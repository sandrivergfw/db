{"version":3,"file":"normal-file.js","sources":["../../../src/upload/themes/normal-file.tsx"],"sourcesContent":["import { defineComponent, toRefs } from 'vue';\nimport {\n  CloseIcon as TdCloseIcon,\n  TimeFilledIcon as TdTimeFilledIcon,\n  CheckCircleFilledIcon as TdCheckCircleFilledIcon,\n  ErrorCircleFilledIcon as TdErrorCircleFilledIcon,\n  CloseCircleFilledIcon as TdCloseCircleFilledIcon,\n} from 'tdesign-icons-vue-next';\nimport TLoading from '../../loading';\nimport Link from '../../link';\nimport { useTNodeJSX } from '../../hooks/tnode';\nimport { UploadFile } from '../type';\nimport { abridgeName } from '../../_common/js/upload/utils';\nimport { useGlobalIcon } from '../../hooks/useGlobalIcon';\nimport { CommonDisplayFileProps } from '../interface';\nimport { commonProps } from '../constants';\n\nexport interface NormalFileProps extends CommonDisplayFileProps {\n  multiple: boolean;\n}\n\nconst NormalFile = defineComponent({\n  name: 'UploadNormalFile',\n\n  props: {\n    multiple: Boolean,\n    ...commonProps,\n  },\n\n  setup(props: NormalFileProps, { slots }) {\n    const { theme, disabled, classPrefix, locale } = toRefs(props);\n\n    const { CloseIcon, TimeFilledIcon, CheckCircleFilledIcon, ErrorCircleFilledIcon, CloseCircleFilledIcon } =\n      useGlobalIcon({\n        CloseIcon: TdCloseIcon,\n        TimeFilledIcon: TdTimeFilledIcon,\n        CheckCircleFilledIcon: TdCheckCircleFilledIcon,\n        ErrorCircleFilledIcon: TdErrorCircleFilledIcon,\n        CloseCircleFilledIcon: TdCloseCircleFilledIcon,\n      });\n\n    const renderTNodeJSX = useTNodeJSX();\n\n    const uploadPrefix = `${classPrefix.value}-upload`;\n\n    const renderProgress = (percent: number) => (\n      <div class={`${uploadPrefix}__single-progress`}>\n        <TLoading />\n        <span class={`${uploadPrefix}__single-percent`}>{percent || 0}%</span>\n      </div>\n    );\n\n    // 文本型预览\n    const renderFilePreviewAsText = (files: UploadFile[]) => {\n      if (theme.value !== 'file') return null;\n      if (!props.multiple && files[0]?.status === 'fail') {\n        return null;\n      }\n      return files.map((file, index) => (\n        <div\n          class={`${uploadPrefix}__single-display-text ${uploadPrefix}__display-text--margin`}\n          key={file.name + index + file.percent + file.status}\n        >\n          {file.url ? (\n            <Link href={file.url} target=\"_blank\" hover=\"color\" size=\"small\" class={`${uploadPrefix}__single-name`}>\n              {file.name}\n            </Link>\n          ) : (\n            <span class={`${uploadPrefix}__single-name`}>{file.name}</span>\n          )}\n          {file.status === 'fail' && (\n            <div class={`${uploadPrefix}__flow-status`}>\n              <ErrorCircleFilledIcon />\n            </div>\n          )}\n          {file.status === 'waiting' && (\n            <div class={`${uploadPrefix}__flow-status`}>\n              <TimeFilledIcon />\n            </div>\n          )}\n          {file.status === 'progress' && renderProgress(file.percent)}\n          {!disabled.value && file.status !== 'progress' && (\n            <CloseIcon\n              class={`${uploadPrefix}__icon-delete`}\n              onClick={(e: MouseEvent) => props.onRemove({ e, file, index })}\n            />\n          )}\n        </div>\n      ));\n    };\n\n    // 输入框型预览\n    const renderFilePreviewAsInput = () => {\n      if (theme.value !== 'file-input') return;\n      const file = props.displayFiles[0];\n      const inputTextClass = [\n        `${classPrefix.value}-input__inner`,\n        { [`${uploadPrefix}__placeholder`]: !props.displayFiles[0] },\n      ];\n      const disabledClass = disabled.value ? `${classPrefix.value}-is-disabled` : '';\n      const fileName =\n        props.abridgeName?.length && file?.name ? abridgeName(file.name, ...props.abridgeName) : file?.name;\n      return (\n        <div class={`${uploadPrefix}__single-input-preview ${classPrefix.value}-input ${disabledClass}`}>\n          <div class={inputTextClass}>\n            <span class={`${uploadPrefix}__single-input-text`}>{file?.name ? fileName : props.placeholder}</span>\n            {file?.status === 'progress' && renderProgress(file.percent)}\n            {file?.status === 'waiting' && <TimeFilledIcon class={`${uploadPrefix}__status-icon`} />}\n            {file?.url && file.status === 'success' && <CheckCircleFilledIcon class={`${uploadPrefix}__status-icon`} />}\n            {file?.name && file.status === 'fail' && <ErrorCircleFilledIcon class={`${uploadPrefix}__status-icon`} />}\n            {!disabled.value && (\n              <CloseCircleFilledIcon\n                class={`${uploadPrefix}__single-input-clear`}\n                onClick={({ e }: { e: MouseEvent }) => props.onRemove({ e, file, index: 0 })}\n              />\n            )}\n          </div>\n        </div>\n      );\n    };\n\n    return () => {\n      const classes = [`${uploadPrefix}__single`, `${uploadPrefix}__single-${theme.value}`];\n      const fileListDisplay = renderTNodeJSX('fileListDisplay', { params: { files: props.displayFiles } });\n      const { displayFiles } = props;\n      return (\n        <div class={classes}>\n          {theme.value === 'file-input' && renderFilePreviewAsInput()}\n\n          {slots.default?.()}\n\n          {theme.value === 'file' && props.placeholder && !displayFiles[0] && (\n            <small class={props.tipsClasses}>{props.placeholder}</small>\n          )}\n\n          {fileListDisplay || renderFilePreviewAsText(displayFiles)}\n\n          {props.sizeOverLimitMessage && <small class={props.errorClasses}>{props.sizeOverLimitMessage}</small>}\n\n          {/* 单文件上传失败要显示失败的原因 */}\n          {!props.multiple && displayFiles[0]?.status === 'fail' && theme.value === 'file' ? (\n            <small class={props.errorClasses}>\n              {displayFiles[0].response?.error || locale.value.progress.failText}\n            </small>\n          ) : null}\n        </div>\n      );\n    };\n  },\n});\n\nexport default NormalFile;\n"],"names":["NormalFile","defineComponent","name","props","multiple","Boolean","commonProps","setup","slots","toRefs","theme","disabled","classPrefix","locale","useGlobalIcon","CloseIcon","TdCloseIcon","TimeFilledIcon","TdTimeFilledIcon","CheckCircleFilledIcon","TdCheckCircleFilledIcon","ErrorCircleFilledIcon","TdErrorCircleFilledIcon","CloseCircleFilledIcon","TdCloseCircleFilledIcon","renderTNodeJSX","useTNodeJSX","uploadPrefix","value","renderProgress","percent","_createVNode","TLoading","renderFilePreviewAsText","files","status","map","file","index","url","e","onRemove","renderFilePreviewAsInput","displayFiles","inputTextClass","disabledClass","fileName","abridgeName","length","placeholder","classes","fileListDisplay","params","tipsClasses","sizeOverLimitMessage","errorClasses","response","error","progress","failText"],"mappings":"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"}