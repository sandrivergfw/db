{"version":3,"file":"useMultiple.mjs","sources":["../../src/select-input/useMultiple.tsx"],"sourcesContent":["import { SetupContext, computed, ref, toRefs } from 'vue';\nimport isObject from 'lodash/isObject';\nimport { TdSelectInputProps, SelectInputChangeContext, SelectInputKeys } from './type';\nimport { SelectInputCommonProperties } from './interface';\nimport { InputValue } from '../input';\nimport TagInput, { TagInputValue, InputValueChangeContext } from '../tag-input';\nimport Loading from '../loading';\nimport useDefault from '../hooks/useDefaultValue';\nimport { usePrefixClass } from '../hooks/useConfig';\nimport { useFormDisabled } from '../form/hooks';\n\nexport interface RenderSelectMultipleParams {\n  commonInputProps: SelectInputCommonProperties;\n  onInnerClear: (context: { e: MouseEvent }) => void;\n  popupVisible: boolean;\n}\n\nconst DEFAULT_KEYS = {\n  label: 'label',\n  key: 'key',\n  children: 'children',\n};\n\nexport default function useMultiple(props: TdSelectInputProps, context: SetupContext) {\n  const { inputValue } = toRefs(props);\n  const classPrefix = usePrefixClass();\n  const tagInputRef = ref();\n  const [tInputValue, setTInputValue] = useDefault(\n    inputValue,\n    props.defaultInputValue,\n    props.onInputChange,\n    'inputValue',\n  );\n  const disable = useFormDisabled();\n\n  const iKeys = computed<SelectInputKeys>(() => ({ ...DEFAULT_KEYS, ...props.keys }));\n  const tags = computed<TagInputValue>(() => {\n    if (!(props.value instanceof Array)) {\n      return isObject(props.value) ? [props.value[iKeys.value.label]] : [props.value];\n    }\n    return props.value.map((item) => (isObject(item) ? item[iKeys.value.label] : item));\n  });\n\n  const tPlaceholder = computed<string>(() => (!tags.value || !tags.value.length ? props.placeholder : ''));\n\n  const onTagInputChange = (val: TagInputValue, context: SelectInputChangeContext) => {\n    // 避免触发浮层的显示或隐藏\n    if (context.trigger === 'tag-remove') {\n      context.e?.stopPropagation();\n    }\n    props.onTagChange?.(val, context);\n  };\n\n  const renderSelectMultiple = (p: RenderSelectMultipleParams) => {\n    const tagInputProps = {\n      ...p.commonInputProps,\n      tagProps: props.tagProps,\n      label: props.label,\n      autoWidth: props.autoWidth,\n      readonly: props.readonly,\n      placeholder: tPlaceholder.value,\n      minCollapsedNum: props.minCollapsedNum,\n      collapsedItems: props.collapsedItems,\n      tag: props.tag,\n      value: tags.value,\n      valueDisplay: props.valueDisplay,\n      inputValue: tInputValue.value || '',\n      inputProps: {\n        readonly: !props.allowInput || props.readonly,\n        inputClass: {\n          [`${classPrefix.value}-input--focused`]: p.popupVisible,\n        },\n        ...props.inputProps,\n      },\n      suffixIcon: !disable.value && props.loading ? () => <Loading loading size=\"small\" /> : props.suffixIcon,\n      ...props.tagInputProps,\n    };\n\n    return (\n      <TagInput\n        ref=\"tagInputRef\"\n        {...tagInputProps}\n        v-slots={context.slots}\n        onInputChange={(val: InputValue, context: InputValueChangeContext) => {\n          // 筛选器统一特性：筛选器按下回车时不清空输入框\n          if (context?.trigger === 'enter') return;\n          setTInputValue(val, { trigger: context.trigger, e: context.e });\n        }}\n        onChange={onTagInputChange}\n        onClear={p.onInnerClear}\n        onBlur={(val, context) => {\n          props.onBlur?.(props.value, { ...context, tagInputValue: val });\n        }}\n        onEnter={(val, context) => {\n          props.onEnter?.(props.value, { ...context, inputValue: tInputValue.value });\n        }}\n        onFocus={(val, context) => {\n          props.onFocus?.(props.value, { ...context, tagInputValue: val });\n        }}\n      />\n    );\n  };\n\n  return {\n    tags,\n    tPlaceholder,\n    tagInputRef,\n    renderSelectMultiple,\n  };\n}\n"],"names":["DEFAULT_KEYS","label","key","children","useMultiple","props","context","toRefs","inputValue","classPrefix","usePrefixClass","tagInputRef","ref","useDefault","defaultInputValue","onInputChange","tInputValue","setTInputValue","disable","useFormDisabled","iKeys","computed","keys","tags","value","Array","isObject","map","item","tPlaceholder","length","placeholder","onTagInputChange","val","trigger","e","stopPropagation","onTagChange","renderSelectMultiple","p","tagInputProps","commonInputProps","tagProps","autoWidth","readonly","minCollapsedNum","collapsedItems","tag","valueDisplay","inputProps","allowInput","inputClass","popupVisible","suffixIcon","loading","_createVNode","_mergeProps","onInnerClear","onBlur","tagInputValue","onEnter","onFocus","slots"],"mappings":"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"}