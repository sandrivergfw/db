{"version":3,"file":"useLazyLoad.mjs","sources":["../../../src/table/hooks/useLazyLoad.ts"],"sourcesContent":["import { ref, onMounted, computed, nextTick, Ref, UnwrapRef } from 'vue';\nimport observe from '../../_common/js/utils/observe';\nimport { isServer } from '../../utils/dom';\n\nexport type UseLazyLoadParams = UnwrapRef<{\n  type: 'lazy' | 'virtual';\n  rowIndex: number;\n  rowHeight?: number;\n  bufferSize?: number;\n}>;\n\nexport default function useLazyLoad(\n  containerRef: Ref<HTMLElement>,\n  childRef: Ref<HTMLTableRowElement>,\n  params: UseLazyLoadParams,\n) {\n  const tRowHeight = computed(() => Math.max(params.rowHeight || 48, 48));\n  const isInit = ref(params.rowIndex === 0);\n  const hasLazyLoadHolder = computed(() => params?.type === 'lazy' && !isInit.value);\n\n  const requestAnimationFrame = (!isServer && window.requestAnimationFrame) || ((cb) => setTimeout(cb, 16.6));\n\n  const init = () => {\n    if (!isInit.value) {\n      requestAnimationFrame(() => {\n        isInit.value = true;\n      });\n    }\n  };\n\n  onMounted(() => {\n    if (params?.type !== 'lazy') return;\n    nextTick(() => {\n      const bufferSize = Math.max(10, params.bufferSize || 10);\n      const height = tRowHeight.value * bufferSize;\n      observe(childRef.value, containerRef.value, init, height);\n    });\n  });\n\n  return {\n    hasLazyLoadHolder,\n    tRowHeight,\n  };\n}\n"],"names":["useLazyLoad","containerRef","childRef","params","tRowHeight","computed","Math","max","rowHeight","isInit","ref","rowIndex","hasLazyLoadHolder","type","value","requestAnimationFrame","isServer","window","cb","setTimeout","init","onMounted","nextTick","bufferSize","height","observe"],"mappings":";;;;;;;;;;;;;;;;;AAWwB,SAAAA,WAAA,CACtBC,YACA,EAAAC,QAAA,EACAC,MACA,EAAA;EACM,IAAAC,UAAA,GAAaC,SAAS,YAAA;IAAA,OAAMC,IAAA,CAAKC,IAAIJ,MAAO,CAAAK,SAAA,IAAa,EAAI,EAAA,EAAE,CAAC,CAAA;GAAA,CAAA,CAAA;EACtE,IAAMC,MAAS,GAAAC,GAAA,CAAIP,MAAO,CAAAQ,QAAA,KAAa,CAAC,CAAA,CAAA;EAClC,IAAAC,iBAAA,GAAoBP,SAAS,YAAA;AAAA,IAAA,OAAM,CAAAF,MAAA,KAAAA,IAAAA,IAAAA,MAAA,uBAAAA,MAAA,CAAQU,UAAS,MAAU,IAAA,CAACJ,OAAOK,KAAK,CAAA;GAAA,CAAA,CAAA;EAE3E,IAAAC,qBAAA,GAAyB,CAACC,QAAY,IAAAC,MAAA,CAAOF,yBAA2B,UAACG,EAAA,EAAA;AAAA,IAAA,OAAOC,UAAW,CAAAD,EAAA,EAAI,IAAI,CAAA,CAAA;GAAA,CAAA;AAEzG,EAAA,IAAME,OAAO,SAAPA,OAAa;AACb,IAAA,IAAA,CAACX,OAAOK,KAAO,EAAA;AACjBC,MAAAA,qBAAA,CAAsB,YAAM;QAC1BN,MAAA,CAAOK,KAAQ,GAAA,IAAA,CAAA;AACjB,OAAC,CAAA,CAAA;AACH,KAAA;GACF,CAAA;AAEAO,EAAAA,SAAA,CAAU,YAAM;IACd,IAAI,CAAAlB,mBAAAA,6BAAAA,OAAQU,IAAS,MAAA,MAAA,EAAQ,OAAA;AAC7BS,IAAAA,QAAA,CAAS,YAAM;AACb,MAAA,IAAMC,aAAajB,IAAK,CAAAC,GAAA,CAAI,EAAI,EAAAJ,MAAA,CAAOoB,cAAc,EAAE,CAAA,CAAA;AACjD,MAAA,IAAAC,MAAA,GAASpB,WAAWU,KAAQ,GAAAS,UAAA,CAAA;AAClCE,MAAAA,OAAA,CAAQvB,QAAS,CAAAY,KAAA,EAAOb,YAAa,CAAAa,KAAA,EAAOM,MAAMI,MAAM,CAAA,CAAA;AAC1D,KAAC,CAAA,CAAA;AACH,GAAC,CAAA,CAAA;EAEM,OAAA;AACLZ,IAAAA,iBAAA,EAAAA,iBAAA;AACAR,IAAAA,UAAA,EAAAA,UAAAA;GACF,CAAA;AACF;;;;"}