{"version":3,"file":"usePagination.mjs","sources":["../../../src/table/hooks/usePagination.tsx"],"sourcesContent":["import { ref, SetupContext, toRefs, watch } from 'vue';\nimport { useConfig } from '../../hooks/useConfig';\nimport Pagination, { PageInfo } from '../../pagination';\nimport { TdBaseTableProps, TableRowData } from '../type';\n\n// 分页功能包含：远程数据排序受控、远程数据排序非受控、本地数据排序受控、本地数据排序非受控 等 4 类功能\nexport default function usePagination(props: TdBaseTableProps) {\n  const { pagination, data, disableDataPage } = toRefs(props);\n  const { classPrefix } = useConfig();\n\n  const dataSource = ref<TableRowData[]>([]);\n  const isPaginateData = ref(false);\n\n  const updateDataSourceAndPaginate = (current = 1, pageSize = 10) => {\n    const { data } = props;\n    // data 数据数量超出分页大小时，则自动启动本地数据分页\n    const t = Boolean(!disableDataPage.value && data.length > pageSize);\n    isPaginateData.value = t;\n    if (t) {\n      const start = (current - 1) * pageSize;\n      const end = current * pageSize;\n      dataSource.value = data.slice(start, end);\n    } else {\n      dataSource.value = data;\n    }\n  };\n\n  // 受控情况，只有 pagination.current 或者 pagination.pageSize 变化，才对数据进行排序\n  watch(\n    () => [pagination.value?.current, pagination.value?.pageSize, data.value.length, disableDataPage],\n    () => {\n      if (!pagination.value || !pagination.value.current) return;\n      updateDataSourceAndPaginate(pagination.value.current, pagination.value.pageSize);\n    },\n    { immediate: true },\n  );\n\n  // 非受控情况，只执行一次 Props 数据更新（pagination.defaultCurrent 和 pagination.defaultPageSize）\n  watch(\n    [data],\n    () => {\n      if (!pagination.value || !pagination.value.defaultCurrent) return;\n      updateDataSourceAndPaginate(pagination.value.defaultCurrent, pagination.value.defaultPageSize);\n    },\n    { immediate: true },\n  );\n\n  const renderPagination = () => {\n    if (!props.pagination) return null;\n    const paginationProps = { ...props.pagination };\n    // Vue3，两个 onChange 事件绑定，会成为数组，因为需提前移除外部 onChange\n    delete paginationProps.onChange;\n    return (\n      <div class={`${classPrefix.value}-table__pagination`}>\n        <Pagination\n          {...paginationProps}\n          onChange={(pageInfo: PageInfo) => {\n            props.pagination?.onChange?.(pageInfo);\n            props.onPageChange?.(pageInfo, dataSource.value);\n            // 如果是非受控情况的分页变化，还需更新分页数据（data）\n            if (pagination && !pagination.value.current && pagination.value.defaultCurrent) {\n              updateDataSourceAndPaginate(pageInfo.current, pageInfo.pageSize);\n            }\n          }}\n        />\n      </div>\n    );\n  };\n\n  return {\n    isPaginateData,\n    dataSource,\n    renderPagination,\n  };\n}\n"],"names":["usePagination","props","toRefs","pagination","data","disableDataPage","useConfig","classPrefix","dataSource","ref","isPaginateData","updateDataSourceAndPaginate","current","pageSize","t","Boolean","value","length","start","end","slice","watch","immediate","defaultCurrent","defaultPageSize","renderPagination","paginationProps","onChange","_createVNode","_mergeProps","pageInfo","onPageChange"],"mappings":"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"}