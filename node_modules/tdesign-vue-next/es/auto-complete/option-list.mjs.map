{"version":3,"file":"option-list.mjs","sources":["../../src/auto-complete/option-list.tsx"],"sourcesContent":["import { ref, computed, defineComponent, PropType, h, watch, onBeforeUnmount } from 'vue';\nimport isFunction from 'lodash/isFunction';\nimport HighlightOption from './highlight-option';\nimport { CommonClassNameType } from '../hooks/useCommonClassName';\nimport { AutoCompleteOptionObj, TdAutoCompleteProps } from './type';\nimport log from '../_common/js/log';\nimport { usePrefixClass } from '../hooks/useConfig';\n\nexport default defineComponent({\n  name: 'AutoCompleteOptionList',\n\n  props: {\n    sizeClassNames: Object as PropType<CommonClassNameType['sizeClassNames']>,\n    value: String,\n    size: String as PropType<TdAutoCompleteProps['size']>,\n    options: Array as PropType<TdAutoCompleteProps['options']>,\n    popupVisible: Boolean,\n    highlightKeyword: Boolean,\n    filterable: Boolean,\n    filter: Function as PropType<TdAutoCompleteProps['filter']>,\n  },\n\n  emits: ['select'],\n\n  setup(props, { emit, slots }) {\n    const active = ref('');\n    const classPrefix = usePrefixClass();\n\n    const classes = computed(() => `${classPrefix.value}-select__list`);\n    const optionClasses = computed(() => [\n      `${classPrefix.value}-select-option`,\n      {\n        [props.sizeClassNames[props.size]]: props.size,\n      },\n    ]);\n\n    // 整理数据格式\n    const tOptions = computed<AutoCompleteOptionObj[]>(() => {\n      let options = props.options.map((item) => {\n        let option: AutoCompleteOptionObj = {};\n        if (typeof item === 'string') {\n          option = { text: item, label: item };\n        } else {\n          if (item.text && typeof item.text !== 'string') {\n            log.warn('AutoComplete', '`text` must be a string.');\n          }\n          if (!item.text) {\n            if (typeof item.label === 'string') {\n              option = { ...item, text: item.label };\n            } else {\n              log.warn('AutoComplete', 'one of `label` and `text` must be a existed string.');\n            }\n          } else {\n            option = item;\n          }\n        }\n        return option;\n      });\n      // 默认过滤规则\n      if (props.filterable) {\n        const regExp = new RegExp(props.value, 'i');\n        options = options.filter((item) => regExp.test(item.text));\n      }\n      if (props.filter) {\n        options = options.filter((option) => props.filter(props.value, option));\n      }\n      return options;\n    });\n\n    const onOptionClick = (e: MouseEvent) => {\n      let liNode = e.target as HTMLElement;\n      while (liNode && liNode.tagName !== 'LI') {\n        liNode = liNode.parentNode as HTMLElement;\n      }\n      const keyword = liNode.getAttribute('title');\n      active.value = keyword;\n      emit('select', keyword, { e });\n    };\n\n    // 键盘事件，上下选择\n    const onKeyInnerPress = (e: KeyboardEvent) => {\n      if (e.code === 'ArrowUp' || e.key === 'ArrowUp') {\n        const index = tOptions.value.findIndex((item) => item.text === active.value);\n        const newIndex = index - 1 < 0 ? tOptions.value.length - 1 : index - 1;\n        active.value = tOptions.value[newIndex].text;\n      } else if (e.code === 'ArrowDown' || e.key === 'ArrowDown') {\n        const index = tOptions.value.findIndex((item) => item.text === active.value);\n        const newIndex = index + 1 >= tOptions.value.length ? 0 : index + 1;\n        active.value = tOptions.value[newIndex].text;\n      } else if (e.code === 'Enter' || e.key === 'Enter') {\n        emit('select', active.value, { e });\n      }\n    };\n\n    watch(\n      () => props.popupVisible,\n      () => {\n        if (props.popupVisible) {\n          document.addEventListener('keydown', onKeyInnerPress);\n        } else {\n          document.removeEventListener('keydown', onKeyInnerPress);\n        }\n      },\n      { immediate: true },\n    );\n\n    watch(\n      () => props.value,\n      () => {\n        if (!props.value) {\n          active.value = '';\n        }\n      },\n      { immediate: true },\n    );\n\n    onBeforeUnmount(() => {\n      document.removeEventListener('keydown', onKeyInnerPress);\n    });\n\n    return () => {\n      if (!tOptions.value.length) return null;\n      return (\n        <ul class={classes.value}>\n          {tOptions.value.map((item) => {\n            const cls = [...optionClasses.value];\n            if (item.text === active.value) {\n              cls.push(`${classPrefix.value}-select-option--hover`);\n            }\n            let labelNode: any = item.label;\n            if (isFunction(item.label)) {\n              labelNode = item.label(h);\n            } else if (slots.option) {\n              labelNode = slots.option?.({ option: item });\n            }\n            const content = labelNode || item.text;\n            return (\n              <li class={cls} title={item.text} onClick={onOptionClick}>\n                {typeof content === 'string' && props.highlightKeyword ? (\n                  <HighlightOption content={content} keyword={props.value} />\n                ) : (\n                  content\n                )}\n              </li>\n            );\n          })}\n        </ul>\n      );\n    };\n  },\n});\n"],"names":["defineComponent","name","props","sizeClassNames","Object","value","String","size","options","Array","popupVisible","Boolean","highlightKeyword","filterable","filter","Function","emits","setup","emit","slots","active","ref","classPrefix","usePrefixClass","classes","computed","optionClasses","tOptions","map","item","option","text","label","log","warn","regExp","RegExp","test","onOptionClick","e","liNode","target","tagName","parentNode","keyword","getAttribute","onKeyInnerPress","code","key","index","findIndex","newIndex","length","watch","document","addEventListener","removeEventListener","immediate","onBeforeUnmount","_createVNode","cls","push","labelNode","isFunction","h","content","HighlightOption"],"mappings":"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"}