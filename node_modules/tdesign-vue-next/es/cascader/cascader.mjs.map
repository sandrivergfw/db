{"version":3,"file":"cascader.mjs","sources":["../../src/cascader/cascader.tsx"],"sourcesContent":["import { defineComponent, computed } from 'vue';\nimport omit from 'lodash/omit';\nimport Panel from './components/Panel';\nimport SelectInput from '../select-input';\nimport FakeArrow from '../common-components/fake-arrow';\nimport props from './props';\n\nimport { useCascaderContext } from './hooks';\nimport { CascaderValue, TdSelectInputProps, TdCascaderProps } from './interface';\nimport { useConfig, usePrefixClass, useCommonClassName } from '../hooks/useConfig';\n\nimport { closeIconClickEffect, handleRemoveTagEffect } from './core/effect';\nimport { getPanels, getSingleContent, getMultipleContent } from './core/helper';\nimport { getFakeArrowIconClass } from './core/className';\nimport { useFormDisabled } from '../form/hooks';\n\nexport default defineComponent({\n  name: 'TCascader',\n\n  props: { ...props },\n\n  setup(props, { slots }) {\n    const disabled = useFormDisabled();\n    const COMPONENT_NAME = usePrefixClass('cascader');\n    const classPrefix = usePrefixClass();\n    const { STATUS } = useCommonClassName();\n    const overlayClassName = usePrefixClass('cascader__popup');\n    const { globalConfig } = useConfig('cascader');\n\n    // 拿到全局状态的上下文\n    const { cascaderContext, isFilterable } = useCascaderContext(props);\n\n    const displayValue = computed(() =>\n      props.multiple ? getMultipleContent(cascaderContext.value) : getSingleContent(cascaderContext.value),\n    );\n\n    const panels = computed(() => getPanels(cascaderContext.value.treeNodes));\n\n    const inputPlaceholder = computed(\n      () =>\n        (cascaderContext.value.visible && !props.multiple && getSingleContent(cascaderContext.value)) ||\n        (props.placeholder ?? globalConfig.value.placeholder),\n    );\n\n    const renderSuffixIcon = () => {\n      const { visible, disabled } = cascaderContext.value;\n      return (\n        <FakeArrow\n          overlayClassName={getFakeArrowIconClass(classPrefix.value, STATUS.value, cascaderContext.value)}\n          isActive={visible}\n          disabled={disabled}\n        />\n      );\n    };\n\n    return () => {\n      const { setVisible, visible, inputVal, setInputVal } = cascaderContext.value;\n\n      return (\n        <SelectInput\n          class={COMPONENT_NAME.value}\n          value={displayValue.value}\n          inputValue={visible ? inputVal : ''}\n          popupVisible={visible}\n          keys={props.keys}\n          allowInput={isFilterable.value}\n          min-collapsed-num={props.minCollapsedNum}\n          collapsed-items={props.collapsedItems}\n          readonly={props.readonly}\n          disabled={props.disabled}\n          clearable={props.clearable}\n          placeholder={inputPlaceholder.value}\n          multiple={props.multiple}\n          loading={props.loading}\n          status={props.status}\n          tips={props.tips}\n          suffixIcon={() => renderSuffixIcon()}\n          popupProps={{\n            ...(props.popupProps as TdCascaderProps['popupProps']),\n            overlayInnerStyle: panels.value.length && !props.loading ? { width: 'auto' } : '',\n            overlayClassName: [\n              overlayClassName.value,\n              (props.popupProps as TdCascaderProps['popupProps'])?.overlayClassName,\n            ],\n          }}\n          inputProps={{ size: props.size, ...(props.inputProps as TdCascaderProps['inputProps']) }}\n          tagInputProps={{\n            size: props.size,\n            ...(props.tagInputProps as TdCascaderProps['tagInputProps']),\n          }}\n          tagProps={{ ...(props.tagProps as TdCascaderProps['tagProps']) }}\n          onInputChange={(value, ctx) => {\n            if (!isFilterable.value) return;\n            setInputVal(`${value}`);\n            (props?.selectInputProps as TdSelectInputProps)?.onInputChange?.(value, ctx);\n          }}\n          onTagChange={(val: CascaderValue, ctx) => {\n            // 按 enter 键不处理\n            if (ctx.trigger === 'enter') return;\n            handleRemoveTagEffect(cascaderContext.value, ctx.index, props.onRemove);\n            (props?.selectInputProps as TdSelectInputProps)?.onTagChange?.(val, ctx);\n          }}\n          onPopupVisibleChange={(val: boolean, context) => {\n            if (disabled.value) return;\n            setVisible(val, context);\n            (props?.selectInputProps as TdSelectInputProps)?.onPopupVisibleChange?.(val, context);\n          }}\n          onBlur={(val, context) => {\n            props.onBlur?.({\n              value: cascaderContext.value.value,\n              e: context.e,\n            });\n            (props?.selectInputProps as TdSelectInputProps)?.onBlur?.(val, context);\n          }}\n          onFocus={(val, context) => {\n            props.onFocus?.({\n              value: cascaderContext.value.value,\n              e: context.e,\n            });\n            (props?.selectInputProps as TdSelectInputProps)?.onFocus?.(val, context);\n          }}\n          onClear={(context: { e: MouseEvent }) => {\n            closeIconClickEffect(cascaderContext.value);\n            (props?.selectInputProps as TdSelectInputProps)?.onClear?.(context);\n          }}\n          v-slots={{\n            panel: () => (\n              <Panel\n                empty={props.empty}\n                visible={visible}\n                trigger={props.trigger}\n                loading={props.loading}\n                loadingText={props.loadingText}\n                cascaderContext={cascaderContext.value}\n                v-slots={{ empty: slots.empty, loadingText: slots.loadingText }}\n              />\n            ),\n            collapsedItems: slots.collapsedItems,\n          }}\n          {...omit(props.selectInputProps as TdSelectInputProps, [\n            'onTagChange',\n            'onInputChange',\n            'onPopupVisibleChange',\n            'onBlur',\n            'onFocus',\n            'onClear',\n          ])}\n        />\n      );\n    };\n  },\n});\n"],"names":["defineComponent","name","props","setup","slots","disabled","useFormDisabled","COMPONENT_NAME","usePrefixClass","classPrefix","useCommonClassName","STATUS","overlayClassName","useConfig","globalConfig","useCascaderContext","cascaderContext","isFilterable","displayValue","computed","multiple","getMultipleContent","value","getSingleContent","panels","getPanels","treeNodes","inputPlaceholder","visible","placeholder","renderSuffixIcon","_createVNode","getFakeArrowIconClass","setVisible","inputVal","setInputVal","_mergeProps","keys","minCollapsedNum","collapsedItems","readonly","clearable","loading","status","tips","popupProps","overlayInnerStyle","length","width","size","inputProps","tagInputProps","tagProps","ctx","selectInputProps","onInputChange","val","trigger","handleRemoveTagEffect","index","onRemove","onTagChange","context","onPopupVisibleChange","onBlur","e","onFocus","closeIconClickEffect","onClear","omit","panel","empty","loadingText"],"mappings":"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"}