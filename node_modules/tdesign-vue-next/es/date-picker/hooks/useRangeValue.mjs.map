{"version":3,"file":"useRangeValue.mjs","sources":["../../../src/date-picker/hooks/useRangeValue.ts"],"sourcesContent":["import { ref, toRefs, watchEffect, computed } from 'vue';\nimport dayjs from 'dayjs';\nimport useVModel from '../../hooks/useVModel';\n\nimport { TdDateRangePickerProps, DateRangeValue } from '../type';\nimport {\n  isValidDate,\n  formatDate,\n  formatTime,\n  getDefaultFormat,\n  parseToDayjs,\n} from '../../_common/js/date-picker/format';\nimport { extractTimeFormat } from '../../_common/js/date-picker/utils';\n\nexport const PARTIAL_MAP = { first: 'start', second: 'end' };\n\n// 初始化面板年份月份\nexport function initYearMonthTime({\n  value,\n  mode = 'date',\n  format,\n  timeFormat = 'HH:mm:ss',\n  enableTimePicker,\n}: {\n  value: DateRangeValue;\n  mode: string;\n  format: string;\n  timeFormat?: string;\n  enableTimePicker?: boolean;\n}) {\n  const defaultYearMonthTime = {\n    year: [dayjs().year(), dayjs().year()],\n    month: [dayjs().month(), dayjs().month()],\n    time: [dayjs().format(timeFormat), dayjs().format(timeFormat)],\n  };\n  if (mode === 'year') {\n    defaultYearMonthTime.year[1] += 10;\n  } else if (mode === 'month' || mode === 'quarter') {\n    defaultYearMonthTime.year[1] += 1;\n  } else if ((mode === 'date' || mode === 'week') && !enableTimePicker) {\n    defaultYearMonthTime.month[1] += 1;\n  }\n\n  if (!value || !Array.isArray(value) || !value.length) {\n    return defaultYearMonthTime;\n  }\n\n  return {\n    year: value.map((v) => parseToDayjs(v, format).year()),\n    month: value.map((v) => parseToDayjs(v, format).month()),\n    time: value.map((v) => parseToDayjs(v, format).format(timeFormat)),\n  };\n}\n\nexport default function useRangeValue(props: TdDateRangePickerProps) {\n  const { value: valueFromProps, modelValue } = toRefs(props);\n\n  const [value, onChange] = useVModel(valueFromProps, modelValue, props.defaultValue, props.onChange);\n\n  const formatRef = computed(() =>\n    getDefaultFormat({\n      mode: props.mode,\n      format: props.format,\n      enableTimePicker: props.enableTimePicker,\n    }),\n  );\n\n  if (props.enableTimePicker) {\n    if (!extractTimeFormat(formatRef.value.format))\n      console.error(`format: ${formatRef.value.format} 不规范，包含时间选择必须要有时间格式化 HH:mm:ss`);\n  }\n\n  // warning invalid value\n  if (!Array.isArray(value.value)) {\n    console.error(`typeof value: ${value.value} must be Array!`);\n  } else if (!isValidDate(value.value, formatRef.value.format)) {\n    console.error(\n      `value: ${value.value} is invalid dateTime! Check whether the value is consistent with format: ${formatRef.value.format}`,\n    );\n  }\n\n  const isFirstValueSelected = ref(false); // 记录面板点击次数，两次后才自动关闭\n  const time = ref(\n    initYearMonthTime({\n      value: value.value,\n      mode: props.mode,\n      format: formatRef.value.format,\n      timeFormat: formatRef.value.timeFormat,\n    }).time,\n  );\n  const month = ref(\n    initYearMonthTime({\n      value: value.value,\n      mode: props.mode,\n      format: formatRef.value.format,\n      enableTimePicker: props.enableTimePicker,\n    }).month,\n  );\n  const year = ref(initYearMonthTime({ value: value.value, mode: props.mode, format: formatRef.value.format }).year);\n  const cacheValue = ref(formatDate(value.value, { format: formatRef.value.format })); // 选择阶段预选状态\n\n  // 输入框响应 value 变化\n  watchEffect(() => {\n    if (!value.value) {\n      cacheValue.value = [];\n      return;\n    }\n    if (!isValidDate(value.value, formatRef.value.format)) return;\n\n    cacheValue.value = formatDate(value.value, {\n      format: formatRef.value.format,\n    });\n    time.value = formatTime(value.value, formatRef.value.timeFormat) as string[];\n  });\n\n  return {\n    year,\n    month,\n    value,\n    time,\n    isFirstValueSelected,\n    cacheValue,\n    onChange,\n  };\n}\n"],"names":["PARTIAL_MAP","first","second","initYearMonthTime","value","mode","format","timeFormat","enableTimePicker","defaultYearMonthTime","year","dayjs","month","time","Array","isArray","length","map","v","parseToDayjs","useRangeValue","props","toRefs","valueFromProps","modelValue","useVModel","defaultValue","onChange","formatRef","computed","getDefaultFormat","extractTimeFormat","console","error","isValidDate","isFirstValueSelected","ref","cacheValue","formatDate","watchEffect","formatTime"],"mappings":"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"}