{"version":3,"file":"useDragSort.mjs","sources":["../../src/hooks/useDragSort.tsx"],"sourcesContent":["import { onUnmounted } from 'vue';\n\nconst traversalTabNavs = (tabNavs: HTMLCollection, fn: { (itemNode: any): void; (tabNav: HTMLDivElement): void }) => {\n  for (const itemNode of tabNavs) {\n    if (itemNode.getAttribute('draggable')) {\n      fn(itemNode);\n    }\n  }\n};\n\nconst handleTarget = (target: EventTarget, tabNavs: HTMLCollection): any => {\n  let resultTarget;\n  traversalTabNavs(tabNavs, (itemNode) => {\n    if (itemNode.contains(target)) {\n      resultTarget = itemNode;\n    }\n  });\n  return resultTarget;\n};\n\nexport default function useDragSort(props: any) {\n  let navsWrap: HTMLDivElement = null;\n\n  // 获取当前正在拖动的tabNav节点\n  let dragged: HTMLDivElement;\n  const enterTargets: HTMLDivElement[] = [];\n\n  const dragstart = (event: DragEvent) => {\n    const target = event.target as HTMLDivElement;\n    // const { target } = event;\n    // 保存拖动元素的引用(ref.)\n    dragged = target;\n    // 使其半透明\n    target.style.opacity = '0.5';\n  };\n  const dragend = (event: DragEvent) => {\n    // 重置透明度\n    (event.target as HTMLDivElement).style.opacity = '';\n  };\n  /* 放置目标元素时触发事件 */\n  const dragover = (event: DragEvent) => {\n    // 阻止默认动作以启用drop\n    event.preventDefault();\n  };\n  // 当可拖动的元素进入可放置的目标时\n  const dragenter = (event: DragEvent) => {\n    // 高亮目标节点\n    const target = handleTarget(event.target, navsWrap.children);\n    if (target && target !== dragged) {\n      target.firstChild.style.outline = '1px dashed #0052d9';\n      // 进入的节点全部记录下来\n      if (!enterTargets.includes(target)) {\n        enterTargets.push(target);\n      }\n    }\n  };\n  // 当拖动元素离开可放置目标节点\n  const dragleave = (event: DragEvent) => {\n    const target = event.target as HTMLDivElement;\n    // 重置其边框\n    // const { target } = event;\n    for (const enterTarget of enterTargets) {\n      // 目标不在需要放入的节点内，则重置边框\n      if (!enterTarget.contains(target)) {\n        // 记录过的节点全部重置边框\n        (enterTarget.firstChild as HTMLDivElement).style.outline = 'none';\n      }\n    }\n  };\n  const drop = (event: DragEvent) => {\n    // 阻止默认动作（如打开一些元素的链接）\n    event.preventDefault();\n\n    traversalTabNavs(navsWrap.children, (tabNav) => {\n      tabNav.firstChild.style.outline = 'none';\n    });\n    // 将拖动的元素到所选择的放置目标节点中\n    let target = handleTarget(event.target, navsWrap.children);\n    if (target && target.parentNode !== dragged) {\n      // 获取拖拽元素index\n      const dragIndex = [].indexOf.call(navsWrap.children, dragged);\n      // 获取放入元素index\n      const targetIndex = [].indexOf.call(navsWrap.children, target);\n      if (targetIndex > dragIndex) {\n        target = navsWrap.children[targetIndex + 1];\n      }\n      navsWrap.insertBefore(dragged, target);\n\n      // 当props.theme === \"normal\" 会多出一个指示条为第一个dom节点，所以需要减1\n      const currentIndex = props.theme === 'card' ? dragIndex : dragIndex - 1;\n      const endIndex = props.theme === 'card' ? targetIndex : targetIndex - 1;\n      props.onDragSort({\n        currentIndex,\n        current: props.panels[currentIndex].value,\n        targetIndex: endIndex,\n        target: props.panels[endIndex].value,\n      });\n    }\n  };\n  function setNavsWrap(val: HTMLDivElement) {\n    navsWrap = val;\n    navsWrap.addEventListener('dragstart', dragstart, false);\n    navsWrap.addEventListener('dragend', dragend, false);\n    navsWrap.addEventListener('dragover', dragover, false);\n    navsWrap.addEventListener('dragenter', dragenter, false);\n    document.addEventListener('dragleave', dragleave, false);\n    document.addEventListener('mousemove', dragleave, false);\n    navsWrap.addEventListener('drop', drop, false);\n  }\n\n  onUnmounted(() => {\n    navsWrap.removeEventListener('dragstart', dragstart);\n    navsWrap.removeEventListener('dragend', dragend);\n    navsWrap.removeEventListener('dragover', dragover);\n    navsWrap.removeEventListener('dragenter', dragenter);\n    document.removeEventListener('dragleave', dragleave);\n    document.removeEventListener('mousemove', dragleave);\n    navsWrap.removeEventListener('drop', drop);\n  });\n  return { setNavsWrap };\n}\n"],"names":["traversalTabNavs","tabNavs","fn","itemNode","getAttribute","handleTarget","target","resultTarget","contains","useDragSort","props","navsWrap","dragged","enterTargets","dragstart","event","style","opacity","dragend","dragover","preventDefault","dragenter","children","firstChild","outline","includes","push","dragleave","enterTarget","drop","tabNav","parentNode","dragIndex","indexOf","call","targetIndex","insertBefore","currentIndex","theme","endIndex","onDragSort","current","panels","value","setNavsWrap","val","addEventListener","document","onUnmounted","removeEventListener"],"mappings":"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"}