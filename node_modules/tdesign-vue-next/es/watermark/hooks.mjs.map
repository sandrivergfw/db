{"version":3,"file":"hooks.mjs","sources":["../../src/watermark/hooks.ts"],"sourcesContent":["import type { ComponentPublicInstance, Ref } from 'vue';\nimport { unref, watch, getCurrentScope, onScopeDispose } from 'vue';\n\nexport const defaultWindow = typeof window !== 'undefined' ? window : undefined;\nexport interface ConfigurableWindow {\n  window?: Window;\n}\n// eslint-disable-next-line no-undef\nexport interface MutationObserverOptions extends MutationObserverInit, ConfigurableWindow {}\nexport type MaybeRef<T> = T | Ref<T>;\nexport type VueInstance = ComponentPublicInstance;\nexport type MaybeElementRef<T extends MaybeElement = MaybeElement> = MaybeRef<T>;\nexport type MaybeElement = HTMLElement | SVGElement | VueInstance | undefined | null;\nexport type UnRefElementReturn<T extends MaybeElement = MaybeElement> = T extends VueInstance\n  ? Exclude<MaybeElement, VueInstance>\n  : T | undefined;\n\nexport type Fn = () => void;\n\nexport function unrefElement<T extends MaybeElement>(elRef: MaybeElementRef<T>): UnRefElementReturn<T> {\n  const plain = unref(elRef);\n  return (plain as VueInstance)?.$el ?? plain;\n}\nexport function tryOnScopeDispose(fn: Fn) {\n  if (getCurrentScope()) {\n    onScopeDispose(fn);\n    return true;\n  }\n  return false;\n}\n\nexport function useMutationObserver(\n  target: MaybeElementRef,\n  // eslint-disable-next-line no-undef\n  callback: MutationCallback,\n  options: MutationObserverOptions = {},\n) {\n  const { window = defaultWindow, ...mutationOptions } = options;\n  let observer: MutationObserver | undefined;\n  const isSupported = window && 'MutationObserver' in window;\n\n  const cleanup = () => {\n    if (observer) {\n      observer.disconnect();\n      observer = undefined;\n    }\n  };\n\n  const stopWatch = watch(\n    () => unrefElement(target),\n    (el) => {\n      cleanup();\n\n      if (isSupported && window && el) {\n        observer = new MutationObserver(callback);\n        observer.observe(el, mutationOptions);\n      }\n    },\n    { immediate: true },\n  );\n\n  const stop = () => {\n    cleanup();\n    stopWatch();\n  };\n\n  tryOnScopeDispose(stop);\n\n  return {\n    isSupported,\n    stop,\n  };\n}\n\nexport type UseMutationObserverReturn = ReturnType<typeof useMutationObserver>;\n"],"names":["defaultWindow","window","unrefElement","elRef","plain","unref","$el","tryOnScopeDispose","fn","getCurrentScope","onScopeDispose","useMutationObserver","target","callback","options","mutationOptions","observer","isSupported","cleanup","disconnect","stopWatch","watch","el","MutationObserver","observe","immediate","stop"],"mappings":";;;;;;;;;;AAGO,IAAMA,aAAgB,GAAA,OAAOC,MAAW,KAAA,WAAA,GAAcA,MAAS,GAAA,KAAA,EAAA;AAgB/D,SAASC,aAAqCC,KAAkD,EAAA;AAAA,EAAA,IAAA,UAAA,CAAA;AAC/F,EAAA,IAAAC,KAAA,GAAQC,MAAMF,KAAK,CAAA,CAAA;EACzB,OAAQC,CAAAA,UAAAA,GAAAA,kBAAAA,4BAAAA,MAAuBE,GAAO,mDAAAF,KAAA,CAAA;AACxC,CAAA;AACO,SAASG,kBAAkBC,EAAQ,EAAA;EACxC,IAAIC,iBAAmB,EAAA;IACrBC,cAAA,CAAeF,EAAE,CAAA,CAAA;AACV,IAAA,OAAA,IAAA,CAAA;AACT,GAAA;AACO,EAAA,OAAA,KAAA,CAAA;AACT,CAAA;AAEO,SAASG,mBACd,CAAAC,MAAA,EAEAC,QACA,EACA;EAAA,IADAC,OAAA,GAAmC,SAAA,CAAA,MAAA,GAAA,CAAA,IAAA,SAAA,CAAA,CAAA,CAAA,KAAA,SAAA,GAAA,SAAA,CAAA,CAAA,CAAA,GAAA,EACnC,CAAA;EACA,IAAuDA,eAAAA,GAAAA,OAAA,CAA/Cb,MAAA;AAAAA,IAAAA,OAAS,gCAAAD,aAAA,GAAA,eAAA;AAAkBe,IAAAA,2CAAoBD,OAAA,EAAA,SAAA,CAAA,CAAA;AACnD,EAAA,IAAAE,QAAA,CAAA;AACE,EAAA,IAAAC,WAAA,GAAchB,WAAU,kBAAsBA,IAAAA,OAAAA,CAAAA;AAEpD,EAAA,IAAMiB,UAAU,SAAVA,UAAgB;AACpB,IAAA,IAAIF,QAAU,EAAA;MACZA,QAAA,CAASG,UAAW,EAAA,CAAA;MACTH,QAAA,GAAA,KAAA,CAAA,CAAA;AACb,KAAA;GACF,CAAA;EAEA,IAAMI,SAAY,GAAAC,KAAA,CAChB,YAAA;IAAA,OAAMnB,aAAaU,MAAM,CAAA,CAAA;GACzB,EAAA,UAACU,EAAO,EAAA;AACEJ,IAAAA,OAAA,EAAA,CAAA;AAEJ,IAAA,IAAAD,WAAA,IAAehB,WAAUqB,EAAI,EAAA;AACpBN,MAAAA,QAAA,GAAA,IAAIO,iBAAiBV,QAAQ,CAAA,CAAA;AAC/BG,MAAAA,QAAA,CAAAQ,OAAA,CAAQF,IAAIP,eAAe,CAAA,CAAA;AACtC,KAAA;AACF,GAAA,EACA;AAAEU,IAAAA,WAAW,IAAA;AAAK,GAAA,CACpB,CAAA;AAEA,EAAA,IAAMC,OAAO,SAAPA,OAAa;AACTR,IAAAA,OAAA,EAAA,CAAA;AACEE,IAAAA,SAAA,EAAA,CAAA;GACZ,CAAA;EAEAb,iBAAA,CAAkBmB,IAAI,CAAA,CAAA;EAEf,OAAA;AACLT,IAAAA,WAAA,EAAAA,WAAA;AACAS,IAAAA,IAAA,EAAAA,IAAAA;GACF,CAAA;AACF;;;;"}